<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="com.hsapi.cloud.part.invoicing.query">
    <parameterMap class="commonj.sdo.DataObject" id="parameterMap">
        <parameter javaType="date" jdbcType="DATE" property="dateType"/>
    </parameterMap>
    <resultMap class="commonj.sdo.DataObject" id="resultMap">
        <result column="TYPEID" javaType="string" property="typeId"/>
    </resultMap>
    <select id="queryPjShopCart" parameterMap="parameterMap" resultClass="com.hsapi.cloud.part.data.pts.PjShopCart">
		SELECT
			a.id AS id,
			a.time_flag AS timeFlag,
			a.org_id AS orgId,
			a.shop_type as shopType,
			a.part_id as partId,
			a.part_code as partCode,
			a.full_name as fullName,
			a.unit as unit,
			a.guest_id as guestId,
			a.guest_name as guestName,
			a.short_name as shortName,
			a.bill_type_id as billTypeId,
			a.settle_type_id as settleTypeId,
			a.order_qty as orderQty,
			a.order_price as orderPrice,
			a.remark as remark,
			a.creator_id as creatorId,
			a.creator as creator,
			a.create_date as createDate,
			a.is_confirm as isConfirm,
			a.operator_id as operatorId,
			a.operator as operator,
			a.operate_date as operateDate,
			a.part_id as showPartId,
			a.part_code as showPartCode,
		  	a.full_name as  showFullName,
		 	c.`name` as   showBrandName,
			b.apply_car_model as showCarModel,
			b.oem_code as showOemCode,
			b.spec as showSpec,
			a.order_price as showPrice
		FROM
			pj_shop_cart a
		LEFT JOIN wb_common.com_attribute b ON a.part_id = b.id
		LEFT JOIN wb_common.com_part_brand c ON b.part_brand_id = c.id
		Where 1=1
		<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.org_id = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(a.part_code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="fullName">(a.full_name like '%$fullName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="isConfirm">(a.is_confirm = #isConfirm#)</isNotEmpty>
            <isNotEmpty prepend="and" property="shopType">(a.shop_type = #shopType#)</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjPchsOrderMainList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
		    a.id as id,
			a.service_id as serviceId,
			a.guest_id as guestId,
			a.`code` as manualCode,
			a.tax_sign as taxSign,
			a.tax_rate as taxRate,
			a.order_date as orderDate,
			a.order_man as orderMan,
			a.plan_arrive_date as planArriveDate,
			a.bill_type_id as billTypeId,
			a.settle_type_id as settleTypeId,
			a.print_times as printTimes,
			a.creator as creator,
			a.create_date as createDate,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.orgid as orgid,
			a.bill_status_id as billStatusId,
			d.full_name as fullName,
			d.short_name as shortName,
			a.is_diff_order as isDiffOrder,
			a.source_type as sourceType,
			a.rtn_reason_id as rtnReasonId,
			a.is_finished as isFinished
		FROM
			pj_pchs_order_main_chk a
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		WHERE
			a.audit_sign = 1
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isDiffOrder">(a.is_diff_order = #isDiffOrder#)</isNotEmpty>
            <isNotEmpty prepend="and" property="billStatusId">(a.bill_status_id = #billStatusId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="billStatusIdList">(a.bill_status_id in ($billStatusIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="notFinished">(a.is_finished = #notFinished#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(a.order_type_id = #orderTypeId#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOrderDate">A.order_date &gt;= #sOrderDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOrderDate">(A.order_date &lt; #eOrderDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.CREATE_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.CREATE_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceMan">(A.order_man = #serviceMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="directOrgid">(A.direct_orgid = #directOrgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="noDirectGuestId">(A.direct_guest_id =0 )</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjPchsOrderMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			a.`code` as manualCode,
			a.order_date as orderDate,
			a.order_man as orderMan,
			a.order_type as orderType,
			a.plan_arrive_date as planArriveDate,
			a.bill_type_id as billTypeId,
			a.settle_type_id as settelTypeId,
			a.print_times as printTimes,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.creator as creator,
			a.create_date as createDate,
			a.remark as mainRemark,
			a.orgid as orgid,
			a.audit_sign as auditSign,
			b.id as detailId,
			b.main_id as mainId,
			b.store_id as storeId,
			b.store_shelf as storeShelf,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			b.order_qty as orderQty,
			b.order_price as orderPrice,
			b.order_amt as orderAmt,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.exp_enter_price as expEnterPrice,
			b.exp_enter_amt as expEnterAmt,
			b.tax_cost_price as taxCostPrice,
			b.tax_cost_amt as taxCostAmt,
			b.set_cost_price as setCostPrice,
			b.set_cost_amt as setCostAmt,
			b.true_enter_qty as trueEnterQty,
			b.true_enter_amt as trueEnterAmt,
			b.not_enter_qty as notEnterQty,
			b.not_enter_amt as notEnterAmt,
			b.adjust_qty as adjustQty,
			b.is_finished as isFinished,
			b.finish_date as finishDate,
			b.remark as detailRemark,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			c.org_car_brand_id as orgCarBrandId,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
			pj_pchs_order_main_chk a
		INNER JOIN pj_pchs_order_detail_chk b ON a.id = b.main_id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		WHERE
			a.audit_sign = 1
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(a.order_type_id = #orderTypeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isDiffOrder">(a.is_diff_order = #isDiffOrder#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isFinished">(a.is_finished = #isFinished#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderType">(a.order_type = #orderType#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOrderDate">A.CREATE_DATE &gt;= #sOrderDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOrderDate">(A.CREATE_DATE &lt; #eOrderDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(c.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%'  or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id like '%$serviceId$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
            <isNotEmpty prepend="limit" property="limitCount">$limitCount$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjPchsEnterMainList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT DISTINCT
			a.id as id,
			a.service_id as serviceId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.code_id as codeId,
			a.`code` as code,
			a.enter_date as enterDate,
			a.order_man as orderMan,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			a.bill_type_id as billTypeId,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
			pj_enter_main_chk a
		INNER JOIN pj_enter_detail_chk b ON a.id = b.main_id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id		
		WHERE
			a.audit_sign = 1 and b.outable_qty &gt;0
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="enterTypeId">(a.enter_type_id = #enterTypeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="codeId">(a.code_id  = #codeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="code">(a.code like '%$code$%')</isNotEmpty>
            <!--入库日期 -->
            <isNotEmpty prepend="and" property="sEnterDate">A.enter_date &gt;= #sEnterDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eEnterDate">(A.enter_date &lt; #eEnterDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjPchsEnterMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.id as id,
			a.service_id as serviceId,
			b.store_id as storeId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.`code` as manualCode,
			a.code_id as codeId,
			a.enter_date as enterDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			b.id as detailId,
			b.main_id as mainId,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			b.enter_qty as enterQty,
			b.enter_price as enterPrice,
			b.enter_amt as enterAmt,
			b.outable_qty as outableQty,
			b.pre_out_qty as preOutQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.rtn_price as rtnPrice,
			b.rtn_amt as rtnAmt,
			b.enter_date as detailEnterDate,
			b.branch_stock_age as branchStockAge,
			b.chain_stock_age as chainStockAge,
			b.guest_id as guestId,
			b.guest_name as guestName,
			b.remark as detailRemark,
			b.pack_amt as packAmt,
			b.scrap_qty as scrapQty,
			b.store_shelf as storeShelf,
			b.origin_id as originId,
			b.origin_guest_id as originGuestId,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
			pj_enter_main_chk a
		INNER JOIN pj_enter_detail_chk b ON a.id = b.main_id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		WHERE
			a.audit_sign = 1
			AND a.enter_type_id = '050101'
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="idList">(A.id in ($idList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="mainId">(b.main_id = #mainId#)</isNotEmpty>
            <!--入库日期 -->
            <isNotEmpty prepend="and" property="sEnterDate">A.enter_date &gt;= #sEnterDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eEnterDate">(A.enter_date &lt; #eEnterDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%'  or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="outableQty">(b.outable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <!-- 替换上面 -->
    <select id="queryPjPchsEnterMainDetails" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT 
		 	a.id as id,
			a.service_id as serviceId,
			b.store_id as storeId,
			a.orgid as orgid,
			a.`code` as manualCode,
			a.code_id as codeId,
			e.enter_date as enterDate,
			a.order_man as orderMan,
			a.order_type as orderType,
			a.bill_type_id as billTypeId,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			a.no_state_amt as noStateAmt,
			a.have_state_amt as haveStateAmt,
			b.id as detailId,
			b.main_id as mainId,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			b.order_price as orderPrice,
			e.enter_qty * b.order_price as orderAmt,
			b.show_price as showPrice,
			e.enter_qty * b.show_price as showAmt,
			e.enter_qty as enterQty,
			e.enter_price AS enterPrice,
			e.enter_amt AS enterAmt,
			e.outable_qty as outableQty,
			e.pre_out_qty as preOutQty,
			e.tax_sign as taxSign,
			e.tax_rate as taxRate,
			e.tax_price as taxPrice,
			e.tax_amt as taxAmt,
			e.no_tax_price as noTaxPrice,
			e.no_tax_amt as noTaxAmt,
			e.tax_diff as taxDiff,
			e.rtn_price as rtnPrice,
			e.rtn_amt as rtnAmt,
			e.expense_amt as expenseAmt,
			e.exp_enter_price as expEnterPrice,
			e.exp_enter_amt as expEnterAmt,
			e.tax_cost_price as taxCostPrice,
			e.tax_cost_amt as taxCostAmt,
			e.set_cost_price as setCostPrice,
			e.set_cost_amt as setCostAmt,
			e.no_tax_cost_price as noTaxCostPrice,
			e.no_tax_cost_amt as noTaxCostAmt,
			e.enter_date as detailEnterDate,
			e.branch_stock_age as branchStockAge,
			e.chain_stock_age as chainStockAge,
			e.guest_id as guestId,
			e.guest_name as guestName,
			b.remark as detailRemark,
			e.pack_amt as packAmt,
			e.origin_id as originId,
			e.origin_guest_id as originGuestId,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			c.org_car_brand_id as orgCarBrandId,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
			pj_pchs_order_main_chk a
		INNER JOIN pj_pchs_order_detail_chk  b ON a.id = b.main_id
		INNER JOIN pj_enter_detail_chk e on e.order_main_id = a.id and e.order_detail_id =b.id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		WHERE
			a.audit_sign = 1
			and a.is_diff_order =1
 		<dynamic>
            <isNotEmpty prepend="and" property="orgids">(a.orgid in ($orgids$))</isNotEmpty>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isState">(a.is_state = #isState#)</isNotEmpty>
            <isNotEmpty prepend="and" property="stateSign">(a.state_sign = #stateSign#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(a.order_type_id = #orderTypeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="idList">(A.id in ($idList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="mainId">(b.main_id = #mainId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderType">(a.order_type = #orderType#)</isNotEmpty>
            <!--入库日期 -->
            <isNotEmpty prepend="and" property="sEnterDate">A.enter_date &gt;= #sEnterDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eEnterDate">(A.enter_date &lt; #eEnterDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(c.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestName">(d.full_name like '%$guestName$%' or d.short_name like '%$guestName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%'  or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCode">(A.code = #manualCode#)</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCodeList">(a.code in ($manualCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="outableQty">(e.outable_qty &gt; 0)</isNotEmpty>
            <!-- 月结 020502 -->
            <isNotEmpty prepend="and" property="settleTypeId">(a.settle_type_id = #settleTypeId#)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <!--未对账单-->
    <select id="queryPjPchsEnterMainDetailsState" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT 
		 	a.id as id,
			a.service_id as serviceId,
			b.store_id as storeId,
			a.orgid as orgid,
			a.`code` as manualCode,
			a.code_id as codeId,
			a.audit_date as enterDate,
			a.order_man as orderMan,
			a.order_type as orderType,
			a.bill_type_id as billTypeId,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			a.no_state_amt as noStateAmt,
			a.have_state_amt as haveStateAmt,
			b.id as detailId,
			b.main_id as mainId,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			b.order_qty as orderQty,
			b.order_price as orderPrice,
			b.order_amt as orderAmt,
			b.show_price as showPrice,
			b.show_amt as showAmt,
			b.remark as detailRemark,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			c.org_car_brand_id as orgCarBrandId,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
			pj_pchs_order_main_chk a
		INNER JOIN pj_pchs_order_detail_chk  b ON a.id = b.main_id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		WHERE
			a.audit_sign = 1
			and a.is_diff_order =1
 		<dynamic>
            <isNotEmpty prepend="and" property="orgids">(a.orgid in ($orgids$))</isNotEmpty>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isState">(a.is_state = #isState#)</isNotEmpty>
            <isNotEmpty prepend="and" property="stateSign">(a.state_sign = #stateSign#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(a.order_type_id = #orderTypeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="idList">(A.id in ($idList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="mainId">(b.main_id = #mainId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderType">(a.order_type = #orderType#)</isNotEmpty>
            <!--入库日期 -->
            <isNotEmpty prepend="and" property="sEnterDate">A.enter_date &gt;= #sEnterDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eEnterDate">(A.enter_date &lt; #eEnterDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(c.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestName">(d.full_name like '%$guestName$%' or d.short_name like '%$guestName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%'  or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCode">(A.code = #manualCode#)</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCodeList">(a.code in ($manualCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <!-- 月结 020502 -->
            <isNotEmpty prepend="and" property="settleTypeId">(a.settle_type_id = #settleTypeId#)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjSellOrderMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT 
			a.id as id,
			a.service_id as serviceId,
			a.orgid as orgid,
			a.`code` as manualCode,
			a.order_date as orderDate,
			a.plan_send_date as planSendDate,
			a.plan_arrive_date as planArriveDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.print_times as printTimes,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.creator as creator,
			a.create_date as createDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			a.business_type_id as businessTypeId,
			a.is_billing as isBilling,
			b.id as detailId,
			b.main_id as mainId,
			b.store_id as storeId,
			b.store_shelf as storeShelf,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.out_unit_id as outUnitId,
			b.system_unit_id as systemUnitId,
			b.order_qty as orderQty,
			b.order_price as orderPrice,
			b.order_amt as orderAmt,
			b.true_out_qty as trueOutQty,
			b.true_out_amt as trueOutAmt,
			b.not_out_qty as notOutQty,
			b.not_out_amt as notOutAmt,
			b.adjust_qty as adjustQty,
			b.occupy_qty as occupyQty,
			b.is_finished as isFinished,
			b.finish_date as finishDate,
			b.remark as detailRemark,
			b.direct_store_id as directStoreId,
			b.order_amt * a.return_rate as detailReturnAmt,
			b.settle_guest_rebate_amt as settleGuestRebateAmt,
			b.business_type_rebate_amt as businessTypeRebateAmt,
			b.share_expense_amt as shareExpenseAmt,
			b.show_price as showPrice,
			b.show_amt as showAmt,
			b.show_amt - b.order_amt as diffAmt,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.org_car_brand_id as orgCarBrandId,
			c.spec as spec,
			d.full_name as guestFullName,
			d.short_name as guestShortName,
			e.full_name as settleGuestFullName,
			e.short_name as settleGuestShortName
		FROM
		pj_sell_order_main_chk a 
		inner join pj_sell_order_detail_chk b 
			 on a.id = b.main_id 
		inner join wb_common.com_attribute c 
			 on b.part_id = c.id
		inner join wb_common.com_guest d 
			 on a.guest_id = d.id
		inner join wb_common.com_guest e
			on a.settle_guest_id = e.id
		where a.audit_sign = 1
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="tenantId">(d.tenant_id = #tenantId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(a.order_type_id = #orderTypeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isOut">(a.is_out = #isOut#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isDiffOrder">(a.is_diff_order = #isDiffOrder#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(c.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="businessTypeId">(a.business_type_id = #businessTypeId#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOrderDate">A.CREATE_DATE &gt;= #sOrderDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOrderDate">(A.CREATE_DATE &lt; #eOrderDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%'  or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
            <isNotEmpty prepend="limit" property="limitCount">$limitCount$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjSellOutMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			a.guest_id as guestId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.out_date as outDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.print_times as printTimes,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			a.`code` as `code`,
			e.id as codeId,
			b.id as detailId,
			b.main_id as mainId,
			b.source_id as sourceId,
			b.store_id as storeId,
			b.store_shelf as storeShelf,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.out_unit_id as outUnitId,
			b.system_unit_id as systemUnitId,
			b.sell_qty as sellQty,
			b.sell_price as sellPrice,
			b.sell_amt as sellAmt,
			b.rtnable_qty as rtnableQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.enter_price as enterPrice,
			b.enter_amt as enterAmt,
			b.out_to_in_qty as outToInQty,
			b.enter_date as enterDate,
			b.remark as detailRemark,
			b.receive_store_id as receiveStoreId,
			b.sell_amt - b.enter_amt as maoLi,
			b.sell_price - b.enter_price as lossPrice,
			b.origin_id as originId,
			b.origin_guest_id as originGuestId,
			case when b.sell_amt = 0 then 0 else 100.0 * b.enter_amt/b.sell_amt end as costRate,
			case when b.sell_amt = 0 then 0 else 100.0 * (b.sell_amt - b.enter_amt)/b.sell_amt end as maoLiRate,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
		pj_out_main_chk a 
		inner join pj_out_detail_chk b 
			 on a.id = b.main_id 
		inner join wb_common.com_attribute c 
			 on b.part_id = c.id 
		inner join wb_common.com_guest d 
			 on a.guest_id = d.id
		inner join pj_sell_order_main_chk e on a.code =e.service_id
		where a.audit_sign = 1
			  and a.enter_type_id = '050202'
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOutDate">A.out_date &gt;= #sOutDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOutDate">(A.out_date &lt; #eOutDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="rtnableQty">(b.rtnable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">a.$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <!-- 替换上面-->
    <select id="queryPjSellOutMainDetails" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
	    SELECT
	    		a.id as id,
				a.service_id as serviceId,
				a.guest_id as guestId,
				a.orgid as orgid,
				a.out_date as outDate,
				a.order_man as orderMan,
				a.bill_type_id as billTypeId,
				a.print_times as printTimes,
				a.auditor as auditor,
				a.audit_date as auditDate,
				a.remark as mainRemark,
				a.settle_type_id as settleTypeId,
				a.business_type_id as businessTypeId,
				a.`code` as manualCode,
				a.is_billing as isBilling,
				e.id as codeId,
				b.id as detailId,
				b.main_id as mainId,
				b.store_id as storeId,
				b.store_shelf as storeShelf,
				b.part_id as partId,
				b.part_code as partCode,
				b.part_name as partName,
				b.full_name as fullName,
				b.out_unit_id as outUnitId,
				b.system_unit_id as systemUnitId,
				e.sell_qty as sellQty,
				e.sell_price as sellPrice,
				e.sell_amt as sellAmt,
				e.rtnable_qty as rtnableQty,
				e.tax_sign as taxSign,
				e.tax_rate as taxRate,
				e.tax_price as taxPrice,
				e.tax_amt as taxAmt,
				e.no_tax_price as noTaxPrice,
				e.no_tax_amt as noTaxAmt,
				e.tax_diff as taxDiff,
				e.enter_price as enterPrice,
				e.enter_amt as enterAmt,
				e.out_to_in_qty as outToInQty,
				e.enter_date as enterDate,
				b.remark as detailRemark,
				e.sell_amt - e.exp_enter_amt - e.settle_guest_rebate_amt - e.business_type_rebate_amt - e.share_expense_amt as maoLi,
				e.origin_id as originId,
				e.origin_guest_id as originGuestId,
				case when e.sell_amt = 0 then 0 else 100.0 * (e.sell_amt - e.exp_enter_amt - e.settle_guest_rebate_amt - e.business_type_rebate_amt - e.share_expense_amt)/e.sell_amt end as maoLiRate,
				e.exp_enter_price as expEnterPrice,
				e.exp_enter_amt as expEnterAmt,
			    e.tax_cost_price as taxCostPrice,
			    e.tax_cost_amt as taxCostAmt,
			    e.no_tax_cost_price as noTaxCostPrice,
			    e.no_tax_cost_amt as noTaxCostAmt,
				e.sell_amt - e.exp_enter_amt as expMaoLi,
				e.sell_price - e.exp_enter_price as expLossPrice,
				case when e.sell_amt = 0 then 0 else 100.0 * e.exp_enter_amt/e.sell_amt end as expCostRate,
				case when e.sell_amt = 0 then 0 else 100.0 * (e.sell_amt - e.exp_enter_amt)/e.sell_amt end as expMaoLiRate,
				e.sell_amt - e.no_tax_amt as noTaxMaoLi,
				e.sell_price - e.no_tax_price as noTaxLossPrice,
				case when e.sell_amt = 0 then 0 else 100.0 * e.no_tax_amt/e.sell_amt end as noTaxCostRate,
				case when e.sell_amt = 0 then 0 else 100.0 * (e.sell_amt - e.no_tax_amt)/e.sell_amt end as noTaxMaoLiRate,
				e.sell_amt - e.tax_amt as taxMaoLi,
				e.sell_price - e.tax_price as taxLossPrice,
				case when e.sell_amt = 0 then 0 else 100.0 * e.tax_amt/e.sell_amt end as taxCostRate,
				case when e.sell_amt = 0 then 0 else 100.0 * (e.sell_amt - e.tax_amt)/e.sell_amt end as taxMaoLiRate,
				e.settle_guest_rebate_amt as settleGuestRebateAmt,
			    e.business_type_rebate_amt as businessTypeRebateAmt,    
				e.share_expense_amt as shareExpenseAmt,
				a.return_rate * e.sell_amt as returnAmt,
				b.show_price as showPrice,
				b.show_price * e.sell_qty as showAmt,
				b.show_price * e.sell_qty - e.sell_amt as diffAmt,
				c.`code` as comPartCode,
				c.`name` as comPartName,
				c.full_name as comPartFullName,
				c.brand_code as comBrandCode,
				c.oem_code as comOemCode,
				c.quality_type_id as qualityTypeId,
				c.part_brand_id as partBrandId,
				c.apply_car_model as applyCarModel,
				c.apply_carbrand_id as applyCarbrandId,
				c.org_car_brand_id as orgCarBrandId,
				c.spec as spec,
				d.full_name as guestFullName,
				d.short_name as guestShortName,
				f.full_name as settleGuestFullName,
				f.short_name as settleGuestShortName,
			    e.sell_amt * a.return_rate as detailReturnAmt
			FROM
			pj_sell_order_main_chk a 
			inner join pj_sell_order_detail_chk b 
				 on a.id = b.main_id 
			inner join wb_common.com_attribute c 
				 on b.part_id = c.id 
			inner join wb_common.com_guest d 
				 on a.guest_id = d.id
			inner join pj_out_detail_chk e on e.order_main_id =a.id and e.order_detail_id =b.id
			inner join wb_common.com_guest f
			on a.settle_guest_id = f.id
			where a.audit_sign = 1
			and a.is_diff_order =1
		<dynamic>
            <isNotEmpty prepend="and" property="orgids">(a.orgid in ($orgids$))</isNotEmpty>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(a.order_type_id = #orderTypeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(c.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="businessTypeId">(a.business_type_id = #businessTypeId#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOutDate">A.out_date &gt;= #sOutDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOutDate">(A.out_date &lt; #eOutDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCode">(A.code = #manualCode#)</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCodeList">(a.code in ($manualCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="rtnableQty">(e.rtnable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <!-- 查询应收的订单记录-->
    <select id="queryReceiveMainDetails" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
	   	 SELECT
    		a.id as id,
			a.service_id as serviceId,
			a.guest_id as guestId,
			a.orgid as orgid,
			a.out_date as outDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.print_times as printTimes,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			a.no_state_amt as noStateAmt,
			a.have_state_amt as haveStateAmt,
			a.`code` as manualCode,
			b.id as detailId,
			b.main_id as mainId,
			b.store_id as storeId,
			b.store_shelf as storeShelf,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.out_unit_id as outUnitId,
			b.system_unit_id as systemUnitId,
			b.order_qty as sellQty,
			case when a.order_type_id =2
			THEN b.show_price
			ELSE b.order_price
			END as sellPrice,
			case when a.order_type_id =2
			THEN b.show_amt
			ELSE b.order_amt
			END as sellAmt,
			b.order_price as trueSellPrice,
			b.order_amt as trueSellAmt,
			B.show_price as showPrice,
			b.show_amt as showAmt,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			c.org_car_brand_id as orgCarBrandId,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
		pj_sell_order_main_chk a 
		inner join pj_sell_order_detail_chk b 
			 on a.id = b.main_id 
		inner join wb_common.com_attribute c 
			 on b.part_id = c.id 
		inner join wb_common.com_guest d 
			 on a.guest_id = d.id
		where a.audit_sign = 1
		and a.is_diff_order =1
		and a.is_out =1
		<dynamic>
            <isNotEmpty prepend="and" property="orgids">(a.orgid in ($orgids$))</isNotEmpty>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isState">(a.is_state = #isState#)</isNotEmpty>
            <isNotEmpty prepend="and" property="stateSign">(a.state_sign = #stateSign#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(a.order_type_id = #orderTypeId#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOutDate">A.out_date &gt;= #sOutDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOutDate">(A.out_date &lt; #eOutDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestName">(d.FULL_NAME like '%$guestName$%' or d.short_name like '%$guestName$%' )</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <!-- 月结 020502 -->
            <isNotEmpty prepend="and" property="settleTypeId">(a.settle_type_id = #settleTypeId#)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <!-- 导出销售的订单记录-->
    <select id="exportReceiveMainDetails" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
	   SELECT
	   		a.order_type_id as orderTypeId,
			a.service_id AS serviceId,
			a.code as manulCode,
			a.business_type_id as businessTypeId,
			a.guest_id AS guestId,
			a.orgid AS orgid,
			a.order_man as orderMan,
			a.out_date AS outDate,
			a.audit_date AS auditDate,
			a.no_state_amt as noStateAmt,
			a.have_state_amt as haveStateAmt,
			a.remark as remark,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			c.apply_car_model as carModel,
			c.org_car_brand_id as orgCarBrandId,
			c.oem_code as oemCode,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.unit as unit,
			b.order_qty AS orderQty,
			b.show_price AS orderPrice,
			b.show_amt AS orderAmt,
			d.full_name AS guestFullName,
			d.short_name AS guestShortName,
			d.code as guestCode,
			e.car_brand_zh as carBrandName,
			f.`name` as orgName,
			b.store_id as storeId,
			a.bill_type_id as billTypeId
		FROM
			pj_sell_order_main_chk a
		INNER JOIN pj_sell_order_detail_chk b ON a.id = b.main_id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		LEFT JOIN wb_common.com_car_brand e on e.id =c.apply_carbrand_id
		INNER JOIN wb_common.com_company f on f.orgid =a.orgid
		WHERE
			a.audit_sign = 1
		AND a.is_diff_order = 1
		AND a.is_out = 1
		<dynamic>
            <isNotEmpty prepend="and" property="orgids">(a.orgid in ($orgids$))</isNotEmpty>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isState">(a.is_state = #isState#)</isNotEmpty>
            <isNotEmpty prepend="and" property="stateSign">(a.state_sign = #stateSign#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(a.order_type_id = #orderTypeId#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOutDate">A.out_date &gt;= #sOutDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOutDate">(A.out_date &lt; #eOutDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestName">(d.FULL_NAME like '%$guestName$%' or d.short_name like '%$guestName$%' )</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <!-- 月结 020502 -->
            <isNotEmpty prepend="and" property="settleTypeId">(a.settle_type_id = #settleTypeId#)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <!-- 导出采购的订单记录
      LEFT JOIN pj_enter_detail_chk g ON g.order_main_id = a.id AND g.order_detail_id = b.id
      -->
    <select id="exportPchDetails" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
	   SELECT
	   		a.order_type_id as orderTypeId,
			a.service_id AS serviceId,
			a.code as manulCode,
			a.business_type_id as businessTypeId,
			a.guest_id AS guestId,
			a.orgid AS orgid,
			a.order_man as orderMan,
			b.finish_date AS outDate,
			a.audit_date AS auditDate,
			a.no_state_amt as noStateAmt,
			a.have_state_amt as haveStateAmt,
			a.remark as remark,
			b.part_id as partId,
			b.part_code AS partCode,
			b.part_name as partName,
			b.full_name AS fullName,
			c.apply_car_model as carModel,
			c.org_car_brand_id as orgCarBrandId,
			c.oem_code as oemCode,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.unit as unit,
			b.order_qty AS orderQty,
			<!-- (CASE WHEN (a.order_type_id = 4) THEN
				g.rtn_price
			ELSE
				b.order_price
			END
			) AS orderPrice,
			 (CASE WHEN (a.order_type_id = 4) THEN
				g.rtn_amt
			ELSE
				b.order_amt
			END
			) AS orderAmt,-->
			b.show_price as orderPrice,
			b.show_amt as orderAmt,
			d.full_name AS guestFullName,
			d.short_name AS guestShortName,
			d.code as guestCode,
			e.car_brand_zh as carBrandName,
			f.`name` as orgName,
			b.store_id as storeId,
			a.bill_type_id as billTypeId
		FROM
			pj_pchs_order_main_chk a
		INNER JOIN pj_pchs_order_detail_chk b ON a.id = b.main_id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		LEFT JOIN wb_common.com_car_brand e on e.id =c.apply_carbrand_id
		LEFT JOIN wb_common.com_company f on f.orgid =a.orgid
		
		WHERE
			a.audit_sign = 1
		AND a.is_diff_order = 1
		<dynamic>
            <isNotEmpty prepend="and" property="orgids">(a.orgid in ($orgids$))</isNotEmpty>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="isState">(a.is_state = #isState#)</isNotEmpty>
            <isNotEmpty prepend="and" property="stateSign">(a.state_sign = #stateSign#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(a.order_type_id = #orderTypeId#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOutDate">A.out_date &gt;= #sOutDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOutDate">(A.out_date &lt; #eOutDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestName">(d.FULL_NAME like '%$guestName$%' or d.short_name like '%$guestName$%' )</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <!-- 月结 020502 -->
            <isNotEmpty prepend="and" property="settleTypeId">(a.settle_type_id = #settleTypeId#)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjPchsRtnMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			a.guest_id as guestId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.out_date as outDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.print_times as printTimes,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			b.id as detailId,
			b.main_id as mainId,
			b.source_id as sourceId,
			b.store_id as storeId,
			b.store_shelf as storeShelf,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.out_unit_id as outUnitId,
			b.system_unit_id as systemUnitId,
			b.sell_qty as sellQty,
			b.sell_price as sellPrice,
			b.sell_amt as sellAmt,
			b.rtnable_qty as rtnableQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.enter_price as enterPrice,
			b.enter_amt as enterAmt,
			b.out_to_in_qty as outToInQty,
			b.enter_date as enterDate,
			b.remark as detailRemark,
			b.receive_store_id as receiveStoreId,
			b.sell_amt - b.enter_amt as maoLi,
			b.sell_price - b.enter_price as lossPrice,
			b.origin_id as originId,
			b.origin_guest_id as originGuestId,
			case when b.sell_amt = 0 then 0 else 100.0 * b.enter_amt/b.sell_amt end as costRate,
			case when b.sell_amt = 0 then 0 else 100.0 * (b.sell_amt - b.enter_amt)/b.sell_amt end as maoLiRate,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
		pj_out_main_chk a 
		inner join pj_out_detail_chk b 
			 on a.id = b.main_id 
		inner join wb_common.com_attribute c 
			 on b.part_id = c.id 
		inner join wb_common.com_guest d 
			 on a.guest_id = d.id
		where a.audit_sign = 1
			  and a.enter_type_id = '050201'
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOutDate">A.out_date &gt;= #sOutDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOutDate">(A.out_date &lt; #eOutDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="rtnableQty">(b.rtnable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <!-- 替换上面 -->
    <select id="queryPjPchsRtnMainDetails" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
    	SELECT
			a.service_id as serviceId,
			a.guest_id as guestId,
			a.orgid as orgid,
			a.out_date as outDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.print_times as printTimes,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			a.code as manualCode,
			b.id as detailId,
			b.main_id as mainId,
			b.store_id as storeId,
			b.store_shelf as storeShelf,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.out_unit_id as outUnitId,
			b.system_unit_id as systemUnitId,
			b.remark as detailRemark,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			c.org_car_brand_id as orgCarBrandId,
			d.full_name as guestFullName,
			d.short_name as guestShortName,
			e.sell_qty as sellQty,
			e.sell_price as sellPrice,
			e.sell_amt as sellAmt,
			e.rtnable_qty as rtnableQty,
			e.tax_sign as taxSign,
			e.tax_rate as taxRate,
			e.tax_price as taxPrice,
			e.tax_amt as taxAmt,
			e.no_tax_price as noTaxPrice,
			e.no_tax_amt as noTaxAmt,
			e.tax_diff as taxDiff,
			e.enter_price as enterPrice,
			e.enter_amt as enterAmt,
			e.out_to_in_qty as outToInQty,
			e.exp_enter_price as expEnterPrice,
			e.exp_enter_amt as expEnterAmt,
			e.tax_cost_price as taxCostPrice,
			e.tax_cost_amt as taxCostAmt,
			e.no_tax_cost_price as noTaxCostPrice,
			e.no_tax_cost_amt as noTaxCostAmt,
			e.set_cost_price as setCostPrice,
			e.set_cost_amt as setCostAmt
		FROM
		pj_sell_order_main_chk a 
		inner join pj_sell_order_detail_chk b 
			 on a.id = b.main_id 
		INNER JOIN pj_out_detail_chk e 
			on  a.id =e.order_main_id and e.order_detail_id =b.id
		inner join wb_common.com_attribute c 
			 on b.part_id = c.id 
		inner join wb_common.com_guest d 
			 on a.guest_id = d.id
		where a.audit_sign = 1
		and a.is_diff_order =1 
		AND a.order_type_id =3
		<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOutDate">A.out_date &gt;= #sOutDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOutDate">(A.out_date &lt; #eOutDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(c.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCode">(A.code = #manualCode#)</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCodeList">(a.code in ($manualCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="rtnableQty">(e.rtnable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjSellOutRtnMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			b.store_id as storeId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.`code` as manualCode,
			a.enter_date as enterDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			b.id as detailId,
			b.main_id as mainId,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			b.enter_qty as enterQty,
			b.enter_price as enterPrice,
			b.enter_amt as enterAmt,
			b.outable_qty as outableQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.rtn_price as rtnPrice,
			b.rtn_amt as rtnAmt,
			b.enter_date as detailEnterDate,
			b.branch_stock_age as branchStockAge,
			b.chain_stock_age as chainStockAge,
			b.guest_id as guestId,
			b.guest_name as guestName,
			b.remark as detailRemark,
			b.pack_amt as packAmt,
			b.scrap_qty as scrapQty,
			b.store_shelf as storeShelf,
			b.origin_id as originId,
			b.origin_guest_id as originGuestId,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			d.full_name as guestFullName,
			d.short_name as guestShortName,
			g.full_name as guestSupplierFullName,
			g.short_name as guestSupplierShortName
		FROM
			pj_enter_main_chk a
		INNER JOIN pj_enter_detail_chk b ON a.id = b.main_id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		<!--LEFT JOIN pj_enter_detail_chk e on b.root_id = e.id
		LEFT JOIN pj_enter_main_chk f on e.main_id = f.id-->
		inner JOIN wb_common.com_guest g on b.origin_guest_id = g.id
		WHERE
			a.audit_sign = 1
			AND a.enter_type_id = '050102'
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--入库日期 -->
            <isNotEmpty prepend="and" property="sEnterDate">A.enter_date &gt;= #sEnterDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eEnterDate">(A.enter_date &lt; #eEnterDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestSupplierId">(b.guest_id = #guestSupplierId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="outableQty">(b.outable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <!-- 替换上面 -->
    <select id="queryPjSellOutRtnMainDetails" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
    	SELECT
			a.service_id as serviceId,
			b.store_id as storeId,
			a.orgid as orgid,
			a.`code` as manualCode,
			f.enter_date as enterDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			a.business_type_id as businessTypeId,
			b.id as detailId,
			b.main_id as mainId,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			f.enter_qty as enterQty,
			f.enter_price as enterPrice,
			f.enter_amt as enterAmt,
			f.outable_qty as outableQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			f.rtn_price as rtnPrice,
			f.rtn_amt as rtnAmt,
			f.rtn_amt - f.exp_enter_amt - f.settle_guest_rebate_amt - f.business_type_rebate_amt - f.expense_amt as maoLi,
			case when f.rtn_amt = 0 then 0 else 100.0 * (f.rtn_amt - f.exp_enter_amt - f.settle_guest_rebate_amt - f.business_type_rebate_amt - f.expense_amt)/f.rtn_amt end as maoLiRate,
			b.show_price as showPrice,
			b.show_price * f.enter_qty as showAmt,
			b.show_price * f.enter_qty - f.rtn_amt as diffAmt,
			f.expense_amt as expenseAmt,
			f.settle_guest_rebate_amt as settleGuestRebateAmt,
			f.business_type_rebate_amt as businessTypeRebateAmt,
			f.no_tax_cost_price as noTaxCostPrice,
			f.no_tax_cost_amt as noTaxCostAmt,
			f.exp_enter_price as expEnterPrice,
			f.exp_enter_amt as expEnterAmt,
		    f.tax_cost_price as taxCostPrice,
		    f.tax_cost_amt as taxCostAmt,
			a.return_rate * f.rtn_amt as returnAmt,
			f.enter_date as detailEnterDate,
			f.branch_stock_age as branchStockAge,
			f.chain_stock_age as chainStockAge,
			b.remark as detailRemark,
			f.rtn_amt * a.return_rate as detailReturnAmt,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			c.org_car_brand_id as orgCarBrandId,
			d.full_name as guestFullName,
			d.short_name as guestShortName,
			g.full_name as guestSupplierFullName,
			g.short_name as guestSupplierShortName,
			h.full_name as settleGuestFullName,
			h.short_name as settleGuestShortName
		FROM
			pj_pchs_order_main_chk a
		INNER JOIN pj_pchs_order_detail_chk b ON a.id = b.main_id
		INNER JOIN pj_enter_detail_chk f on f.order_main_id =a.id  and f.order_detail_id =b.id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		inner JOIN wb_common.com_guest g on f.origin_guest_id = g.id
		inner JOIN wb_common.com_guest h on a.settle_guest_id  = h.id
		WHERE
			a.audit_sign = 1 
		and a.is_diff_order =1 
		and a.order_type_id =4
		<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--入库日期 -->
            <isNotEmpty prepend="and" property="sEnterDate">f.enter_date &gt;= #sEnterDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eEnterDate">(f.enter_date &lt; #eEnterDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="businessTypeId">(a.business_type_id = #businessTypeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(b.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="settleGuestId">(A.settle_guest_id = #settleGuestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestSupplierId">(f.guest_id = #guestSupplierId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCode">(A.code = #manualCode#)</isNotEmpty>
            <isNotEmpty prepend="and" property="manualCodeList">(a.code in ($manualCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="outableQty">(f.outable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPartStoreStockList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.orgid as orgid,
			a.store_id as storeId,
			a.store_name as storeName,
			a.shelf as shelf,
			a.part_id as partId,
			a.part_code as partCode,
			a.part_name as partName,
			a.full_name as fullName,
			a.out_unit_id as outUnitId,
			a.system_unit_id as systemUnitId,
			a.qc_price as qcPrice,
			a.qc_qty as qcQty,
			a.qc_amt as qcAmt,
			a.enter_qty as enterQty,
			a.enter_amt as enterAmt,
			a.out_qty as outQty,
			a.out_amt as outAmt,
			a.cost_price as costPrice,
			a.stock_qty as stockQty,
			a.stock_amt as stockAmt,
			a.occupy_qty as occupyQty,
			a.outable_qty as outableQty,
			a.on_road_qty as onRoadQty,
			a.last_supplier_id as lastSupplierId,
			a.last_enter_date as lastEnterDate,
			a.last_out_date as lastOutDate,
			a.remark as remark,
			a.version_no as versionNo,
			a.creator_id as creatorId,
			a.creator as creator,
			a.create_date as createDate,
			a.operator_id as operatorId,
			a.operator as operator,
			a.operate_date as operateDate,
			a.order_qty as orderQty,
			a.up_limit as upLimit,
			a.down_limit as downLimit,
			a.up_limit_winter as upLimitWinter,
			a.down_limit_winter as downLimitWinter,
			a.min_order_qty as minOrderQty,
			a.min_pack_qty as minPackQty,
			a.exp_enter_price as expEnterPrice,
			a.exp_enter_amt as expEnterAmt,
			a.tax_cost_price as taxCostPrice,
			a.tax_cost_amt as taxCostAmt,
			a.set_cost_price as setCostPrice,
			a.set_cost_amt as setCostAmt,
			a.no_tax_cost_price as noTaxCostPrice,
			a.no_tax_cost_amt as noTaxCostAmt,
			b.code as comPartCode,
			b.`name` as comPartName,
			b.full_name as comPartFullName,
			b.brand_code as comBrandCode,
			b.oem_code as comOemCode,
			b.common_code as comCommonCode,
			b.quality_type_id as qualityTypeId,
			b.name_py as comNamePy,
			b.goods_code as goodsCode,
			b.part_brand_id as partBrandId,
			b.apply_carbrand_id as applyCarbrandId,
			b.apply_car_model as applyCarModel,
			b.car_type_id_f as carTypeIdF,
			b.car_type_id_s as carTypeIdS,
			b.car_type_id_t as carTypeIdT,
			b.spec as spec,
			b.direction as direction,
			b.model as model,
			b.unit as unit,
			b.org_car_brand_id as orgCarBrandId
		FROM
		pj_part_store_stock a
		inner join wb_common.com_attribute b
		on a.part_id = b.id

		WHERE 1 = 1 
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <!--最近入库日期 -->
            <isNotEmpty prepend="and" property="sLastEnterDate">(A.last_enter_date &gt;= #sLastEnterDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eLastEnterDate">(A.last_enter_date &lt; #eLastEnterDate#)</isNotEmpty>
            <!--最近出库日期 -->
            <isNotEmpty prepend="and" property="sLastOutDate">(A.last_out_date &gt;= #sLastOutDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eLastOutDate">(A.last_out_date &lt; #eLastOutDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(a.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeShelf">(a.shelf = #storeShelf#)</isNotEmpty>
            <!--库存查询默认查询库存大于0 -->
            <isNotEmpty prepend="and" property="notShowAll">(a.stock_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="and" property="zeroStock">(a.stock_qty = 0)</isNotEmpty>
            <isNotEmpty prepend="and" property="noUpDown">(ifnull(a.up_limit,0) = 0)</isNotEmpty>
            <isNotEmpty prepend="and" property="showUp">(a.stock_qty &gt; a.up_limit)</isNotEmpty>
            <isNotEmpty prepend="and" property="showDown">(a.stock_qty &lt;a.down_limit)</isNotEmpty>
            <isNotEmpty prepend="and" property="showNormal">( a.stock_qty &gt; a.down_limit and a.stock_qty &lt; a.up_limit )</isNotEmpty>
            <isNotEmpty prepend="and" property="showUpWinter">(a.stock_qty &gt; a.up_limit_winter)</isNotEmpty>
            <isNotEmpty prepend="and" property="showDownWinter">(a.stock_qty &lt;a.down_limit_winter)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(a.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(b.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(b.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(b.FULL_NAME like '%$partNameAndPY$%' or b.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="applyCarModel">(b.apply_car_model like '%$applyCarModel$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="applyCarBrandId">(b.apply_carbrand_id = #applyCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(b.query_code like '%$partCode$%' or b.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partBrandId">(b.part_brand_id = #partBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(b.code in ($partCodeList$))</isNotEmpty>
            <!--业务界面的库存详情限制50 -->
            <isNotEmpty prepend="" property="limitQuery">limit 50</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryDynamicPartStoreStockList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.orgid as orgid,
			a.store_id as storeId,
			a.store_name as storeName,
			a.shelf as shelf,
			a.part_id as partId,
			a.part_code as partCode,
			a.part_name as partName,
			a.full_name as fullName,
			a.out_unit_id as outUnitId,
			a.system_unit_id as systemUnitId,
			a.qc_price as qcPrice,
			a.qc_qty as qcQty,
			a.qc_amt as qcAmt,
			a.enter_qty as enterQty,
			a.enter_amt as enterAmt,
			a.out_qty as outQty,
			a.out_amt as outAmt,
			a.cost_price as costPrice,
			a.stock_qty as stockQty,
			a.stock_amt as stockAmt,
			a.occupy_qty as occupyQty,
			a.outable_qty as outableQty,
			a.on_road_qty as onRoadQty,
			a.last_supplier_id as lastSupplierId,
			a.last_enter_date as lastEnterDate,
			a.last_out_date as lastOutDate,
			a.remark as remark,
			a.version_no as versionNo,
			a.creator_id as creatorId,
			a.creator as creator,
			a.create_date as createDate,
			a.operator_id as operatorId,
			a.operator as operator,
			a.operate_date as operateDate,
			a.order_qty as orderQty,
			a.up_limit as upLimit,
			a.down_limit as downLimit,
			a.up_limit_winter as upLimitWinter,
			a.down_limit_winter as downLimitWinter,
			a.min_order_qty as minOrderQty,
			a.min_pack_qty as minPackQty,
			b.code as comPartCode,
			b.`name` as comPartName,
			b.full_name as comPartFullName,
			b.brand_code as comBrandCode,
			b.oem_code as comOemCode,
			b.common_code as comCommonCode,
			b.quality_type_id as qualityTypeId,
			b.name_py as comNamePy,
			b.goods_code as goodsCode,
			b.part_brand_id as partBrandId,
			b.apply_carbrand_id as applyCarbrandId,
			b.apply_car_model as applyCarModel,
			b.car_type_id_f as carTypeIdF,
			b.car_type_id_s as carTypeIdS,
			b.car_type_id_t as carTypeIdT,
			b.spec as spec,
			b.direction as direction,
			b.model as model,
			b.org_car_brand_id as orgCarBrandId,
			b.unit as unit
		FROM
		pj_part_store_stock a
		inner join wb_common.com_attribute b
		on a.part_id = b.id

		WHERE 1 = 1 
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <!--最近入库日期 -->
            <isNotEmpty prepend="and" property="startDate">exists (
					select 1 from pj_store_invocing c 
				    where a.orgid = c.orgid and a.store_id = c.store_id and a.part_id = c.part_id  
				          and c.create_date &gt;= #startDate# and c.create_date &lt; #endDate#
				)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(a.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(b.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeShelf">(a.shelf = #storeShelf#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(a.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(b.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(b.FULL_NAME like '%$partNameAndPY$%' or b.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="applyCarModel">(b.apply_car_model like '%$applyCarModel$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(b.query_code like '%$partCode$%' or b.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partBrandId">(b.part_brand_id = #partBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(b.code in ($partCodeList$))</isNotEmpty>
            <!--业务界面的库存详情限制50 -->
            <isNotEmpty prepend="" property="limitQuery">limit 50</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryOutableDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.`code` as manualCode,
			a.enter_date as enterDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			b.id as detailId,
			b.main_id as mainId,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.store_id as storeId,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			b.enter_qty as enterQty,
			b.enter_price as enterPrice,
			b.enter_amt as enterAmt,
			b.outable_qty as outableQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.rtn_price as rtnPrice,
			b.rtn_amt as rtnAmt,
			b.exp_enter_price as expEnterPrice,
			b.exp_enter_amt as expEnterAmt,
			b.tax_cost_price as taxCostPrice,
			b.tax_cost_amt as taxCostAmt,
			b.set_cost_price as setCostPrice,
			b.set_cost_amt as setCostAmt,
			b.enter_date as detailEnterDate,
			b.branch_stock_age as branchStockAge,
			b.chain_stock_age as chainStockAge,
			b.guest_id as guestId,
			b.guest_name as guestName,
			b.remark as detailRemark,
			b.pack_amt as packAmt,
			b.scrap_qty as scrapQty,
			b.store_shelf as storeShelf,
			b.origin_id as originId,
			b.origin_guest_id as originGuestId,
			b.pre_out_qty as preOutQty,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			<!--ifnull(g.full_name, d.full_name) as guestFullName,
			ifnull(g.short_name, d.short_name) as guestShortName-->
			g.full_name as guestFullName,
			g.short_name as guestShortName
		FROM
			pj_enter_main_chk a
		INNER JOIN pj_enter_detail_chk b ON a.id = b.main_id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		<!--left join pj_enter_detail_chk e on b.root_id = e.id
		left join pj_enter_main_chk f on e.main_id = f.id
		left join wb_common.com_guest g on f.guest_id = g.id-->
		inner join wb_common.com_guest g on b.origin_guest_id = g.id
		WHERE
			a.audit_sign = 1
			and (b.outable_qty &gt; 0)
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--入库日期 -->
            <isNotEmpty prepend="and" property="sEnterDate">A.enter_date &gt;= #sEnterDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eEnterDate">(A.enter_date &lt; #eEnterDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(b.origin_guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjCheckEnterMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			b.store_id as storeId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.`code` as manualCode,
			a.enter_date as enterDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			b.id as detailId,
			b.main_id as mainId,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			b.enter_qty as enterQty,
			b.enter_price as enterPrice,
			b.enter_amt as enterAmt,
			b.outable_qty as outableQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.rtn_price as rtnPrice,
			b.rtn_amt as rtnAmt,
			b.enter_date as detailEnterDate,
			b.branch_stock_age as branchStockAge,
			b.chain_stock_age as chainStockAge,
			b.guest_id as guestId,
			b.guest_name as guestName,
			b.remark as detailRemark,
			b.pack_amt as packAmt,
			b.scrap_qty as scrapQty,
			b.store_shelf as storeShelf,
			b.origin_id as originId,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
			pj_enter_main_chk a
		INNER JOIN pj_enter_detail_chk b ON a.id = b.main_id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		WHERE
			a.audit_sign = 1
			AND a.enter_type_id = '050103'
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--入库日期 -->
            <isNotEmpty prepend="and" property="sEnterDate">A.enter_date &gt;= #sEnterDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eEnterDate">(A.enter_date &lt; #eEnterDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="outableQty">(b.outable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjCheckOutMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			a.guest_id as guestId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.out_date as outDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			b.id as detailId,
			b.main_id as mainId,
			b.source_id as sourceId,
			b.store_id as storeId,
			b.store_shelf as storeShelf,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.out_unit_id as outUnitId,
			b.system_unit_id as systemUnitId,
			b.sell_qty as sellQty,
			b.sell_price as sellPrice,
			b.sell_amt as sellAmt,
			b.rtnable_qty as rtnableQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.enter_price as enterPrice,
			b.enter_amt as enterAmt,
			b.out_to_in_qty as outToInQty,
			b.enter_date as enterDate,
			b.remark as detailRemark,
			b.receive_store_id as receiveStoreId,
			b.sell_amt - b.enter_amt as maoLi,
			b.sell_price - b.enter_price as lossPrice,
			b.origin_id as originId,
			case when b.sell_amt = 0 then 0 else 100.0 * b.enter_amt/b.sell_amt end as costRate,
			case when b.sell_amt = 0 then 0 else 100.0 * (b.sell_amt - b.enter_amt)/b.sell_amt end as maoLiRate,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
		pj_out_main_chk a 
		inner join pj_out_detail_chk b 
			 on a.id = b.main_id 
		inner join wb_common.com_attribute c 
			 on b.part_id = c.id 
		inner join wb_common.com_guest d 
			 on a.guest_id = d.id
		where a.audit_sign = 1
			  and a.enter_type_id = '050203'
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOutDate">A.out_date &gt;= #sOutDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOutDate">(A.out_date &lt; #eOutDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="rtnableQty">(b.rtnable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjShiftEnterMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			b.store_id as storeId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.`code` as manualCode,
			a.enter_date as enterDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			b.id as detailId,
			b.main_id as mainId,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			b.enter_qty as enterQty,
			b.enter_price as enterPrice,
			b.enter_amt as enterAmt,
			b.outable_qty as outableQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.rtn_price as rtnPrice,
			b.rtn_amt as rtnAmt,
			b.enter_date as detailEnterDate,
			b.branch_stock_age as branchStockAge,
			b.chain_stock_age as chainStockAge,
			b.guest_id as guestId,
			b.guest_name as guestName,
			b.remark as detailRemark,
			b.pack_amt as packAmt,
			b.scrap_qty as scrapQty,
			b.store_shelf as storeShelf,
			b.origin_id as originId,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
			pj_enter_main_chk a
		INNER JOIN pj_enter_detail_chk b ON a.id = b.main_id
		INNER JOIN wb_common.com_attribute c ON b.part_id = c.id
		INNER JOIN wb_common.com_guest d ON a.guest_id = d.id
		WHERE
			a.audit_sign = 1
			AND a.enter_type_id = '050107'
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--入库日期 -->
            <isNotEmpty prepend="and" property="sEnterDate">A.enter_date &gt;= #sEnterDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eEnterDate">(A.enter_date &lt; #eEnterDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="outableQty">(b.outable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjShiftOutMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			a.guest_id as guestId,
			a.orgid as orgid,
			a.enter_type_id as enterTypeId,
			a.out_date as outDate,
			a.order_man as orderMan,
			a.bill_type_id as billTypeId,
			a.print_times as printTimes,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.remark as mainRemark,
			a.settle_type_id as settleTypeId,
			b.id as detailId,
			b.main_id as mainId,
			b.source_id as sourceId,
			b.store_id as storeId,
			b.store_shelf as storeShelf,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.out_unit_id as outUnitId,
			b.system_unit_id as systemUnitId,
			b.sell_qty as sellQty,
			b.sell_price as sellPrice,
			b.sell_amt as sellAmt,
			b.rtnable_qty as rtnableQty,
			b.tax_sign as taxSign,
			b.tax_rate as taxRate,
			b.tax_price as taxPrice,
			b.tax_amt as taxAmt,
			b.no_tax_price as noTaxPrice,
			b.no_tax_amt as noTaxAmt,
			b.tax_diff as taxDiff,
			b.enter_price as enterPrice,
			b.enter_amt as enterAmt,
			b.out_to_in_qty as outToInQty,
			b.enter_date as enterDate,
			b.remark as detailRemark,
			b.receive_store_id as receiveStoreId,
			b.receive_store_shelf as receiveStoreShelf,
			b.sell_amt - b.enter_amt as maoLi,
			b.sell_price - b.enter_price as lossPrice,
			b.origin_id as originId,
			case when b.sell_amt = 0 then 0 else 100.0 * b.enter_amt/b.sell_amt end as costRate,
			case when b.sell_amt = 0 then 0 else 100.0 * (b.sell_amt - b.enter_amt)/b.sell_amt end as maoLiRate,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
		pj_out_main_chk a 
		inner join pj_out_detail_chk b 
			 on a.id = b.main_id 
		inner join wb_common.com_attribute c 
			 on b.part_id = c.id 
		inner join wb_common.com_guest d 
			 on a.guest_id = d.id
		where a.audit_sign = 1
			  and a.enter_type_id = '050207'
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOutDate">A.out_date &gt;= #sOutDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOutDate">(A.out_date &lt; #eOutDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="rtnableQty">(b.rtnable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryChainStockByPartId" parameterClass="java.util.HashMap" resultClass="commonj.sdo.DataObject">SELECT a.part_id as partId, a.part_code as partCode, a.stock_qty as stockQty, a.outable_qty as outableQty, 
		        b.short_name as compShortName, b.name as compName, c.name as storeName
		from pj_part_store_stock a
		inner join wb_common.com_company b
		on a.orgid = b.orgid
		inner join wb_common.com_store c
		on a.store_id = c.id
		where b.tenant_id = #tenantId# and a.part_id = #partId# and a.outable_qty &gt; 0
		order by a.orgid</select>
    <select id="queryChainStockList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			b.short_name as shortName,
			a.store_id as storeId,
			a.part_id as partId,
			a.outable_qty as outableQty,
			c.sell_price as sellPrice,
			b.manager as manager,
			b.mobile as mobile,
			b.contactor as contactor,
			b.contactor_tel as contactorTel,
			b.addr as address,
			e.id as partId,
      		e.`code` as partCode,
			e.name as partName,
	    	e.part_brand_id as partBrandId,
			e.quality_type_id as qualityTypeId,
			e.unit as unit,
			e.apply_car_model as applyCarModel,
			e.full_name as fullName
		FROM
		pj_part_store_stock a
		inner join wb_common.com_guest b
		on a.orgid = b.is_internal_id
		left join pj_part_price c
		on a.part_id = c.part_id and a.orgid = c.orgid
		inner join wb_common.com_attribute e
		on a.part_id = e.id
		WHERE 1 = 1
				
		<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid != #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(a.store_id = #storeId#)</isNotEmpty>
            <!--库存查询默认查询库存大于0 -->
            <isNotEmpty prepend="and" property="notShowAll">(a.outable_qty &gt; 0)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(a.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(e.code = #partCode#)</isNotEmpty>
            <isNotEmpty prepend="and" property="commonId">(e.common_id = #commonId#)</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjStockShiftMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			a.orgid as orgid,
			a.order_man as orderMan,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.creator as creator,
			a.create_date as createDate,
			a.remark as mainRemark,
			a.store_id as storeId,
	    	a.receive_store_id as receiveStoreId,
			b.id as detailId,
			b.main_id as mainId,
			b.receive_store_shelf as receiveStoreShelf,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.out_unit_id as outUnitId,
			b.system_unit_id as systemUnitId,
			b.order_qty as orderQty,
			b.order_price as orderPrice,
			b.order_amt as orderAmt,
			b.remark as detailRemark,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			c.org_car_brand_id as orgCarBrandId,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
		pj_stock_shift_main a 
		inner join pj_stock_shift_detail b 
			 on a.id = b.main_id 
		inner join wb_common.com_attribute c 
			 on b.part_id = c.id
		inner join wb_common.com_guest d 
			 on a.guest_id = d.id
		where a.audit_sign = 1
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(a.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="receiveStoreId">(a.receive_store_shelf = #receiveStoreId#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOrderDate">A.CREATE_DATE &gt;= #sOrderDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOrderDate">(A.CREATE_DATE &lt; #eOrderDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(c.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjPackListByBillMainId" parameterClass="java.util.HashMap" resultClass="commonj.sdo.DataObject">
		SELECT
			id AS id,
			main_id AS mainId,
			bill_main_id AS billMainId,
			bill_service_id AS billServiceId,
			bill_amt AS billAmt,
			order_man AS orderMan,
			bill_date AS billDate,
			remark AS remark
		FROM
			pj_pack_detail
		WHERE 1=1 
		<dynamic>
            <isNotEmpty prepend="and" property="billMainId">main_id = (SELECT main_id FROM pj_pack_detail WHERE bill_main_id = #billMainId#)</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryPjStockCheckMainDetailList" parameterMap="parameterMap" resultClass="commonj.sdo.DataObject">
		SELECT
			a.service_id as serviceId,
			a.orgid as orgid,
			a.order_man as orderMan,
			a.auditor as auditor,
			a.audit_date as auditDate,
			a.creator as creator,
			a.create_date as createDate,
			a.remark as mainRemark,
			a.store_id as storeId,
			b.id as detailId,
			b.main_id as mainId,
			b.part_id as partId,
			b.part_code as partCode,
			b.part_name as partName,
			b.full_name as fullName,
			b.enter_unit_id as enterUnitId,
			b.system_unit_id as systemUnitId,
			b.sys_qty as sysQty,
			b.sys_price as sysPrice,
			b.sys_amt as sysAmt,
			b.true_qty as trueQty,
			b.true_price as truePrice,
			b.true_amt as trueAmt,
			b.exhibit_qty as exhibitQty,
			b.exhibit_price as exhibitPrice,
			b.exhibit_amt as exhibitAmt,
			b.dc as dc,
			b.remark as detailRemark,
			c.`code` as comPartCode,
			c.`name` as comPartName,
			c.full_name as comPartFullName,
			c.brand_code as comBrandCode,
			c.oem_code as comOemCode,
			c.quality_type_id as qualityTypeId,
			c.part_brand_id as partBrandId,
			c.apply_car_model as applyCarModel,
			c.apply_carbrand_id as applyCarbrandId,
			c.spec as spec,
			c.org_car_brand_id as orgCarBrandId,
			d.full_name as guestFullName,
			d.short_name as guestShortName
		FROM
		pj_stock_check_main a 
		inner join pj_stock_check_detail b 
			 on a.id = b.main_id 
		inner join wb_common.com_attribute c 
			 on b.part_id = c.id
		inner join wb_common.com_guest d 
			 on a.guest_id = d.id
		where a.audit_sign = 1
				
			<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(a.store_id = #storeId#)</isNotEmpty>
            <!--订货日期 -->
            <isNotEmpty prepend="and" property="sOrderDate">A.CREATE_DATE &gt;= #sOrderDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="eOrderDate">(A.CREATE_DATE &lt; #eOrderDate#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.AUDIT_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.AUDIT_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orgCarBrandId">(c.org_car_brand_id = #orgCarBrandId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partId">(b.PART_ID = #partId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderMan">(A.order_man = #orderMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="partName">(c.FULL_NAME like '%$partName$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partNameAndPY">(c.FULL_NAME like '%$partNameAndPY$%' or c.name_py like '%$partNameAndPY$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="partCode">(c.query_code like '%$partCode$%' or c.code like '%$partCode$%')</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(A.service_id = #serviceId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(a.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="partCodeList">(c.code in ($partCodeList$))</isNotEmpty>
            <isNotEmpty prepend="order by" property="sortField">$sortField$ $sortOrder$</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryNotFinishOrder" parameterClass="java.util.HashMap" resultClass="commonj.sdo.DataObject">
    	SELECT
			a.id as id,
			b.service_id as serviceId,
		  	a.main_id as mainId,
			a.store_id as storeId,
			a.part_code as partCode,
			a.part_name as partName,
			a.order_qty as orderQty,
			a.true_enter_qty as trueEnterQty,
			a.adjust_qty as adjustQty,
			a.is_finished as isFinished,
			b.create_date as createDate
		FROM
			pj_pchs_order_detail_chk a
			INNER JOIN pj_pchs_order_main_chk b on b.id =a.main_id
		WHERE
			a.is_finished = 0
		AND (
			a.order_qty - a.true_enter_qty - a.adjust_qty
		) &gt; 0
		<dynamic>
            <isNotEmpty prepend="and" property="orgid">(b.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="orderTypeId">(b.order_type_id= #orderTypeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="sOrderDate">b.CREATE_DATE &gt;= #sOrderDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="sOrderDate">(b.CREATE_DATE &lt; #eOrderDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceId">(b.service_id = #serviceId#)</isNotEmpty>
            order by  b.create_date DESC
        </dynamic>
    </select>
    <select id="queryTrueEnterQty" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    	SELECT
			sum(true_enter_qty) trueEnterQty
		FROM
			pj_pchs_order_detail_chk
		WHERE
			1=1 
		<dynamic>
            <isNotEmpty prepend="and" property="sourceDetailId">source_detail_id = #sourceDetailId#</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryNeedQty" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">   	
		SELECT
			(order_qty-adjust_qty) as needQty,
			order_qty as orderQty
		FROM
			pj_pchs_order_detail_chk
		WHERE 1=1
		<dynamic>
            <isNotEmpty prepend="and" property="id">id = #id#</isNotEmpty>
        </dynamic>
    </select>
    <select id="queryMainIsFinish" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">SELECT
			id
		FROM
			pj_pchs_order_detail_chk
		WHERE
			is_finished = 0
           	and main_id = #mainId#</select>
    <select id="queryPchsPlanMainIsFinish" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">SELECT
			id
		FROM
			pj_pchs_plan_detail
		WHERE
			is_finished = 0
           	and main_id = #mainId#</select>
    <select id="queryAllotApplyMainIsFinish" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">SELECT
			id
		FROM
			pj_allot_apply_detail
		WHERE
			is_finished = 0
           	and main_id = #mainId#</select>
    <select id="querySellMainIsFinish" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">SELECT
			id
		FROM
			pj_sell_order_detail_chk
		WHERE
			is_finished = 0
           	and main_id = #mainId#</select>
    <select id="queryAllotApplyMainIsAllotFinish" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">SELECT
			id
		FROM
			pj_allot_apply_detail
		WHERE
			is_allot_finished = 0
           	and main_id = #mainId#</select>
    <select id="queryPackInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    	SELECT a.service_id as serviceId, a.logistics_no as logisticsNo, a.logistics_guest_id as logisticsGuestId, 
    	       a.logistics_name as logisticsName, 
		       a.guest_id as guestId, a.guest_name as guestName, a.pack_man as packMan,
			   case when a.pay_type = '051301' then '到付' else '现付' end as payType, 
		       case when a.settle_type_id = '020501' then '现结' else '月结' end as settleTypeId, 
			   a.pack_item as packItem, a.pack_pay_amt as packPayAmt, 
			   a.collect_money as collectMoney, a.valuation_statement as valuationStatement,
			   a.remark, a.creator, a.create_date as createDate, 
			   a.audit_date as auditDate, a.operator, a.operate_date as operateDate,
			   b.bill_service_id as billServiceId, b.order_man as orderMan, b.bill_date as billDate, 
			   b.remark as billRemark
		from pj_pack_main a
		inner join pj_pack_detail b
		on a.id = b.main_id
		where a.audit_sign = 1
		<dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="startDate">a.CREATE_DATE &gt;= #startDate#</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(a.CREATE_DATE &lt; #endDate#)</isNotEmpty>
            order by  a.create_date DESC
        </dynamic>
    </select>
    <!--打包发货界面  根据业务单号，发货单号，客户，创建日期，审核日期查询-->
    <select id="queryPjPackMainList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
			SELECT
				a.id,
				a.service_id as serviceId,
				a.orgid,
				a.logistics_guest_id as logisticsGuestId,
				a.logistics_name as logisticsName,
				a.logistics_no as logisticsNo,
				a.guest_id as guestId,
				a.guest_name as guestName,
				a.receive_comp_name as receiveCompName,
				a.receive_man as receiveMan,
				a.receive_man_tel as receiveManTel,
				a.settle_type_id as settleTypeId,
				a.pack_man as packMan,
				a.pack_pay_amt as packPayAmt,
				a.arrive_pay_amt as arrivePayAmt,
				a.true_pay_amt as truePayAmt,
				a.pack_item as packItem,
				a.audit_sign as auditSign,
				a.auditor_id as auditorId,
				a.auditor,
				a.audit_date as auditDate, 
				a.remark as remark,
				a.creator_id as creatorId,
				a.creator,
				a.create_date as createDate,
				a.operator_id as operatorId,
				a.operator,
				a.operate_date as operateDate,
				a.f_year as fYear,
				a.f_month as fMonth,
				a.province_id as provinceId,
				a.city_id as cityId,
				a.county_id as countyId,
				a.street_address as streetAddress,
				a.address,
				a.destination_station as destinationStation,
				a.transfer_station as transferStation,
				a.transit_logistics_id as transitLogisticsId,
				a.transit_logistics_name as transitLogisticsName,
				a.pay_type as payType,
				a.is_wooden as isWooden,
				a.collect_money as collectMoney,
				a.valuation_statement as valuationStatement,
				a.sender_city as senderCity,
				a.id_no as idNo,
				a.sender_phone as senderPhone,
				a.sender_address as senderAddress,
				a.bill_status_id as billStatusId,
				a.arrive_date as arriveDate,
				a.is_voucher as isVoucher,
				a.voucher_id as voucherId,
				a.store_id as storeId,
				a.pack_type as packType,
				b.full_name as guestFullName,
				b.short_name as guestShortName
				FROM
				dms_cloud_part.pj_pack_main AS a
				INNER JOIN wb_common.com_guest AS b ON a.guest_id = b.id

                where 1=1
            <dynamic>
            <isNotEmpty prepend="and" property="orgid">(a.orgid = #orgid#)</isNotEmpty>
            <isNotEmpty prepend="and" property="id">(a.id = #id#)</isNotEmpty>
            <!--创建日期 -->
            <isNotEmpty prepend="and" property="sCreateDate">(A.CREATE_DATE &gt;= #sCreateDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eCreateDate">(A.CREATE_DATE &lt; #eCreateDate#)</isNotEmpty>
            <!--审核日期 -->
            <isNotEmpty prepend="and" property="sAuditDate">(A.AUDIT_DATE &gt;= #sAuditDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="eAuditDate">(A.AUDIT_DATE &lt; #eAuditDate#)</isNotEmpty>
            <!--本日 昨日 本周 上周 本月 下月 -->
            <isNotEmpty prepend="and" property="startDate">(A.CREATE_DATE &gt;= #startDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="endDate">(A.CREATE_DATE &lt; #endDate#)</isNotEmpty>
            <isNotEmpty prepend="and" property="guestId">(A.guest_id = #guestId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="auditSign">(A.AUDIT_SIGN = #auditSign#)</isNotEmpty>
            <isNotEmpty prepend="and" property="serviceIdList">(A.service_id in ($serviceIdList$))</isNotEmpty>
            <isNotEmpty prepend="and" property="packMan">(a.pack_man = #packMan#)</isNotEmpty>
            <isNotEmpty prepend="and" property="storeId">(a.store_id = #storeId#)</isNotEmpty>
            <isNotEmpty prepend="and" property="packType">(a.pack_type = #packType#)</isNotEmpty>
            <isNotEmpty prepend="and" property="billSign">  
                   exists (
                   		select * from pj_pack_detail c 
                   		where a.id = c.main_id 
                   		<isNotEmpty prepend="and" property="billServiceId">(c.bill_service_id = #billServiceId#)</isNotEmpty>
                <isNotEmpty prepend="and" property="billOrderNo">(c.bill_order_code = #billOrderNo#)</isNotEmpty>
                   )
                </isNotEmpty>
            <isNotEmpty prepend="and" property="expenseSign">  
                   exists (
                   		select * from pj_bill_expense_record d 
                   		where a.service_id = d.bill_service_id 
                   		
			                 <isNotEmpty prepend="and" property="logisticsGuestId">(d.logistics_guest_id = #logisticsGuestId#)</isNotEmpty>
                <isNotEmpty prepend="and" property="logisticsNo">(d.logistics_no like '%$logisticsNo$%')</isNotEmpty>
			                
                   )
                </isNotEmpty>
        </dynamic>  
    	
        ORDER BY a.operate_date DESC
    </select>
</sqlMap>