





select *
from pj_part_store_stock m
inner join 
(SELECT sum(a.outable_qty) as qty, sum(a.outable_qty*a.enter_price) amt, a.part_id as partId, a.store_id as storeId 
from pj_enter_detail_chk a
inner join pj_enter_main_chk b
on a.main_id = b.id
where b.orgid = 84
group by a.part_id, a.store_id
) n
on m.part_id = n.partId and m.store_id = n.storeId
where m.orgid = 84 and m.stock_qty != n.qty


update pj_part_store_stock m
inner join 
(SELECT sum(a.outable_qty) as qty, sum(a.outable_qty*a.enter_price) amt, a.part_id as partId, a.store_id as storeId 
from pj_enter_detail_chk a
inner join pj_enter_main_chk b
on a.main_id = b.id
where b.orgid = 84
group by a.part_id, a.store_id
) n
on m.part_id = n.partId and m.store_id = n.storeId
set m.stock_qty = n.qty
where m.orgid = 84 and m.stock_qty != n.qty



update pj_part_stock m
inner join 
(SELECT sum(a.stock_qty) as qty, sum(a.stock_amt) amt, a.part_id as partId, a.orgid as orgid
from pj_part_store_stock a
where a.orgid = 101 
group by a.part_id, a.orgid
) n
on m.part_id = n.partId and m.orgid = n.orgid
set m.stock_qty = n.qty, m.stock_amt = n.amt, m.cost_price = case when n.qty = 0 then 0 else n.amt/n.qty end
where m.orgid = 101 and m.stock_qty != n.qty


















