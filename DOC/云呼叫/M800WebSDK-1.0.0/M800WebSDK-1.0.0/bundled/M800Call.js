!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.M800Call=t():e.M800Call=t()}("undefined"!=typeof self?self:this,function(){return webpackJsonpM800_name_([1],{139:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ANSWERED="answered",t.CANCELLED="cancelled",t.DECLINED="declined",t.MISSED="missed",t.REJECTED="rejected",t.TERMINATED="terminated",t.TIMEOUT="timeout",t.FAILED="failed",t.NO_ACCESS="no-access"},211:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.INCOMING="incoming",t.OUTGOING="outgoing"},212:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.INCOMING_CALL="incoming-call",t.OUTGOING_CALL="outgoing-call",t.STATE_CHANGED="state-changed",t.MUTE_STATE_CHANGED="mute-state-changed",t.CALL_ENDED="call-ended",t.CALL_MISSED="call-missed",t.CALL_CREATION_FAILED="call-creation-failed",t.ERROR="error"},213:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RINGING="ringing",t.CONNECTING="connecting",t.TALKING="talking",t.ENDED="ended",t.LOCAL_HELD="local-held",t.REMOTE_HELD="remote-held"},214:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WEBRTC_ERROR=400},343:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NO_CREDIT="no-credit",t.NO_ACCESS="no-mic-access",t.USER_DEACTIVATED="user-deactivated",t.UNKNOWN="unknown"},344:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BUSY="busy",t.NO_ACCESS="callee has no access to the required hardware"},345:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DO_REGISTER=!1},346:function(e,t,i){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0});var o,u,c,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},h=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),d=i(4),p=s(d),f=i(727),g=s(f),m=i(6),T=s(m),v=i(12),_=s(v),E=i(343),S=r(E),C=i(94),y=r(C),A=i(212),R=r(A),b=i(347),I=r(b),w=i(213),D=r(w),O=i(80),N=r(O),U=i(139),$=r(U),k=i(214),x=r(k),M=i(0),H=(o={},a(o,N.INCOMING,D.RINGING),a(o,N.CONNECTING,D.CONNECTING),a(o,N.ACTIVE,D.TALKING),a(o,N.ENDED,D.ENDED),o),P=(u={},a(u,$.ANSWERED,I.ANSWERED),a(u,$.MISSED,I.MISSED),a(u,$.TIMEOUT,I.NO_ANSWER),a(u,$.REJECTED,I.REJECTED),a(u,$.DECLINED,I.REJECTED),a(u,$.TERMINATED,I.HUNG_UP),a(u,$.CANCELLED,I.CANCELLED),a(u,$.FAILED,I.ERROR),a(u,$.NO_ACCESS,I.ERROR),u),L=(c={},a(c,$.FAILED,S.UNKNOWN),a(c,$.NO_ACCESS,S.NO_ACCESS),c),q=function(){function e(t,i){n(this,e),(0,p.default)(this),this._callService=t,this._metadata=i,this._id=this._metadata.id,this._uri=this._metadata.uri,this._isMuted=!!this._metadata.isMuted,this._hold=l({},this._metadata.hold),this._state=this._metadata.state,this._callTimeInfo={startTime:this._metadata.startTime||null,connectedTime:this._metadata.connectedTime||null,endTime:this._metadata.endTime||null},this._setupEventHandlers()}return h(e,[{key:"answer",value:function(){this._callService.answerCall(this._uri)}},{key:"end",value:function(e){this._callService.endCall(this._uri,e)}},{key:"setMute",value:function(e){(0,T.default)("mute",e,g.default,"Expect boolean for mute state"),this._validateCallState(D.TALKING,D.LOCAL_HELD,D.REMOTE_HELD);var t=e?"mute":"unmute";this._callService[t](this._uri),this._isMuted=e}},{key:"isMuted",value:function(){return this._isMuted}},{key:"setHold",value:function(e){(0,T.default)("hold",e,g.default,"Expect boolean for hold state"),this._validateCallState(D.TALKING,D.LOCAL_HELD,D.REMOTE_HELD);var t=e?"hold":"unhold";this._callService[t](this._uri)}},{key:"isOnHold",value:function(){return this._hold.local}},{key:"getId",value:function(){return this._id}},{key:"getUri",value:function(){return this._uri}},{key:"getState",value:function(){return this._state}},{key:"getCallSessionResult",value:function(){return this._callResult}},{key:"getCallTimeInformation",value:function(){var e=this._callTimeInfo.endTime||Date.now(),t=this._callTimeInfo.connectedTime,i=t?(e-t)/1e3:null;return l({},this._callTimeInfo,{elapsedTime:i})}},{key:"deinit",value:function(){this._clearCallServiceHandler()}},{key:"_validateCallState",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!t.includes(this._state))throw new M.InvalidOperationError('Expected "'+t.join("/")+'" call session state, but got "'+this._state+'".')}},{key:"_clearCallServiceHandler",value:function(){this._callServiceEventHandler&&(this._callServiceEventHandler.reset(),this._callServiceEventHandler=null)}},{key:"_setupEventHandlers",value:function(){var e=this;this._callServiceEventHandler=new _.default(this._callService),this._callServiceEventHandler.add(y.STATUS_UPDATED,function(t){var i=t.id,r=t.jid,s=t.status,n=t.endCause,a=t.endContext,o=t.startTime,u=t.connectedTime,c=t.endTime;if((i||r)===e._id){var l=e._state,h=H[s];e._setState(h),e._callTimeInfo={startTime:o,connectedTime:u||null,endTime:c||null};var d=P[n],p=void 0;switch(d){case I.ERROR:p=L[n]||S.UNKNOWN;break;case I.REJECTED:p=a}switch(h){case D.ENDED:var f={context:p,type:d};e._callResult=f}e.emit(R.STATE_CHANGED,e,l,h)}}),this._callServiceEventHandler.add(y.MUTE_STATUS_UPDATED,function(t){var i=t.id,r=t.jid,s=t.isMuted;(i||r)===e._id&&(e._isMuted=s,e.emit(R.MUTE_STATE_CHANGED,e,e.isMuted()))}),this._callServiceEventHandler.add(y.HOLD_STATUS_UPDATED,function(t){e._hold=l({},t.hold);var i=void 0;i=t.hold.local?D.LOCAL_HELD:t.hold.remote?D.REMOTE_HELD:D.TALKING;var r=e._state;e._setState(i),e.emit(R.STATE_CHANGED,e,r,i)}),this._callServiceEventHandler.add(y.ERROR,function(t){var i=t.uri,r=t.error,s=t.callDirection;i===e.getUri()&&r.code===x.WEBRTC_ERROR&&e.emit(R.ERROR,{uri:i,code:r.code,message:r.message,callDirection:s})})}},{key:"_setState",value:function(e){this._state=e}}]),e}();t.default=q,e.exports=t.default},347:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ANSWERED="answered",t.HUNG_UP="hung-up",t.REJECTED="rejected",t.CANCELLED="cancelled",t.MISSED="missed",t.NO_ANSWER="no-answer",t.ERROR="error"},348:function(e,t,i){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){var i={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r]);return i}function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function u(e){var t,i=(t={},o(t,E.INCOMING,v.RINGING),o(t,E.CONNECTING,v.CONNECTING),o(t,E.ACTIVE,v.TALKING),o(t,E.ENDED,v.ENDED),t),r=e.status,s=e.jid,n=a(e,["status","jid"]),u=e.id||e.jid;return l({},n,{id:u,uri:s,state:i[r]})}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},h=i(4),d=s(h),p=i(12),f=s(p),g=i(346),m=s(g),T=i(213),v=r(T),_=i(80),E=r(_),S=i(94),C=r(S),y=i(347),A=r(y),R=i(212),b=r(R),I=i(211),w=r(I),D=function(){function e(t,i){n(this,e),(0,d.default)(this),this._callService=t,this._iceProviderRegistry=i,this._activeCallSession=null,this._callSessions=new Map,this._callSessionEventHandlers=new Map,this._callSessionStateChangedHandler=this._callSessionStateChangedHandler.bind(this),this._setupEventHandlers(),this._restoreCallSessions()}return c(e,[{key:"makeCall",value:function(e){this._callService.makeCall(e)}},{key:"getCallSessions",value:function(){return Array.from(this._callSessions.values())}},{key:"getTalkingCallSession",value:function(){return this._activeCallSession}},{key:"getCallSessionById",value:function(e){return this._callSessions.get(e)}},{key:"getICEProviderRegistry",value:function(){return this._iceProviderRegistry}},{key:"deinit",value:function(){this._callEventHandlers&&(this._callEventHandlers.reset(),this._callEventHandlers=null),this._callSessions.forEach(function(e){return e.deinit()}),this._callSessions.clear(),this._callSessionEventHandlers.forEach(function(e){return e.reset()}),this._callSessionEventHandlers.clear()}},{key:"_setupEventHandlers",value:function(){var e=this;this._callEventHandlers=new f.default(this._callService),this._callEventHandlers.add(C.CALL_ENDED,function(t){var i=t.jid,r=e.getCallSessionById(i);e.emit(b.CALL_ENDED,r),e._callSessions.get(i).deinit(),e._callSessions.delete(i),e._callSessionEventHandlers.get(i).reset(),e._callSessionEventHandlers.delete(i)}),this._callEventHandlers.add(C.INCOMING_CALL,function(t){var i=e._initCallSession(t);e.emit(b.INCOMING_CALL,i)}),this._callEventHandlers.add(C.OUTGOING_CALL,function(t){var i=e._initCallSession(t);e.emit(b.OUTGOING_CALL,i)}),this._callEventHandlers.add(C.ERROR,function(t){var i=t.uri,r=t.error,s=t.callDirection;s!==w.INCOMING&&e.emit(b.CALL_CREATION_FAILED,{uri:i,callDirection:s,code:r.code,message:r.message})})}},{key:"_restoreCallSessions",value:function(){this._callService.getCalls().forEach(this._initCallSession.bind(this))}},{key:"_setupCallSessionEventHandlers",value:function(e){var t=new f.default(e);t.add(b.STATE_CHANGED,this._callSessionStateChangedHandler),this._callSessionEventHandlers.set(e.getId(),t)}},{key:"_initCallSession",value:function(e){var t=this._createCallSession(e);return this._callSessions.set(t.getId(),t),t}},{key:"_createCallSession",value:function(e){var t=u(e),i=new m.default(this._callService,t);return this._setupCallSessionEventHandlers(i),i}},{key:"_callSessionStateChangedHandler",value:function(e,t,i){switch(i){case v.ENDED:var r=e.getCallSessionResult();switch(t===v.TALKING&&(this._activeCallSession=null),r&&r.type){case A.MISSED:this.emit(b.CALL_MISSED,e)}break;case v.TALKING:this._activeCallSession=e;break;case v.LOCAL_HELD:case v.REMOTE_HELD:t===v.TALKING&&(this._activeCallSession=null)}}}]),e}();t.default=D,e.exports=t.default},349:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MAKE_CALL="Call:makeCall",t.ANSWER_CALL="Call:answerCall",t.END_CALL="Call:endCall",t.MUTE="Call:mute",t.UNMUTE="Call:unmute",t.HOLD="Call:hold",t.UNHOLD="Call:unhold"},350:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CALL_OWNER_LEFT="call-owner-left"},723:function(e,t,i){e.exports=i(724)},724:function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){function r(s,n){try{var a=t[s](n),o=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}return r("next")})}}function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=new(Function.prototype.bind.apply(e,[null].concat(n(t),n(i))));return(0,w.isFunction)(r.init)&&r.init(),r}function o(e){return{getICEServers:function(){var t=this;return s(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e);case 1:case"end":return t.stop()}},i,t)}))()}}}function u(e){return{getICEServers:function(){var t=this;return s(regeneratorRuntime.mark(function i(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:if(r=t.sent,!(0,w.isArray)(r)){t.next=5;break}return t.abrupt("return",r);case 5:return t.abrupt("return",[r]);case 6:case"end":return t.stop()}},i,t)}))()}}}function c(e,t){(0,w.isString)(t)?e.addProvider(o([{urls:t}])):(0,w.isFunction)(t)?e.addProvider(u(t)):t.urls&&e.addProvider(o([t]))}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},h=i(87),d=i(725),p=r(d),f=i(728),g=r(f),m=i(730),T=r(m),v=i(348),_=r(v),E=i(731),S=r(E),C=i(734),y=r(C),A=i(735),R=r(A),b=i(739),I=r(b),w=i(10);t.default=l({},p.default,{version:h.version,name:"call",getModuleDefinitions:function(e){var t=e.applicationIdentifier,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{call:{deps:["service.call","iceProviderRegistry"],factory:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(_.default,t)}},"service.call.executor":{deps:["account","call.notification.service","storage.call","iceProviderRegistry"],factory:function(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];var n=i.sipHeadersModifier,o={applicationIdentifier:t,wsServers:i.callServers,iceCheckingTimeout:i.iceCheckingTimeout,sipHeadersModifier:n};return a(R.default,r,[o])}},"call.notification.service":{deps:["service.notification"],factory:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(S.default,t)}},"service.call":{deps:["tab","service.call.executor","storage.call","callOwner"],factory:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(y.default,t)}},"storage.call":{deps:["tab"],factory:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(g.default,t)}},callOwner:{deps:["tab"],factory:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(T.default,t)}},iceProviderRegistry:{deps:[],factory:function(){var e=new I.default,t=i.iceServers;return t&&((0,w.isArray)(t)?t.forEach(function(t){c(e,t)}):c(e,t)),e}}}}}),e.exports=t.default},725:function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n=i(726),a=r(n),o=i(346),u=r(o),c=i(348),l=r(c);t.default=s({constants:a.default},a.default,{CallSession:u.default,CallSessionManager:l.default}),e.exports=t.default},726:function(e,t,i){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0});var s=i(211),n=r(s),a=i(343),o=r(a),u=i(94),c=r(u),l=i(212),h=r(l),d=i(213),p=r(d),f=i(80),g=r(f),m=i(139),T=r(m),v=i(214),_=r(v),E=i(344),S=r(E),C=i(345),y=r(C);t.default={CallDirection:n,CallError:o,CallEvent:c,CallSessionEvent:h,CallState:p,CallStatus:g,EndCause:T,ErrorCode:_,rejectReason:S,setting:y},e.exports=t.default},727:function(e,t,i){function r(e){return!0===e||!1===e||n(e)&&s(e)==a}var s=i(31),n=i(19),a="[object Boolean]";e.exports=r},728:function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i(4),o=r(a),u=i(12),c=r(u),l=i(11),h=i(729),d=i(14),p=i(35),f=r(p),g=i(47),m=(0,f.default)(localStorage),T=(0,g.generateKey)(d.CALL_STATES+"~states"),v=function(){function e(t){s(this,e),(0,o.default)(this),this._tabMgr=t,this._setupTabEventListeners()}return n(e,[{key:"getCalls",value:function(){var e=m.getItem(d.CALL_STATES);return e?JSON.parse((0,g.decrypt)(e,T)):{}}},{key:"getCall",value:function(e){return this.getCalls()[e]||null}},{key:"setCall",value:function(e,t){var i=this.getCalls(),r=i[e]?"updated":"added";i[e]=t,this._setCallStates(i),this._notifyUpdated(r,{id:e,state:t})}},{key:"unsetCall",value:function(e){var t=this.getCalls();delete t[e],this._setCallStates(t),this._notifyUpdated("removed",{id:e})}},{key:"clearCalls",value:function(){m.removeItem(d.CALL_STATES),this._notifyUpdated("cleared")}},{key:"_setupTabEventListeners",value:function(){this._tabMgrEventHandlers=new c.default(this._tabMgr),this._tabMgrEventHandlers.add(l.MESSAGE_RECEIVED,this._handleMessage.bind(this))}},{key:"_handleMessage",value:function(e){var t=e.origin,i=e.data,r=i.event,s=i.payload;t!==this._tabMgr.getId()&&"CallStorage:call-states-updated"===r&&this.emit(h.CALL_STATES_UPDATED,s)}},{key:"_setCallStates",value:function(e){var t=(0,g.encrypt)(JSON.stringify(e),T);m.setItem(d.CALL_STATES,t)}},{key:"_notifyUpdated",value:function(e,t){var i={type:e,data:t};this.emit(h.CALL_STATES_UPDATED,i),this._tabMgr.broadcastMessage({event:"CallStorage:call-states-updated",payload:i})}}]),e}();t.default=v,e.exports=t.default},729:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CALL_STATES_UPDATED="call-states-updated"},730:function(e,t,i){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){var i=[],r=!0,s=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){s=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(s)throw n}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},c=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),l=i(4),h=s(l),d=i(12),p=s(d),f=i(11),g=i(14),m=i(349),T=r(m),v=i(80),_=r(v),E=i(350),S=i(0),C=i(35),y=s(C),A=i(47),R=(0,y.default)(localStorage),b=(0,A.generateKey)(g.CALL_OWNERS+"~tabIds"),I=[T.MAKE_CALL,T.ANSWER_CALL],w=function(){function e(t){a(this,e),(0,h.default)(this),this._tabMgr=t,this._ownerResolver=this._defaultCallOwnerResolver,this._setupTabEventListeners()}return c(e,[{key:"setOwnerResolver",value:function(e){this._ownerResolver=e}},{key:"resolveOwner",value:function(e){return this._ownerResolver(e)}},{key:"setOwner",value:function(e,t){var i=this.getOwnersMap();i[e]!==t&&this.setOwnersMap(u({},i,n({},e,t)))}},{key:"setOwnersMap",value:function(e){var t=(0,A.encrypt)(JSON.stringify(e),b);R.setItem(g.CALL_OWNERS,t)}},{key:"unsetOwner",value:function(e){var t=this.getOwnersMap();t[e]&&(delete t[e],this.setOwnersMap(t))}},{key:"unsetOwners",value:function(e){var t=this.getOwnersMap(),i=e.filter(function(e){return t[e]});i.length&&(i.forEach(function(e){delete t[e]}),this.setOwnersMap(t))}},{key:"getOwnerTabId",value:function(e){return this.getOwnersMap()[e]}},{key:"getOwnersMap",value:function(){var e=R.getItem(g.CALL_OWNERS);return e?JSON.parse((0,A.decrypt)(e,b)):{}}},{key:"hasOwner",value:function(e){return!!this.getOwnerTabId(e)}},{key:"_setupTabEventListeners",value:function(){this._tabMgrEventHandlers=new p.default(this._tabMgr),this._tabMgrEventHandlers.add(f.PEER_LEFT,this._handleTabLeft.bind(this))}},{key:"_handleTabLeft",value:function(e){var t=e.id;if(this._shouldHandleTabClosed()){var i=Object.entries(this.getOwnersMap()).filter(function(e){return o(e,2)[1]===t}).map(function(e){return o(e,1)[0]});i.length&&this.emit(E.CALL_OWNER_LEFT,{callIds:i})}}},{key:"_shouldHandleTabClosed",value:function(){return this._tabMgr.getParticipants().reduce(function(e,t){var i=t.id;return e&&i>=e?e:i},null)===this._tabMgr.getId()}},{key:"_defaultCallOwnerResolver",value:function(e){var t=e.action,i=e.callId,r=e.status,s=T.END_CALL;if(this.hasOwner(i))return this.getOwnerTabId(i);var n=this._tabMgr.getId();if(I.includes(t))return n;if(t===s&&r===_.INCOMING)return n;throw new S.InvalidOperationError('Invalid call owner state to perform the action "'+t+'"')}}]),e}();t.default=w,e.exports=t.default},731:function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i(4),o=r(a),u=i(313),c=r(u),l=i(272),h=r(l),d=i(732),p=r(d),f=i(733),g=i(126),m=i(3),T=m.LoggerFactory.getInstance(),v=T.getLogger("call/CallNotificationService"),_=function(){function e(t){s(this,e),(0,o.default)(this),this._notificationService=t,this._notificationMap={},this._setupNotificationHandlers()}return n(e,[{key:"_setupNotificationHandlers",value:function(){var e=this;this._notificationService.on(g.NOTIFICATION_RECEIVED,function(t){switch(t.type){case"incoming.call":e._handleIncomingNotification(f.parseIncomingCallNotification,t);break;case"missed.call":e._handleIncomingNotification(f.parseMissedCallNotification,t);break;case"answered.call":e._handleIncomingNotification(f.parseAnsweredCallNotification,t)}})}},{key:"_handleIncomingNotification",value:function(e,t){var i=this,r=e(t),s=r.callId,n=r.caller;if(!s||!n)return void v.warn("Invalid Call Notification! Missing callId or Caller.");if(this._notificationMap[s])return this._notificationMap[s].parsedNotification=(0,p.default)(this._notificationMap[s].parsedNotification,r,function(e,t){return null===e||void 0===e?t:e}),void this._notificationMap[s].handler();var a=(0,c.default)(function(){var e=(0,h.default)(i._notificationMap[s].parsedNotification,function(e){return null===e||void 0===e});i.emit(t.type,e),delete i._notificationMap[s]},500);this._notificationMap[s]={parsedNotification:r,handler:a},this._notificationMap[s].handler()}}]),e}();t.default=_,e.exports=t.default},732:function(e,t,i){var r=i(215),s=i(147),n=s(function(e,t,i,s){r(e,t,i,s)});e.exports=n},733:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseAnsweredCallNotification=t.parseMissedCallNotification=t.parseIncomingCallNotification=void 0;var r=i(199),s=function(e){return e&&e.__esModule?e:{default:e}}(r);t.parseIncomingCallNotification=function(e){var t=(0,s.default)(e);return{callId:t.attr("c"),caller:t.attr("f"),serverId:t.attr("s"),media:t.attr("m"),name:t.attr("n"),"com.maaii.notifications.delivery.control.sound":t.attr("com.maaii.notifications.delivery.control.sound"),"com.maaii.notification.type":t.attr("com.maaii.notification.type")}},t.parseMissedCallNotification=function(e){var t=(0,s.default)(e);return{callId:t.attr("c")||t.attr("callId"),caller:t.attr("f")||t.attr("caller"),media:t.attr("m"),"com.maaii.notifications.delivery.control.sound":t.attr("com.maaii.notifications.delivery.control.sound"),"com.maaii.notifications.delivery.control.badge":t.attr("com.maaii.notifications.delivery.control.badge"),"com.maaii.notification.type":t.attr("com.maaii.notification.type")}},t.parseAnsweredCallNotification=function(e){var t=(0,s.default)(e);return{callId:t.attr("c")||t.attr("callId"),caller:t.attr("f")||t.attr("caller"),media:t.attr("m")}}},734:function(e,t,i){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},c=function(){function e(e,t){var i=[],r=!0,s=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){s=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(s)throw n}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),h=i(4),d=s(h),p=i(12),f=s(p),g=i(10),m=i(350),T=i(94),v=r(T),_=i(80),E=r(_),S=i(349),C=r(S),y=i(139),A=r(y),R=i(11),b=function(){function e(t,i,r,s){o(this,e),(0,d.default)(this),this._tabMgr=t,this._callService=i,this._callStorage=r,this._ownerCtrl=s,this._init()}return l(e,[{key:"_init",value:function(){var e,t;this._callStates={},this._tabId=this._tabMgr.getId(),this._eventHandlerMap=(e={},a(e,"Call:outgoingCall",this._updateCallAndEmitOutgoing.bind(this)),a(e,"Call:incomingCall",this._updateCallAndEmitIncoming.bind(this)),a(e,"Call:callEnded",this._updateCallAndEmitCallEnded.bind(this)),a(e,"Call:statusUpdated",this._updateCallAndEmitStatusUpdated.bind(this)),a(e,"Call:muteStatusUpdated",this._updateCallAndEmitMuteStatusUpdated.bind(this)),a(e,"Call:holdStatusUpdated",this._updateCallAndEmitHoldStatusUpdated.bind(this)),a(e,"Call:error",this._updateCallAndEmitError.bind(this)),e),this._actionHandlerMap=(t={},a(t,C.MAKE_CALL,this.makeCall.bind(this)),a(t,C.ANSWER_CALL,this.answerCall.bind(this)),a(t,C.END_CALL,this.endCall.bind(this)),a(t,C.MUTE,this.mute.bind(this)),a(t,C.UNMUTE,this.unmute.bind(this)),a(t,C.HOLD,this.hold.bind(this)),a(t,C.UNHOLD,this.unhold.bind(this)),t),this._setupTabEventListeners(),this._setupCallOwnerEventListeners(),this._setupCallServiceEventListeners(),this._synchronizeCalls()}},{key:"_synchronizeCalls",value:function(){var e=this,t=this._tabMgr.getParticipants().map(function(e){return e.id});if(t.length>1)return void this._restoreCallStates();var i=Object.entries(this._ownerCtrl.getOwnersMap()).filter(function(e){var i=c(e,2),r=i[1];return t.includes(r)}),r=i.map(function(e){return c(e,1)[0]}),s=this._callStorage.getCalls(),n=Object.entries(s).reduce(function(e,t){var i=c(t,2),s=i[0],n=i[1];return r.includes(s)?u({},e,a({},s,n)):e},{});this._setCallStates(n),Object.entries(n).map(function(t){var i=c(t,2),r=i[0],s=i[1];return e._setCallStateToStorage(r,s)});var o=i.reduce(function(e,t){var i=c(t,2),r=i[0],s=i[1];return u({},e,a({},r,s))},{});this._ownerCtrl.setOwnersMap(o)}},{key:"_restoreCallStates",value:function(){var e=this._callStorage.getCalls();this._setCallStates(e)}},{key:"makeCall",value:function(e){var t=this._callService.makeCall.bind(this._callService),i={callId:e,handler:t};this._performActionOnCallOwner(C.MAKE_CALL,i)}},{key:"answerCall",value:function(e,t){var i=this._callService.answerCall.bind(this._callService),r={callId:e,args:[t],handler:i};this._performActionOnCallOwner(C.ANSWER_CALL,r)}},{key:"endCall",value:function(e,t){var i=this._callService.endCall.bind(this._callService),r={callId:e,args:[t],handler:i};this._performActionOnCallOwner(C.END_CALL,r)}},{key:"mute",value:function(e){var t=this._callService.mute.bind(this._callService),i={callId:e,handler:t};this._performActionOnCallOwner(C.MUTE,i)}},{key:"unmute",value:function(e){var t=this._callService.unmute.bind(this._callService),i={callId:e,handler:t};this._performActionOnCallOwner(C.UNMUTE,i)}},{key:"hold",value:function(e){var t=this._callService.hold.bind(this._callService),i={callId:e,handler:t};this._performActionOnCallOwner(C.HOLD,i)}},{key:"unhold",value:function(e){var t=this._callService.unhold.bind(this._callService),i={callId:e,handler:t};this._performActionOnCallOwner(C.UNHOLD,i)}},{key:"getCalls",value:function(){return Object.values(this._callStates)}},{key:"reset",value:function(){this._callStates={},this._tabMgrEventHandlers.reset(),this._callServiceEventHandlers.reset()}},{key:"_setupTabEventListeners",value:function(){this._tabMgrEventHandlers=new f.default(this._tabMgr),this._tabMgrEventHandlers.add(R.MESSAGE_RECEIVED,this._handleMessage.bind(this))}},{key:"_setupCallOwnerEventListeners",value:function(){this._ownerCtrlEventHandlers=new f.default(this._ownerCtrl),this._ownerCtrlEventHandlers.add(m.CALL_OWNER_LEFT,this._handleCallOwnerLeft.bind(this))}},{key:"_setupCallServiceEventListeners",value:function(){var e=this;this._callServiceEventHandlers=new f.default(this._callService),this._callServiceEventHandlers.add(v.CALL_ENDED,function(t){e._updateCallAndEmitCallEnded(t),e._broadcast("Call:callEnded",t)}),this._callServiceEventHandlers.add(v.OUTGOING_CALL,function(t){e._updateCallAndEmitOutgoing(t),e._broadcast("Call:outgoingCall",t)}),this._callServiceEventHandlers.add(v.INCOMING_CALL,function(t){e._updateCallAndEmitIncoming(t),e._broadcast("Call:incomingCall",t)}),this._callServiceEventHandlers.add(v.STATUS_UPDATED,function(t){var i=t.jid;e._updateCallAndEmitStatusUpdated(t),t.status===E.ENDED&&e._ownerCtrl.unsetOwner(i),e._broadcast("Call:statusUpdated",t)}),this._callServiceEventHandlers.add(v.MUTE_STATUS_UPDATED,function(t){e._updateCallAndEmitMuteStatusUpdated(t),e._broadcast("Call:muteStatusUpdated",t)}),this._callServiceEventHandlers.add(v.HOLD_STATUS_UPDATED,function(t){e._updateCallAndEmitHoldStatusUpdated(t),e._broadcast("Call:holdStatusUpdated",t)}),this._callServiceEventHandlers.add(v.ERROR,function(t){e._updateCallAndEmitError(t),e._broadcast("Call:error",t)})}},{key:"_performActionOnCallOwner",value:function(e,t){var i=t.callId,r=t.handler,s=t.args,a=void 0===s?[]:s,o=this._getCallState(i),u=o&&o.status,c={callId:i,action:e,status:u},l=this._ownerCtrl.resolveOwner(c);if(this._ownerCtrl.setOwner(i,l),l===this._tabId)return void r.apply(void 0,[i].concat(n(a)));var h={action:e,id:i,args:[i].concat(n(a))};this._unicast(h,l)}},{key:"_getCallState",value:function(e){return this._callStates[e]}},{key:"_setCallState",value:function(e,t){this._callStates[e]=t}},{key:"_setCallStates",value:function(e){this._callStates=e}},{key:"_unsetCallState",value:function(e){delete this._callStates[e]}},{key:"_setCallStateToStorage",value:function(e,t){this._callStorage.setCall(e,t)}},{key:"_updateCallAndEmitIncoming",value:function(e){this._setCallState(e.jid,e),this.emit(v.INCOMING_CALL,e)}},{key:"_updateCallAndEmitOutgoing",value:function(e){this._setCallState(e.jid,e),this.emit(v.OUTGOING_CALL,e)}},{key:"_updateCallAndEmitCallEnded",value:function(e){var t=e.jid;this._unsetCallState(t),this.emit(v.CALL_ENDED,e)}},{key:"_updateCallAndEmitStatusUpdated",value:function(e){var t=e.jid;e.status!==E.ENDED&&this._setCallState(t,e),this.emit(v.STATUS_UPDATED,e)}},{key:"_updateCallAndEmitMuteStatusUpdated",value:function(e){this._setCallState(e.jid,e),this.emit(v.MUTE_STATUS_UPDATED,e)}},{key:"_updateCallAndEmitHoldStatusUpdated",value:function(e){this._setCallState(e.jid,e),this.emit(v.HOLD_STATUS_UPDATED,e)}},{key:"_updateCallAndEmitError",value:function(e){this._unsetCallState(e.uri),this.emit(v.ERROR,e)}},{key:"_broadcast",value:function(e,t){this._tabMgr.broadcastMessage({event:e,payload:t})}},{key:"_unicast",value:function(e,t){var i=e.id;(0,g.isString)(t)||(t=this._ownerCtrl.getOwnerTabId(i)),t!==this._tabId&&this._tabMgr.broadcastMessage(e,t)}},{key:"_handleMessage",value:function(e){var t=e.origin,i=e.data,r=i.event,s=i.payload,a=i.action,o=i.args;if(t!==this._tabId){if(r&&this._eventHandlerMap[r])return void this._eventHandlerMap[r](s);if(a&&this._actionHandlerMap[a]){var u;(u=this._actionHandlerMap)[a].apply(u,n(o))}}}},{key:"_handleCallOwnerLeft",value:function(e){var t=this,i=e.callIds;i.length&&(this._ownerCtrl.unsetOwners(i),i.forEach(function(e){var i=u({},t._getCallState(e),{status:E.ENDED,endCause:A.TERMINATED});t._updateCallAndEmitStatusUpdated(i),t._broadcast("Call:statusUpdated",i)}))}}]),e}();t.default=b,e.exports=t.default},735:function(e,t,i){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function a(e,t){var i={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r]);return i}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){function r(s,n){try{var a=t[s](n),o=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}return r("next")})}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t,i){return{to_displayName:t?J.PHONE:J.WEB,to_uri:(0,w.default)(e,i),from_displayName:t?J.WEB:J.PHONE}}function l(){return function(e,t,i,r){V[z[e]](r)}}function h(e){if(!e)return"";var t=e.call_id,i=e.data,r=e.method,s=e.reason_phrase,n=e.status_code,a={call_id:t,data:i,method:r,reason_phrase:s,status_code:n};return JSON.stringify(a)}Object.defineProperty(t,"__esModule",{value:!0});var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},p=function(){function e(e,t){var i=[],r=!0,s=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){s=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(s)throw n}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),g=i(1),m=i(736),T=s(m),v=i(4),_=s(v),E=i(200),S=s(E),C=i(75),y=s(C),A=i(10),R=i(737),b=s(R),I=i(738),w=s(I),D=i(211),O=r(D),N=i(80),U=r(N),$=i(94),k=r($),x=i(139),M=r(x),H=i(214),P=r(H),L=i(344),q=r(L),F=i(0),j=i(87),G=i(46),B=s(G),W=i(3),K=W.LoggerFactory.getInstance(),V=K.getLogger("call/sip/MaaiiCallService"),Y={ACCEPT:"accept",DECLINE:"decline",BUSY:"busy"},J={WEB:"Web",PHONE:"Phone"},Z=T.default.C.causes,z={debug:"debug",log:"debug",warn:"warn",error:"error"},X=function(){function e(){u(this,e),this._idle=!0,this._deferredQueue=[]}return f(e,[{key:"addToQueue",value:function(e){this._deferredQueue.push(e),this._idle&&this.processQueue()}},{key:"processQueue",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this._deferredQueue.length){e.next=2;break}return e.abrupt("return");case 2:return this._idle=!1,t=this._deferredQueue.shift(),i=t.handler,e.next=6,i();case 6:return e.next=8,(0,y.default)(0);case 8:if(0!==this._deferredQueue.length){e.next=11;break}return this._idle=!0,e.abrupt("return");case 11:return e.next=13,this.processQueue();case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"reset",value:function(){this._idle=!0,this._deferredQueue.length=0}}]),e}(),Q=function(){function e(t,i,r){u(this,e),this.element=t,this.pc=i,this.mediaSource=r,this.stream=new MediaStream,this.tracks=[],this.playing=Promise.resolve(),this.attachTracks()}return f(e,[{key:"attachTracks",value:function(){if("remote"===this.mediaSource)this.attachTracksFromEntities(this.pc.getReceivers());else{if("local"!==this.mediaSource)throw new F.ArgumentError("Invalid media source");this.attachTracksFromEntities(this.pc.getSenders(),function(e){return"video"===e.kind})}}},{key:"attachTracksFromEntities",value:function(e,t){var i=this;e.forEach(function(e){return i.attachTrack(e.track,t)}),this.element.srcObject=this.stream}},{key:"attachTrack",value:function(e,t){e&&!this.tracks.includes(e)&&(this.tracks.find(function(t){return t.id===e.id})&&!this.removeDeadTrack(e)||(this.tracks.push(e),t&&!t(e)||this.stream.addTrack(e)))}},{key:"removeDeadTrack",value:function(e){var t=this.tracks.findIndex(function(t){return t.id===e.id});return!(-1===t||!this.tracks[t].muted)&&this.removeTrackByIndex(t)}},{key:"removeTrackByIndex",value:function(e){if(-1===e)return!1;var t=this.tracks.splice(e,1),i=p(t,1),r=i[0];return this.stream.removeTrack(r),!!r}},{key:"play",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.element){e.next=2;break}return e.abrupt("return");case 2:return this.playing=this.element.play().catch(function(e){V.warn("play() was rejected",e.message)}),e.next=5,this.playing;case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"stop",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playing;case 2:this.element.pause(),this.element.srcObject=null;case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"setEnabled",value:function(e){this.tracks.forEach(function(t){t.enabled=e})}}]),e}(),ee=function(){function e(){u(this,e),this.mediaMap=new Map}return f(e,[{key:"addMedia",value:function(e,t,i,r){this.setupSessionEventListeners(e,r);var s=r.sessionDescriptionHandler.peerConnection,n={session:r,localStream:new Q(t,s,"local"),remoteStream:new Q(i,s,"remote")};this.mediaMap.set(e,n),n.localStream.element.volume=0,n.localStream.play(),n.remoteStream.play()}},{key:"removeMedia",value:function(e){var t=this.mediaMap.get(e);t&&(t.localStream&&t.localStream.stop(),t.remoteStream&&t.remoteStream.stop(),this.mediaMap.delete(e))}},{key:"getMedia",value:function(e){return this.mediaMap.get(e)}},{key:"setMute",value:function(e,t){this.mediaMap.get(e).localStream.setEnabled(t)}},{key:"setupSessionEventListeners",value:function(e,t){var i=t.sessionDescriptionHandler.peerConnection;"ontrack"in i?i.addEventListener("track",this.onTrackAdded.bind(this,e)):(V.warn("Using onaddstream which is deprecated"),i.addEventListener("addstream",this.onTrackAdded.bind(this,e)))}},{key:"onTrackAdded",value:function(e){V.info("SDP track added");var t=this.mediaMap.get(e);t.localStream.attachTracks(),t.remoteStream.attachTracks()}}]),e}(),te=function(){function e(t,i,r,s){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};u(this,e),(0,_.default)(this),this._accountManager=t,this._callNotificationService=i,this._callStorage=r,this._iceProviderRegistry=s,this._appId=n.applicationIdentifier,this._wsServers=n.wsServers,this._iceCheckingTimeout=n.iceCheckingTimeout,this._sipHeadersModifier=n.sipHeadersModifier,this._pendingOutgoingCall=new Map,this._sipSessionMap=new Map,this._actionQueue=new X,this._mediaController=new ee,this._logConnector=l(),this._setupCallNotificationHandlers()}return f(e,[{key:"makeCall",value:function(e){var t={type:"makeCall",handler:this._invite.bind(this,e,{outbound:!0})};this._actionQueue.addToQueue(t),this._pendingOutgoingCall.set(e,!0)}},{key:"answerCall",value:function(e,t){var i=d({},t,{jid:e,outbound:!1,status:U.CONNECTING,isMuted:!1,hold:{local:!1,remote:!1},endCause:null});this.emit(k.STATUS_UPDATED,d({},i));var r={type:"answerCall",handler:this._invite.bind(this,e,i)};this._actionQueue.addToQueue(r)}},{key:"endCall",value:function(e,t){var i=this._getCallFromStorage(e);if(!i)throw new F.NotFoundError("The call with "+e+" does not exist");var r=this._sipSessionMap.get(e);switch(i.status){case U.INCOMING:this._rejectCall(e,t);break;case U.CONNECTING:r.cancel();break;case U.ACTIVE:r.bye()}}},{key:"getCalls",value:function(){return this._getAllCallsFromStorage()}},{key:"getCallStatus",value:function(e){var t=this._getCallFromStorage(e);if(!t)throw new F.NotFoundError("The call with "+e+" does not exist");return t.status}},{key:"isMuted",value:function(e){var t=this._getCallFromStorage(e);if(!t)throw new F.NotFoundError("The call with "+e+" does not exist");return t.isMuted}},{key:"isOnHold",value:function(e){var t=this._getCallFromStorage(e);if(!t)throw new F.NotFoundError("The call with "+e+" does not exist");return t.hold.local}},{key:"getHoldState",value:function(e){var t=this._getCallFromStorage(e);if(!t)throw new F.NotFoundError("The call with "+e+" does not exist");return t.hold}},{key:"mute",value:function(e){this._toggleMute(e,!0)}},{key:"unmute",value:function(e){this._toggleMute(e,!1)}},{key:"hold",value:function(e){this._toggleHold(e,!0)}},{key:"unhold",value:function(e){this._toggleHold(e,!1)}},{key:"reset",value:function(){var e=this;this._getAllCallsFromStorage().forEach(function(t){var i=t.jid;e._sipSessionMap.has(i)?e.endCall(i,!0):e._unsetCallFromStorage(i)}),this._sipSessionMap.clear(),this._actionQueue.reset()}},{key:"_setupCallNotificationHandlers",value:function(){var e=this;this._callNotificationService.on("incoming.call",function(t){e._onIncomingCall(t)}),this._callNotificationService.on("missed.call",function(t){e._onMissedCall(t)}),this._callNotificationService.on("answered.call",function(t){e._onAnsweredCall(t)})}},{key:"_getCallFromStorage",value:function(e){return this._callStorage.getCall(e)}},{key:"_getAllCallsFromStorage",value:function(){return Object.values(this._callStorage.getCalls())}},{key:"_setCallToStorage",value:function(e,t){this._callStorage.setCall(e,t)}},{key:"_unsetCallFromStorage",value:function(e){this._callStorage.unsetCall(e)}},{key:"_validateStateTransition",value:function(e){var t=e.jid,i=e.status,r=this._getCallFromStorage(t);return r?r.status!==i:i!==U.ENDED}},{key:"_onIncomingCall",value:function(e){var t=e.caller,i=e.callId,r=a(e,["caller","callId"]);if(!t||!i)return void V.warn("Unexpected incoming call, either caller or call-id is missing.\n        caller: "+t+"; call-id: "+i);var s=d({jid:t,incomingCallId:i,outbound:!1,status:U.INCOMING,isMuted:!1,hold:{local:!1,remote:!1},startTime:Date.now(),endCause:null},r);this._validateStateTransition(s)&&(this._setCallToStorage(t,s),this.emit(k.INCOMING_CALL,s))}},{key:"_onMissedCall",value:function(e){var t=e.caller;this._updateStatus(t,U.ENDED,M.MISSED)}},{key:"_onAnsweredCall",value:function(e){var t=e.caller,i=this._getCallFromStorage(t);if(i)switch(i.status){case U.INCOMING:case U.CONNECTING:case U.IDLE:this._updateStatus(t,U.ENDED,M.ANSWERED)}}},{key:"_onCallMade",value:function(e){var t={jid:e,outbound:!0,status:U.CONNECTING,startTime:Date.now(),isMuted:!1,hold:{local:!1,remote:!1},endCause:null};this._setCallToStorage(e,t),this.emit(k.OUTGOING_CALL,d({},t))}},{key:"_rejectCall",value:function(){function e(e,i){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t,i){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._delegateRejectCall(t,i);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:this._handleSession(t,r);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"_delegateRejectCall",value:function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){var i,r,s,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.BUSY;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._getWakenUserAgent();case 3:return i=e.sent,r=this._getCallFromStorage(t),s=this._prepareBaseInviteOptions(r),s.inviteWithoutSdp=!0,s.extraHeaders.push('X-Call-Action: Reject;cause=603;text="'+a+'"'),s.params=d({},s.params,c(t,r.outbound,i.configuration.hostportParams)),n=i.invite(t,s),this._sipSessionMap.set(t,n),e.abrupt("return",n);case 14:return e.prev=14,e.t0=e.catch(0),V.warn("Failed to reject the call, cannot wake User Agent. ",e.t0.message),this._updateStatus(t,U.ENDED,M.FAILED),this._unsetCallFromStorage(t),this.emit(k.ERROR,{id:t,uri:t,error:e.t0,callDirection:O.INCOMING}),e.abrupt("return",null);case 21:case"end":return e.stop()}},e,this,[[0,14]])}));return e}()},{key:"_invite",value:function(e,t){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.ACCEPT;return this._getWakenUserAgent().then(function(){var s=o(regeneratorRuntime.mark(function s(n){var a,u,l;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=i._getCallFromStorage(e)||d({jid:e},t),r===Y.ACCEPT&&i._prepareDomElements(),s.next=4,i._prepareInviteOptions(a,r);case 4:u=s.sent,u.params=Object.assign({},u.params,c(e,t.outbound,n.configuration.hostportParams)),l=n.invite(e,u,[function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.sdp=t.sdp.replace(/s= /,"s=-"),e.abrupt("return",t);case 2:case"end":return e.stop()}},e,i)}));return function(t){return e.apply(this,arguments)}}()]),i._sipSessionMap.set(e,l),i._handleSession(e,l);case 9:case"end":return s.stop()}},s,i)}));return function(e){return s.apply(this,arguments)}}()).catch(function(t){V.warn("start() failed, unable to wake User Agent",t.message),i._updateStatus(e,U.ENDED,M.FAILED),i._unsetCallFromStorage(e),i.emit(k.ERROR,{id:e,uri:e,error:t,callDirection:O.OUTGOING})})}},{key:"_computeTrackState",value:function(e){return!e.isMuted&&!e.hold.local&&!e.hold.remote}},{key:"_toggleMute",value:function(e,t){var i=this._getCallFromStorage(e),r=this._sipSessionMap.get(e);if(!i||!r)throw new F.NotFoundError("The call with "+e+" does not exist");if(i.status!==U.ACTIVE)throw new F.InvalidOperationError("The call with "+e+" is not active");if(i.isMuted===t)return void V.debug("Call "+i.id+" is already "+(t?"muted":"unmuted")+", skipping action.");i.isMuted=t;var s=this._computeTrackState(i);this._mediaController.setMute(i.jid,s),this._setCallToStorage(i.jid,i),V.debug("Set call "+i.id+" mute status to "+(t?"muted":"unmuted")),this.emit(k.MUTE_STATUS_UPDATED,d({},i))}},{key:"_toggleHold",value:function(e,t){var i=this,r=this._getCallFromStorage(e),s=this._sipSessionMap.get(e);if(!r||!s)throw new F.NotFoundError("The call with "+e+" does not exist");if(r.status!==U.ACTIVE)throw new F.InvalidOperationError("The call with "+e+" is not active");if(t?s.hold({},[function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.hold.remote&&(t.sdp=t.sdp.replace(/a=sendonly\r\n/g,"a=inactive\r\n")),e.abrupt("return",t);case 2:case"end":return e.stop()}},e,i)}));return function(t){return e.apply(this,arguments)}}()]):s.unhold({},[function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.hold.remote&&(t.sdp=t.sdp.replace(/a=sendrecv\r\n/g,"a=recvonly\r\n")),e.abrupt("return",t);case 2:case"end":return e.stop()}},e,i)}));return function(t){return e.apply(this,arguments)}}()]),r.hold.local===t)return void V.debug("Call "+r.id+" is already "+(t?"held":"active")+", skipping action.");r.hold.local=t;var n=this._computeTrackState(r);this._mediaController.setMute(r.jid,n)}},{key:"_getUserAgentWaker",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t,i,r,s,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._accountManager.getJid(),i=g.Strophe.getBareJidFromJid(t),r=this._accountManager.getPassword(),e.next=5,this._resolveICEServers();case 5:return s=e.sent,n={uri:i,password:r,transportOptions:{wsServers:this._wsServers,traceSip:!0},sessionDescriptionHandlerFactoryOptions:{peerConnectionOptions:{iceCheckingTimeout:this._iceCheckingTimeout,rtcConfiguration:{iceServers:s}}},log:{builtinEnabled:!1,level:"debug",connector:this._logConnector},register:!1,autostart:!1},this._uaWaker&&(0,S.default)(n,this._uaConfig)||(this._uaWaker&&this._uaWaker.sleep(),this._uaConfig=n,this._uaWaker=new b.default(new T.default.UA(d({},this._uaConfig)))),e.abrupt("return",this._uaWaker);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"_getWakenUserAgent",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getUserAgentWaker();case 2:return t=e.sent,e.abrupt("return",t.wake());case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"_resolveICEServers",value:function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._iceProviderRegistry.getProviders(),e.next=3,Promise.all(t.map(function(e){return e.getICEServers()}));case 3:return i=e.sent,r=[],i.forEach(function(e){r.push.apply(r,n(e))}),e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"_prepareDomElements",value:function(){this._remoteEle=document.createElement("video"),this._remoteEle.setAttribute("playsInline",""),this._remoteEle.id="remote",this._remoteEle.autoplay=!0,this._remoteEle.width=0,this._remoteEle.height=0,document.body.appendChild(this._remoteEle),this._localEle=document.createElement("video"),this._localEle.setAttribute("playsInline",""),this._localEle.id="local",this._localEle.autoplay=!0,this._localEle.width=0,this._localEle.height=0,document.body.appendChild(this._localEle)}},{key:"_prepareBaseInviteOptions",value:function(e){var t={sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!1}},extraHeaders:["X-DID: "+B.default.uniqueId,"X-AID: "+this._appId,"X-SDK-Version: "+j.version]};if(e.outbound||(t.extraHeaders.push("X-Call-Answer: "+e.incomingCallId),t.extraHeaders.push("webrtc: "+e.serverId)),(0,A.isFunction)(this._sipHeadersModifier)){var i;(i=t.extraHeaders).push.apply(i,n(this._sipHeadersModifier({uri:e.jid})))}return t}},{key:"_prepareInviteOptions",value:function(){function e(e,i){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t,i){var r,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r={sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!1}},extraHeaders:["X-DID: "+B.default.uniqueId,"X-AID: "+this._appId,"X-SDK-Version: "+j.version,"X-AT: "+this._accountManager.getSsoToken()]},t.outbound){e.next=11;break}r.extraHeaders.push("X-Call-Answer: "+t.incomingCallId),r.extraHeaders.push("webrtc: "+t.serverId),e.t0=i,e.next=e.t0===Y.DECLINE?7:e.t0===Y.BUSY?9:11;break;case 7:return r.extraHeaders.push('X-Call-Action: Reject;cause=603;text="Decline"'),e.abrupt("break",11);case 9:return r.extraHeaders.push('X-Call-Action: Reject;cause=486;text="Busy Here"'),e.abrupt("break",11);case 11:return(0,A.isFunction)(this._sipHeadersModifier)&&(s=r.extraHeaders).push.apply(s,n(this._sipHeadersModifier({uri:t.jid}))),e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"_handleSession",value:function(e,t){var i=this;t.on("progress",function(t){V.info("SIP SESSION progress: ",h(t)),i._pendingOutgoingCall.has(e)&&(i._pendingOutgoingCall.delete(e),i._onCallMade(e))}),t.once("accepted",function(r){V.info("SIP SESSION accepted: ",r),i._mediaController.addMedia(e,i._localEle,i._remoteEle,t),i._updateStatus(e,U.ACTIVE),t.removeAllListeners("failed")}),t.once("rejected",function(t,r){if(V.info("SIP SESSION rejected: ",h(t),r),!i._getCallFromStorage(e).outbound)return void i._updateStatus(e,U.ENDED,M.DECLINED);switch(r){case Z.UNAVAILABLE:i._updateStatus(e,U.ENDED,M.TIMEOUT);break;default:var s=void 0,n=t&&t.data||"",a=n.match(/;text="(.+)"/);if(a&&a.length>1&&(s=a[1]),403===t.status_code){V.warn("SIP SESSION rejected due to wrong username or password"),i._updateStatus(e,U.ENDED,M.FAILED,s);break}i._updateStatus(e,U.ENDED,M.REJECTED,s)}}),t.once("failed",function(r,s){switch(V.info("SIP SESSION failed: ",h(r),s),s){case Z.NO_ANSWER:case Z.EXPIRES:i._updateStatus(e,U.ENDED,M.TIMEOUT);break;case Z.WEBRTC_ERROR:var n=i._pendingOutgoingCall.has(e);i._pendingOutgoingCall.delete(e),i._cleanUpSessionHandlers(t),i._sipSessionMap.delete(e),i._cleanUpIfNeeded(),i.emit(k.ERROR,{id:e,uri:e,callDirection:n?O.OUTGOING:O.INCOMING,error:{message:s,code:P.WEBRTC_ERROR}});break;default:i._updateStatus(e,U.ENDED,M.FAILED)}}),t.on("reinviteAccepted",function(r){V.info("SIP SESSION reinviteAccepted: ",r);var s=function(e){i._setCallToStorage(e.jid,e),i.emit(k.HOLD_STATUS_UPDATED,d({},e))},n=i._getCallFromStorage(e);if(n.hold.local!==t.local_hold)return n.hold.local=t.local_hold,void s(n);var a=t.sessionDescriptionHandler.peerConnection.remoteDescription.sdp,o=/(?:a=(sendrecv|sendonly|recvonly|inactive))[\s\S]+?m=audio/.exec(a),u=o&&o[1],c=/m=audio[\s\S]+?(?:a=(sendrecv|sendonly|recvonly|inactive))/.exec(a),l=c&&c[1],h=l||u,p=void 0;switch(h){case"inactive":case"sendonly":p=!0;break;case"recvonly":case"sendrecv":default:p=!1}if(n.hold.remote!==p){n.hold.remote=p;var f=i._computeTrackState(n);i._mediaController.setMute(n.jid,f),s(n)}}),t.on("reinviteFailed",function(e){V.info("SIP SESSION reinviteFailed: ",e)}),t.on("terminated",function(t,r){V.info("SIP SESSION terminated: ",t,r),r!==Z.WEBRTC_ERROR&&i._updateStatus(e,U.ENDED,M.TERMINATED)}),t.on("cancel",function(){V.info("SIP SESSION cancel"),i._updateStatus(e,U.ENDED,M.CANCELLED)}),t.on("refer",function(e){V.info("SIP SESSION refer: ",e)}),t.on("replaced",function(e){V.info("SIP SESSION replaced: ",e)}),t.on("dtmf",function(e){V.info("SIP SESSION dtmf ",e)})}},{key:"_cleanUpSessionHandlers",value:function(e){e.removeAllListeners("progress"),e.removeAllListeners("accepted"),e.removeAllListeners("cancel"),e.removeAllListeners("rejected"),e.removeAllListeners("failed"),e.removeAllListeners("reinviteAccepted"),e.removeAllListeners("reinviteFailed"),e.removeAllListeners("terminated"),e.removeAllListeners("bye"),e.removeAllListeners("refer"),e.removeAllListeners("replaced"),e.removeAllListeners("dtmf")}},{key:"_cleanUpIfNeeded",value:function(){this._getAllCallsFromStorage().length||(this._uaWaker&&this._uaWaker.sleep(),this._remoteEle&&(document.body.removeChild(this._remoteEle),this._remoteEle=null),this._localEle&&(document.body.removeChild(this._localEle),this._localEle=null))}},{key:"_updateStatus",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=this._getCallFromStorage(e);if(!s)return void V.warn("Attempt to update the status of an nonexisting call: "+e);if(this._validateStateTransition({jid:e,status:t})){s.status=t;var n=null,a=this._sipSessionMap.get(e);switch(s.status){case U.ENDED:a&&(n=new Date(a.endTime).getTime(),this._cleanUpSessionHandlers(a),this._sipSessionMap.delete(e)),n||(n=Date.now()),s.endTime=n,s.endCause=i,s.endContext=r,this._unsetCallFromStorage(e),(this._remoteEle||this._localEle)&&this._mediaController.removeMedia(e),this._cleanUpIfNeeded(),this.emit(k.STATUS_UPDATED,d({},s)),this.emit(k.CALL_ENDED,d({},s));break;case U.ACTIVE:s.connectedTime=new Date(a.startTime).getTime(),this._setCallToStorage(e,s),this.emit(k.STATUS_UPDATED,d({},s));break;default:this._setCallToStorage(e,s),this.emit(k.STATUS_UPDATED,d({},s))}}}}]),e}();t.default=te,e.exports=t.default},736:function(e,t,i){/*!
 * 
 *  SIP version 0.11.3
 *  Copyright (c) 2014-2018 Junction Networks, Inc <http://www.onsip.com>
 *  Homepage: https://sipjs.com
 *  License: https://sipjs.com/license/
 * 
 * 
 *  ~~~SIP.js contains substantial portions of JsSIP under the following license~~~
 *  Homepage: http://jssip.net
 *  Copyright (c) 2012-2013 José Luis Millán - Versatica <http://www.versatica.com>
 * 
 *  Permission is hereby granted, free of charge, to any person obtaining
 *  a copy of this software and associated documentation files (the
 *  "Software"), to deal in the Software without restriction, including
 *  without limitation the rights to use, copy, modify, merge, publish,
 *  distribute, sublicense, and/or sell copies of the Software, and to
 *  permit persons to whom the Software is furnished to do so, subject to
 *  the following conditions:
 * 
 *  The above copyright notice and this permission notice shall be
 *  included in all copies or substantial portions of the Software.
 * 
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 *  ~~~ end JsSIP license ~~~
 * 
 * 
 * 
 * 
 */
!function(t,i){e.exports=i()}(0,function(){return function(e){function t(r){if(i[r])return i[r].exports;var s=i[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var s in e)t.d(r,s,function(t){return e[t]}.bind(null,s));return r},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){"use strict";e.exports=i(1)(i(40))},function(e,t,i){"use strict";e.exports=function(e){var t=i(2),r=t.version,s=t.title,n=Object.defineProperties({},{version:{get:function(){return r}},name:{get:function(){return s}}});return i(3)(n,e),n.LoggerFactory=i(4)(e.console),n.EventEmitter=i(5)(),n.C=i(7)(n.name,n.version),n.Exceptions=i(8),n.Timers=i(9)(e.timers),n.Transport=i(10)(n),i(11)(n),i(12)(n),i(13)(n),i(14)(n),i(15)(n),i(16)(n),i(18)(n),i(19)(n),n.SessionDescriptionHandler=i(20)(n.EventEmitter),i(21)(n),i(22)(n),i(23)(n),i(25)(n),i(26)(n),i(27)(n,e),i(32)(n),n.DigestAuthentication=i(33)(n.Utils),n.Grammar=i(36)(n),n.Web={Modifiers:i(38)(n),Simple:i(39)(n)},n}},function(e){e.exports={name:"m800-sip.js",title:"SIP.js",description:"A simple, intuitive, and powerful JavaScript signaling library",version:"0.11.3",main:"dist/sip.js",browser:{"./src/environment.js":"./src/environment_browser.js"},homepage:"https://sipjs.com",author:"OnSIP <developer@onsip.com> (https://sipjs.com/aboutus/)",contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],repository:{type:"git",url:"https://github.com/onsip/SIP.js.git"},keywords:["sip","websocket","webrtc","library","javascript"],devDependencies:{"babel-core":"^6.26.0","babel-loader":"^7.1.2","babel-preset-env":"^1.6.1",eslint:"^4.9.0","jasmine-core":"^3.1.0",karma:"^2.0.2","karma-chrome-launcher":"^2.2.0","karma-cli":"^1.0.1","karma-jasmine":"^1.1.0","karma-jasmine-html-reporter":"^1.2.0","karma-mocha-reporter":"^2.2.5","karma-webpack":"^3.0.0",pegjs:"^0.10.0","pegjs-loader":"^0.5.4","uglifyjs-webpack-plugin":"^1.2.5",webpack:"^4.16.0","webpack-cli":"^3.0.8"},engines:{node:">=6.0"},license:"MIT",scripts:{prebuild:"eslint src/*.js src/**/*.js","build-dev":"webpack --progress --env.buildType dev","build-prod":"webpack --progress --env.buildType prod","copy-dist-files":"cp dist/sip.js dist/sip-$npm_package_version.js && cp dist/sip.min.js  dist/sip-$npm_package_version.min.js",build:"npm run build-dev && npm run build-prod && npm run copy-dist-files",browserTest:"sleep 2 && open http://0.0.0.0:9876/debug.html & karma start --reporters kjhtml --no-single-run",commandLineTest:"karma start --reporters mocha --browsers ChromeHeadless --single-run",buildAndTest:"npm run build && npm run commandLineTest",buildAndBrowserTest:"npm run build && npm run browserTest",prepack:"npm run build"},dependencies:{"crypto-js":"^3.1.9-1"},optionalDependencies:{promiscuous:"^0.6.0"}}},function(e,t,i){"use strict";e.exports=function(e,t){var i;i={Promise:t.Promise,defer:function(){var e={};return e.promise=new i.Promise(function(t,i){e.resolve=t,e.reject=i}),e},reducePromises:function(t,i){return t.reduce(function(e,t){return e=e.then(t)},e.Utils.Promise.resolve(i))},augment:function(e,t,i,r){var s,n;n=t.prototype;for(s in n)(r||void 0===e[s])&&(e[s]=n[s]);t.apply(e,i)},defaultOptions:function(e,t){return e=e||{},t=t||{},Object.assign({},e,t)},optionsOverride:function(e,t,i,r,s,n){r&&e[i]&&s.warn(i+" is deprecated, please use "+t+" instead"),e[t]&&e[i]&&s.warn(t+" overriding "+i),e[t]=e[t]||e[i]||n},str_utf8_length:function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},generateFakeSDP:function(e){if(e){var t=e.indexOf("o="),i=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,i)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},createRandomToken:function(e,t){var i,r,s="";for(t=t||32,i=0;i<e;i++)r=Math.random()*t|0,s+=r.toString(t);return s},newTag:function(){return e.Utils.createRandomToken(e.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},hostType:function(t){if(t)return-1!==(t=e.Grammar.parse(t,"host"))?t.host_type:void 0},normalizeTarget:function(t,i){var r,s,n;if(t){if(t instanceof e.URI)return t;if("string"==typeof t){switch(r=t.split("@"),r.length){case 1:if(!i)return;s=t,n=i;break;case 2:s=r[0],n=r[1];break;default:s=r.slice(0,r.length-1).join("@"),n=r[r.length-1]}return s=s.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(s)&&(s=s.replace(/[\-\.\(\)]/g,"")),t=e.C.SIP+":"+e.Utils.escapeUser(s)+"@"+n,e.URI.parse(t)}}else;},escapeUser:function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var t,i={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),s="",n=r.length;for(t=0;t<n;t++)0!==t&&(s+="-"),s+=r[t].charAt(0).toUpperCase()+r[t].substring(1);return i[s]&&(s=i[s]),s},sipErrorCause:function(t){var i;for(i in e.C.SIP_ERROR_CAUSES)if(-1!==e.C.SIP_ERROR_CAUSES[i].indexOf(t))return e.C.causes[i];return e.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(t,i){return i||e.C.REASON_PHRASE[t]||""},getReasonHeaderValue:function(t,i){return i=e.Utils.getReasonPhrase(t,i),"SIP;cause="+t+';text="'+i+'"'},getCancelReason:function(t,i){if(t&&t<200||t>699)throw new TypeError("Invalid status_code: "+t);if(t)return e.Utils.getReasonHeaderValue(t,i)},buildStatusLine:function(e,t){if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);return t=i.getReasonPhrase(e,t),"SIP/2.0 "+e+" "+t+"\r\n"},getRandomTestNetIP:function(){return"192.0.2."+function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}(1,254)}},e.Utils=i}},function(e,t,i){"use strict";var r={error:0,warn:1,log:2,debug:3};e.exports=function(e){function t(e,t,i){this.logger=e,this.category=t,this.label=i}var i=function(){var e,t=2,i=!0,s=null;this.loggers={},e=this.getLogger("sip.loggerfactory"),Object.defineProperties(this,{builtinEnabled:{get:function(){return i},set:function(t){"boolean"==typeof t?i=t:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(t))}},level:{get:function(){return t},set:function(i){i>=0&&i<=3?t=i:i>3?t=3:r.hasOwnProperty(i)?t=r[i]:e.error('invalid "level" parameter value: '+JSON.stringify(i))}},connector:{get:function(){return s},set:function(t){null===t||""===t||void 0===t?s=null:"function"==typeof t?s=t:e.error('invalid "connector" parameter value: '+JSON.stringify(t))}}})};return i.prototype.print=function(t,i,r,s){if("string"==typeof s){var n=[new Date,i];r&&n.push(r),s=n.concat(s).join(" | ")}t.call(e,s)},Object.keys(r).forEach(function(s){t.prototype[s]=function(e){this.logger[s](this.category,this.label,e)},i.prototype[s]=function(t,i,n){this.level>=r[s]&&(this.builtinEnabled&&this.print(e[s],t,i,n),this.connector&&this.connector(s,t,i,n))}}),i.prototype.getLogger=function(e,i){var r;return i&&3===this.level?new t(this,e,i):this.loggers[e]?this.loggers[e]:(r=new t(this,e),this.loggers[e]=r,r)},i}},function(e,t,i){"use strict";var r=i(6).EventEmitter;e.exports=function(){function e(){r.call(this)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),e}},function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function s(e){return"number"==typeof e}function n(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,s,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(i=this._events[e],a(i))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(n(i))for(o=Array.prototype.slice.call(arguments,1),c=i.slice(),s=c.length,u=0;u<s;u++)c[u].apply(this,o);return!0},i.prototype.addListener=function(e,t){var s;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,n(this._events[e])&&!this._events[e].warned&&(s=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function i(){this.removeListener(e,i),s||(s=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var s=!1;return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var i,s,a,o;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],a=i.length,s=-1,i===t||r(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(i)){for(o=a;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){s=o;break}if(s<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],r(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,i){"use strict";e.exports=function(e,t){return{USER_AGENT:e+"/"+t,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",PUBLISH:"PUBLISH",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},OPTION_TAGS:{"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0},dtmfType:{INFO:"info",RTP:"rtp"}}}},function(e,t,i){"use strict";e.exports={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),GetDescriptionError:function(){var e=function(e){this.code=4,this.name="GET_DESCRIPTION_ERROR",this.message=e};return e.prototype=new Error,e}(),RenegotiationError:function(){var e=function(e){this.code=5,this.name="RENEGOTIATION_ERROR",this.message=e};return e.prototype=new Error,e}(),MethodParameterError:function(){var e=function(e,t,i){this.code=6,this.name="METHOD_PARAMETER_ERROR",this.method=e,this.parameter=t,this.value=i,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),TransportError:function(){var e=function(e){this.code=7,this.name="TRANSPORT_ERROR",this.message=e};return e.prototype=new Error,e}()}},function(e,t,i){"use strict";var r=500;e.exports=function(e){var t={T1:r,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};return["setTimeout","clearTimeout","setInterval","clearInterval"].forEach(function(i){t[i]=function(){return e[i].apply(e,arguments)}}),t}},function(e,t,i){"use strict";e.exports=function(e){var t=function(e,t){};return t.prototype=Object.create(e.EventEmitter.prototype,{connect:{writable:!0,value:function(e){return e=e||{},this.connectPromise(e).then(function(e){!e.overrideEvent&&this.emit("connected")}.bind(this))}},connectPromise:{writable:!0,value:function(e){}},isConnected:{writable:!0,value:function(){}},send:{writable:!0,value:function(e,t){return t=t||{},this.sendPromise(e).then(function(e){!e.overrideEvent&&this.emit("messageSent",e.msg)}.bind(this))}},sendPromise:{writable:!0,value:function(e,t){}},onMessage:{writable:!0,value:function(e){}},disconnect:{writable:!0,value:function(e){return e=e||{},this.disconnectPromise(e).then(function(e){!e.overrideEvent&&this.emit("disconnected")}.bind(this))}},disconnectPromise:{writable:!0,value:function(e){}},afterConnected:{writable:!0,value:function(e){this.isConnected()?e():this.once("connected",e)}},waitForConnected:{writable:!0,value:function(){return console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead"),new e.Utils.Promise(function(e){this.afterConnected(e)}.bind(this))}}}),t}},function(e,t,i){"use strict";e.exports=function(e){function t(e,t){var i=t,r=0,s=0;if(e.substring(i,i+2).match(/(^\r\n)/))return-2;for(;0===r;){if(-1===(s=e.indexOf("\r\n",i)))return s;!e.substring(s+2,s+4).match(/(^\r\n)/)&&e.charAt(s+2).match(/(^\s+)/)?i=s+2:r=s}return r}function i(t,i,r,s){var n,a,o,u,c=i.indexOf(":",r),l=i.substring(r,c).trim(),h=i.substring(c+1,s).trim();switch(l.toLowerCase()){case"via":case"v":t.addHeader("via",h),1===t.getHeaders("via").length?(u=t.parseHeader("Via"))&&(t.via=u,t.via_branch=u.branch):u=0;break;case"from":case"f":t.setHeader("from",h),u=t.parseHeader("from"),u&&(t.from=u,t.from_tag=u.getParam("tag"));break;case"to":case"t":t.setHeader("to",h),u=t.parseHeader("to"),u&&(t.to=u,t.to_tag=u.getParam("tag"));break;case"record-route":if(-1===(u=e.Grammar.parse(h,"Record_Route"))){u=void 0;break}for(o=u.length,a=0;a<o;a++)n=u[a],t.addHeader("record-route",h.substring(n.position,n.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=n.parsed;break;case"call-id":case"i":t.setHeader("call-id",h),u=t.parseHeader("call-id"),u&&(t.call_id=h);break;case"contact":case"m":if(-1===(u=e.Grammar.parse(h,"Contact"))){u=void 0;break}for(o=u.length,a=0;a<o;a++)n=u[a],t.addHeader("contact",h.substring(n.position,n.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=n.parsed;break;case"content-length":case"l":t.setHeader("content-length",h),u=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",h),u=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",h),u=t.parseHeader("cseq"),u&&(t.cseq=u.value),t instanceof e.IncomingResponse&&(t.method=u.method);break;case"max-forwards":t.setHeader("max-forwards",h),u=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",h),u=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",h),u=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",h),u=t.parseHeader("refer-to"),u&&(t.refer_to=u);break;default:t.setHeader(l,h),u=0}return void 0!==u||{error:'error parsing header "'+l+'"'}}var r;r={},r.parseMessage=function(r,s){var n,a,o,u,c,l=0,h=r.indexOf("\r\n"),d=s.getLogger("sip.parser");if(-1===h)return void d.warn("no CRLF found, not a SIP message, discarded");if(a=r.substring(0,h),-1===(c=e.Grammar.parse(a,"Request_Response")))return void d.warn('error parsing first line of SIP message: "'+a+'"');for(c.status_code?(n=new e.IncomingResponse(s),n.status_code=c.status_code,n.reason_phrase=c.reason_phrase):(n=new e.IncomingRequest(s),n.method=c.method,n.ruri=c.uri),n.data=r,l=h+2;;){if(-2===(h=t(r,l))){u=l+2;break}if(-1===h)return void d.error("malformed message");if(!0!==(c=i(n,r,l,h)))return void d.error(c.error);l=h+2}return n.hasHeader("content-length")?(o=n.getHeader("content-length"),n.body=r.substr(u,o)):n.body=r.substring(u),n},e.Parser=r}},function(e,t,i){"use strict";e.exports=function(e){function t(t){var i=t.ua.configuration.hackAllowUnregisteredOptionTags,r=[],s={};return t.method===e.C.REGISTER?r.push("path","gruu"):t.method===e.C.INVITE&&(t.ua.contact.pub_gruu||t.ua.contact.temp_gruu)&&r.push("gruu"),t.ua.configuration.rel100===e.C.supported.SUPPORTED&&r.push("100rel"),t.ua.configuration.replaces===e.C.supported.SUPPORTED&&r.push("replaces"),r.push("outbound"),r=r.concat(t.ua.configuration.extraSupported),r=r.filter(function(t){var r=e.C.OPTION_TAGS[t],n=!s[t];return s[t]=!0,(r||i)&&n}),"Supported: "+r.join(", ")+"\r\n"}var i,r,s,n;i=function(t,i,r,s,n,a){var o,u,c,l,h,d;if(s=s||{},!t||!i||!r)return null;this.logger=r.getLogger("sip.sipmessage"),this.ua=r,this.headers={},this.method=t,this.ruri=i,this.body=a,this.extraHeaders=(n||[]).slice(),this.statusCode=s.status_code,this.reasonPhrase=s.reason_phrase,s.route_set?this.setHeader("route",s.route_set):r.configuration.usePreloadedRoute&&this.setHeader("route",r.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),h=s.to_uri||i,o=s.to_displayName||0===s.to_displayName?'"'+s.to_displayName+'" ':"",o+="<"+(h&&h.toRaw?h.toRaw():h)+">",o+=s.to_tag?";tag="+s.to_tag:"",this.to=new e.NameAddrHeader.parse(o),this.setHeader("to",o),d=s.from_uri||r.configuration.uri,u=s.from_displayName||0===s.from_displayName?'"'+s.from_displayName+'" ':r.configuration.displayName?'"'+r.configuration.displayName+'" ':"",u+="<"+(d&&d.toRaw?d.toRaw():d)+">;tag=",u+=s.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(u),this.setHeader("from",u),c=s.call_id||r.configuration.sipjsId+e.Utils.createRandomToken(15),this.call_id=c,this.setHeader("call-id",c),l=s.cseq||Math.floor(1e4*Math.random()),this.cseq=l,this.setHeader("cseq",l+" "+t)},i.prototype={setHeader:function(t,i){this.headers[e.Utils.headerize(t)]=i instanceof Array?i:[i]},getHeader:function(t){var i,r,s=this.extraHeaders.length,n=this.headers[e.Utils.headerize(t)];if(n){if(n[0])return n[0]}else for(i=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<s;r++)if(n=this.extraHeaders[r],i.test(n))return n.substring(n.indexOf(":")+1).trim()},getHeaders:function(t){var i,r,s,n=this.headers[e.Utils.headerize(t)],a=[];if(n){for(r=n.length,i=0;i<r;i++)a.push(n[i]);return a}for(r=this.extraHeaders.length,s=new RegExp("^\\s*"+t+"\\s*:","i"),i=0;i<r;i++)n=this.extraHeaders[i],s.test(n)&&a.push(n.substring(n.indexOf(":")+1).trim());return a},hasHeader:function(t){var i,r,s=this.extraHeaders.length;if(this.headers[e.Utils.headerize(t)])return!0;for(i=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<s;r++)if(i.test(this.extraHeaders[r]))return!0;return!1},toString:function(){var i,r,s,n="";n+=this.method+" "+(this.ruri.toRaw?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n";for(i in this.headers)for(r=this.headers[i].length,s=0;s<r;s++)n+=i+": "+this.headers[i][s]+"\r\n";for(r=this.extraHeaders.length,s=0;s<r;s++)n+=this.extraHeaders[s].trim()+"\r\n";return n+=t(this),n+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(r=e.Utils.str_utf8_length(this.body),n+="Content-Length: "+r+"\r\n\r\n",n+=this.body):this.body.body&&this.body.contentType?(r=e.Utils.str_utf8_length(this.body.body),n+="Content-Type: "+this.body.contentType+"\r\n",n+="Content-Length: "+r+"\r\n\r\n",n+=this.body.body):n+="Content-Length: 0\r\n\r\n":n+="Content-Length: 0\r\n\r\n",n}},r=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null},r.prototype={addHeader:function(t,i){var r={raw:i};t=e.Utils.headerize(t),this.headers[t]?this.headers[t].push(r):this.headers[t]=[r]},getHeader:function(t){var i=this.headers[e.Utils.headerize(t)];if(i)return i[0]?i[0].raw:void 0},getHeaders:function(t){var i,r,s=this.headers[e.Utils.headerize(t)],n=[];if(!s)return[];for(r=s.length,i=0;i<r;i++)n.push(s[i].raw);return n},hasHeader:function(t){return!!this.headers[e.Utils.headerize(t)]},parseHeader:function(t,i){var r,s,n;return t=e.Utils.headerize(t),i=i||0,this.headers[t]?i>=this.headers[t].length?void this.logger.log('not so many "'+t+'" headers present'):(r=this.headers[t][i],s=r.raw,r.parsed?r.parsed:(n=e.Grammar.parse(s,t.replace(/-/g,"_")),-1===n?(this.headers[t].splice(i,1),void this.logger.warn('error parsing "'+t+'" header field with value "'+s+'"')):(r.parsed=n,n))):void this.logger.log('header "'+t+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(t,i){var r={raw:i};this.headers[e.Utils.headerize(t)]=[r]},toString:function(){return this.data}},s=function(e){this.logger=e.getLogger("sip.sipmessage"),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null},s.prototype=new r,s.prototype.reply=function(i,r,s,n,a,o){var u,c,l,h,d,p=this.getHeader("To"),f=0,g=0;if(d=e.Utils.buildStatusLine(i,r),s=(s||[]).slice(),this.method===e.C.INVITE&&i>100&&i<=200)for(u=this.getHeaders("record-route"),l=u.length,f;f<l;f++)d+="Record-Route: "+u[f]+"\r\n";for(c=this.getHeaders("via"),l=c.length,g;g<l;g++)d+="Via: "+c[g]+"\r\n";for(!this.to_tag&&i>100?p+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.to_tag),d+="To: "+p+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",l=s.length,h=0;h<l;h++)d+=s[h].trim()+"\r\n";return d+=t(this),d+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",n?"string"==typeof n?(l=e.Utils.str_utf8_length(n),d+="Content-Type: application/sdp\r\n",d+="Content-Length: "+l+"\r\n\r\n",d+=n):n.body&&n.contentType?(l=e.Utils.str_utf8_length(n.body),d+="Content-Type: "+n.contentType+"\r\n",d+="Content-Length: "+l+"\r\n\r\n",d+=n.body):d+="Content-Length: 0\r\n\r\n":d+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(i,d).then(a,o),d},s.prototype.reply_sl=function(t,i){var r,s,n=0,a=this.getHeaders("via"),o=a.length;for(s=e.Utils.buildStatusLine(t,i),n;n<o;n++)s+="Via: "+a[n]+"\r\n";r=this.getHeader("To"),!this.to_tag&&t>100?r+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(r+=";tag="+this.to_tag),s+="To: "+r+"\r\n",s+="From: "+this.getHeader("From")+"\r\n",s+="Call-ID: "+this.call_id+"\r\n",s+="CSeq: "+this.cseq+" "+this.method+"\r\n",s+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",s+="Content-Length: 0\r\n\r\n",this.transport.send(s)},n=function(e){this.logger=e.getLogger("sip.sipmessage"),this.headers={},this.status_code=null,this.reason_phrase=null},n.prototype=new r,e.OutgoingRequest=i,e.IncomingRequest=s,e.IncomingResponse=n}},function(e,t,i){"use strict";e.exports=function(e){var t;t=function(t,i,r,s,n,a){var o,u,c,l;if(!r)throw new TypeError('missing or invalid "host" parameter');t=t||e.C.SIP,this.parameters={},this.headers={};for(o in n)this.setParam(o,n[o]);for(u in a)this.setHeader(u,a[u]);c={scheme:t,user:i,host:r,port:s},l={scheme:t.toLowerCase(),user:i,host:r.toLowerCase(),port:s},Object.defineProperties(this,{_normal:{get:function(){return l}},_raw:{get:function(){return c}},scheme:{get:function(){return l.scheme},set:function(e){c.scheme=e,l.scheme=e.toLowerCase()}},user:{get:function(){return l.user},set:function(e){l.user=c.user=e}},host:{get:function(){return l.host},set:function(e){c.host=e,l.host=e.toLowerCase()}},aor:{get:function(){return l.user+"@"+l.host}},port:{get:function(){return l.port},set:function(e){l.port=c.port=0===e?e:parseInt(e,10)||null}}})},t.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString().toLowerCase())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(t,i){this.headers[e.Utils.headerize(t)]=i instanceof Array?i:[i]},getHeader:function(t){if(t)return this.headers[e.Utils.headerize(t)]},hasHeader:function(t){if(t)return this.headers.hasOwnProperty(e.Utils.headerize(t))&&!0||!1},deleteHeader:function(t){var i;if(t=e.Utils.headerize(t),this.headers.hasOwnProperty(t))return i=this.headers[t],delete this.headers[t],i},clearHeaders:function(){this.headers={}},clone:function(){return new t(this._raw.scheme,this._raw.user,this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toRaw:function(){return this._toString(this._raw)},toString:function(){return this._toString(this._normal)},_toString:function(t){var i,r,s,n,a=[];n=t.scheme+":",t.scheme.toLowerCase().match("^sips?$")||(n+="//"),t.user&&(n+=e.Utils.escapeUser(t.user)+"@"),n+=t.host,(t.port||0===t.port)&&(n+=":"+t.port);for(r in this.parameters)n+=";"+r,null!==this.parameters[r]&&(n+="="+this.parameters[r]);for(i in this.headers)for(s in this.headers[i])a.push(i+"="+this.headers[i][s]);return a.length>0&&(n+="?"+a.join("&")),n}},t.parse=function(t){return t=e.Grammar.parse(t,"SIP_URI"),-1!==t?t:void 0},e.URI=t}},function(e,t,i){"use strict";e.exports=function(e){var t;t=function(t,i,r){var s;if(!(t&&t instanceof e.URI))throw new TypeError('missing or invalid "uri" parameter');this.uri=t,this.parameters={};for(s in r)this.setParam(s,r[s]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||t.aor}},displayName:{get:function(){return i},set:function(e){i=0===e?"0":e}}})},t.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString())},getParam:e.URI.prototype.getParam,hasParam:e.URI.prototype.hasParam,deleteParam:e.URI.prototype.deleteParam,clearParams:e.URI.prototype.clearParams,clone:function(){return new t(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;e=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"",e+="<"+this.uri.toString()+">";for(t in this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},t.parse=function(t){return t=e.Grammar.parse(t,"Name_Addr_Header"),-1!==t?t:void 0},e.NameAddrHeader=t}},function(e,t,i){"use strict";e.exports=function(e){function t(e,t,i){var r;return r="SIP/2.0/"+(e.ua.configuration.hackViaTcp?"TCP":t.server.scheme),r+=" "+e.ua.configuration.viaHost+";branch="+i,e.ua.configuration.forceRport&&(r+=";rport"),r}var i={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},r=function(e,r,s){var n;this.type=i.NON_INVITE_CLIENT,this.transport=s,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=r,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),n=t(e,s,this.id),this.request.setHeader("via",n),this.request_sender.ua.newTransaction(this)};r.prototype=Object.create(e.EventEmitter.prototype),r.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},r.prototype.send=function(){var t=this;this.stateChanged(i.STATUS_TRYING),this.F=e.Timers.setTimeout(t.timer_F.bind(t),e.Timers.TIMER_F),this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},r.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),e.Timers.clearTimeout(this.F),e.Timers.clearTimeout(this.K),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},r.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},r.prototype.timer_K=function(){this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.receiveResponse=function(t){var r=this,s=t.status_code;if(s<200)switch(this.state){case i.STATUS_TRYING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_PROCEEDING),this.request_sender.receiveResponse(t)}else switch(this.state){case i.STATUS_TRYING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_COMPLETED),e.Timers.clearTimeout(this.F),408===s?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(t),this.K=e.Timers.setTimeout(r.timer_K.bind(r),e.Timers.TIMER_K)}};var s=function(e,r,s){var n,a=this;this.type=i.INVITE_CLIENT,this.transport=s,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=r,this.logger=e.ua.getLogger("sip.transaction.ict",this.id),n=t(e,s,this.id),this.request.setHeader("via",n),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e,t){t=(t||[]).slice();for(var i=t.length,r=null,s=0;s<i;s++)r=(r||"")+t[s].trim()+"\r\n";a.cancel_request(a,e,r)}};s.prototype=Object.create(e.EventEmitter.prototype),s.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},s.prototype.send=function(){var t=this;this.stateChanged(i.STATUS_CALLING),this.B=e.Timers.setTimeout(t.timer_B.bind(t),e.Timers.TIMER_B),this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},s.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),e.Timers.clearTimeout(this.D),e.Timers.clearTimeout(this.M),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==i.STATUS_ACCEPTED&&this.request_sender.onTransportError()},s.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id),this.state===i.STATUS_ACCEPTED&&(e.Timers.clearTimeout(this.B),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},s.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id),this.state===i.STATUS_CALLING&&(this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},s.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},s.prototype.sendACK=function(t){var i,r=this;t=t||{},i=this.response.getHeader("contact")?this.response.parseHeader("contact").uri:this.request.ruri;var s=new e.OutgoingRequest("ACK",i,this.request.ua,{cseq:this.response.cseq,call_id:this.response.call_id,from_uri:this.response.from.uri,from_tag:this.response.from_tag,to_uri:this.response.to.uri,to_tag:this.response.to_tag,route_set:this.response.getHeaders("record-route").reverse()},t.extraHeaders||[],t.body);return this.ackSender=new e.RequestSender({request:s,onRequestTimeout:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTimeout:function(){r.logger.warn("ACK Request timed out")},onTransportError:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTransportError:function(){r.logger.warn("ACK Request had a transport error")},receiveResponse:t.receiveResponse||function(){r.logger.warn("Received a response to an ACK which was unexpected. Dropping Response.")}},this.request.ua).send(),s},s.prototype.cancel_request=function(t,r,s){var n=t.request;this.cancel=e.C.CANCEL+" "+n.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+n.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+n.headers.Route.toString()+"\r\n"),this.cancel+="To: "+n.headers.To.toString()+"\r\n",this.cancel+="From: "+n.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+n.headers["Call-ID"].toString()+"\r\n",this.cancel+="Max-Forwards: "+e.UA.C.MAX_FORWARDS+"\r\n",this.cancel+="CSeq: "+n.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",r&&(this.cancel+="Reason: "+r+"\r\n"),s&&(this.cancel+=s),this.cancel+="Content-Length: 0\r\n\r\n",this.state===i.STATUS_PROCEEDING&&this.transport.send(this.cancel)},s.prototype.receiveResponse=function(t){var r=this,s=t.status_code;if(t.transaction=this,this.response&&this.response.status_code===t.status_code&&this.response.cseq===t.cseq)return this.logger.debug("ICT Received a retransmission for cseq: "+t.cseq),void(this.ackSender&&this.ackSender.send());if(this.response=t,s>=100&&s<=199)switch(this.state){case i.STATUS_CALLING:this.stateChanged(i.STATUS_PROCEEDING),this.request_sender.receiveResponse(t),this.cancel&&this.transport.send(this.cancel);break;case i.STATUS_PROCEEDING:this.request_sender.receiveResponse(t)}else if(s>=200&&s<=299)switch(this.state){case i.STATUS_CALLING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_ACCEPTED),this.M=e.Timers.setTimeout(r.timer_M.bind(r),e.Timers.TIMER_M),this.request_sender.receiveResponse(t);break;case i.STATUS_ACCEPTED:this.request_sender.receiveResponse(t)}else if(s>=300&&s<=699)switch(this.state){case i.STATUS_CALLING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_COMPLETED),this.sendACK(),this.request_sender.receiveResponse(t);break;case i.STATUS_COMPLETED:this.sendACK()}};var n=function(e,i,r){var s;this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=i,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),s=t(e,r,this.id),this.request.setHeader("via",s)};n.prototype=Object.create(e.EventEmitter.prototype),n.prototype.send=function(){this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},n.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id),this.request_sender.onTransportError()};var a=function(e,t){this.type=i.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=t.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.logger=t.getLogger("sip.transaction.nist",this.id),this.state=i.STATUS_TRYING,t.newTransaction(this)};a.prototype=Object.create(e.EventEmitter.prototype),a.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_J=function(){this.logger.debug("Timer J expired for non-INVITE server transaction "+this.id),this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),e.Timers.clearTimeout(this.J),this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.receiveResponse=function(t,r){var s=this,n=e.Utils.defer();if(100===t)switch(this.state){case i.STATUS_TRYING:this.stateChanged(i.STATUS_PROCEEDING),this.transport.send(r).catch(function(){this.onTransportError()}.bind(this));break;case i.STATUS_PROCEEDING:this.last_response=r,this.transport.send(r).then(function(){n.resolve()}).catch(function(){this.onTransportError(),n.reject()}.bind(this))}else if(t>=200&&t<=699)switch(this.state){case i.STATUS_TRYING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_COMPLETED),this.last_response=r,this.J=e.Timers.setTimeout(s.timer_J.bind(s),e.Timers.TIMER_J),this.transport.send(r).then(function(){n.resolve()}).catch(function(){this.onTransportError(),n.reject()}.bind(this))}return n.promise};var o=function(e,t){this.type=i.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=t.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.logger=t.getLogger("sip.transaction.ist",this.id),this.state=i.STATUS_PROCEEDING,t.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100)};o.prototype=Object.create(e.EventEmitter.prototype),o.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},o.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id),this.state===i.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.timer_I=function(){this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id),this.state===i.STATUS_ACCEPTED&&(this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),e.Timers.clearTimeout(this.L),e.Timers.clearTimeout(this.H),e.Timers.clearTimeout(this.I),this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.resend_provisional=function(){this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},o.prototype.receiveResponse=function(t,r){var s=this,n=e.Utils.defer();if(t>=100&&t<=199)switch(this.state){case i.STATUS_PROCEEDING:this.transport.send(r).catch(function(){this.onTransportError()}.bind(this)),this.last_response=r}if(t>100&&t<=199&&this.state===i.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=e.Timers.setInterval(s.resend_provisional.bind(s),e.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(t>=200&&t<=299)switch(this.state){case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_ACCEPTED),this.last_response=r,this.L=e.Timers.setTimeout(s.timer_L.bind(s),e.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case i.STATUS_ACCEPTED:this.transport.send(r).then(function(){n.resolve()}).catch(function(e){this.logger.error(e),this.onTransportError(),n.reject()}.bind(this))}else if(t>=300&&t<=699)switch(this.state){case i.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(r).then(function(){this.stateChanged(i.STATUS_COMPLETED),this.H=e.Timers.setTimeout(s.timer_H.bind(s),e.Timers.TIMER_H),n.resolve()}.bind(this)).catch(function(e){this.logger.error(e),this.onTransportError(),n.reject()}.bind(this))}return n.promise};var u=function(t,r){var s;switch(r.method){case e.C.INVITE:if(s=t.transactions.ist[r.via_branch]){switch(s.state){case i.STATUS_PROCEEDING:s.transport.send(s.last_response)}return!0}break;case e.C.ACK:if(!(s=t.transactions.ist[r.via_branch]))return!1;if(s.state===i.STATUS_ACCEPTED)return!1;if(s.state===i.STATUS_COMPLETED)return s.stateChanged(i.STATUS_CONFIRMED),s.I=e.Timers.setTimeout(s.timer_I.bind(s),e.Timers.TIMER_I),!0;break;case e.C.CANCEL:return s=t.transactions.ist[r.via_branch],s?(r.reply_sl(200),s.state!==i.STATUS_PROCEEDING):(r.reply_sl(481),!0);default:if(s=t.transactions.nist[r.via_branch]){switch(s.state){case i.STATUS_TRYING:break;case i.STATUS_PROCEEDING:case i.STATUS_COMPLETED:s.transport.send(s.last_response)}return!0}}};e.Transactions={C:i,checkTransaction:u,NonInviteClientTransaction:r,InviteClientTransaction:s,AckClientTransaction:n,NonInviteServerTransaction:a,InviteServerTransaction:o}}},function(e,t,i){"use strict";e.exports=function(e){var t,r=i(17)(e),s={STATUS_EARLY:1,STATUS_CONFIRMED:2};t=function(t,i,r,n){var a;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!i.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};n=i instanceof e.IncomingResponse?i.status_code<200?s.STATUS_EARLY:s.STATUS_CONFIRMED:n||s.STATUS_CONFIRMED,a=i.parseHeader("contact"),"UAS"===r?(this.id={call_id:i.call_id,local_tag:i.to_tag,remote_tag:i.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=n,this.remote_seqnum=i.cseq,this.local_uri=i.parseHeader("to").uri,this.remote_uri=i.parseHeader("from").uri,this.remote_target=a.uri,this.route_set=i.getHeaders("record-route"),this.invite_seqnum=i.cseq,this.local_seqnum=i.cseq):"UAC"===r&&(this.id={call_id:i.call_id,local_tag:i.from_tag,remote_tag:i.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=n,this.invite_seqnum=i.cseq,this.local_seqnum=i.cseq,this.local_uri=i.parseHeader("from").uri,this.pracked=[],this.remote_uri=i.parseHeader("to").uri,this.remote_target=a.uri,this.route_set=i.getHeaders("record-route").reverse()),this.logger=t.ua.getLogger("sip.dialog",this.id.toString()),this.owner=t,t.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+r+" dialog created with status "+(this.state===s.STATUS_EARLY?"EARLY":"CONFIRMED")),t.emit("dialog",this)},t.prototype={update:function(e,t){this.state=s.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.sessionDescriptionHandler&&this.state!==s.STATUS_CONFIRMED&&this.sessionDescriptionHandler.close(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(t,i,r){var s,n;return i=(i||[]).slice(),this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),s=t===e.C.CANCEL||t===e.C.ACK?this.invite_seqnum:this.local_seqnum+=1,n=new e.OutgoingRequest(t,this.remote_target,this.owner.ua,{cseq:s,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},i,r),n.dialog=this,n},checkInDialogRequest:function(t){var i=this;if(this.remote_seqnum){if(t.cseq<this.remote_seqnum)return t.method!==e.C.ACK&&t.reply(500),t.cseq===this.invite_seqnum}else this.remote_seqnum=t.cseq;switch(t.method){case e.C.INVITE:if(!0===this.uac_pending_reply)t.reply(491);else{if(!0===this.uas_pending_reply&&t.cseq>this.remote_seqnum){var r=1+(10*Math.random()|0);return t.reply(500,null,["Retry-After:"+r]),this.remote_seqnum=t.cseq,!1}this.uas_pending_reply=!0,t.server_transaction.on("stateChanged",function t(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",t),i.uas_pending_reply=!1)})}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_ACCEPTED&&(i.remote_target=t.parseHeader("contact").uri)});break;case e.C.NOTIFY:t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_COMPLETED&&(i.remote_target=t.parseHeader("contact").uri)})}return t.cseq>this.remote_seqnum&&(this.remote_seqnum=t.cseq),!0},sendRequest:function(e,t,i){i=i||{};var s=(i.extraHeaders||[]).slice(),n=null;i.body&&(i.body.body?n=i.body:(n={},n.body=i.body,i.contentType&&(n.contentType=i.contentType)));var a=this.createRequest(t,s,n);return new r(this,e,a).send(),a},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}},t.C=s,e.Dialog=t}},function(e,t,i){"use strict";e.exports=function(e){var t;return t=function(e,t,i){this.dialog=e,this.applicant=t,this.request=i,this.reattempt=!1,this.reattemptTimer=null},t.prototype={send:function(){var t=this,i=new e.RequestSender(this,this.dialog.owner.ua);i.send(),this.request.method===e.C.INVITE&&i.clientTransaction.state!==e.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,i.clientTransaction.on("stateChanged",function i(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",i),t.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var i=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===e.C.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=e.Timers.setTimeout(function(){i.applicant.owner.status!==e.Session.C.STATUS_TERMINATED&&(i.reattempt=!0,i.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(t)}},t}},function(e,t,i){"use strict";e.exports=function(e){var t;t=function(t,i){this.logger=i.getLogger("sip.requestsender"),this.ua=i,this.applicant=t,this.method=t.request.method,this.request=t.request,this.credentials=null,this.challenged=!1,this.staled=!1,i.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()},t.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}return this.clientTransaction.send(),this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var i,r,s,n=t.status_code;if(401===n||407===n){if(401===t.status_code?(r=t.parseHeader("www-authenticate"),s="authorization"):(r=t.parseHeader("proxy-authenticate"),s="proxy-authorization"),!r)return this.logger.warn(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&!0===r.stale){if(this.credentials||(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,r))return void this.applicant.receiveResponse(t);this.challenged=!0,r.stale&&(this.staled=!0),t.method===e.C.REGISTER?i=this.applicant.cseq+=1:this.request.dialog?i=this.request.dialog.local_seqnum+=1:(i=this.request.cseq+1,this.request.cseq=i),this.request.setHeader("cseq",i+" "+this.method),this.request.setHeader(s,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(t)}else this.applicant.receiveResponse(t)}},e.RequestSender=t}},function(e,t,i){"use strict";e.exports=function(e){var t;t=function(t){var i={};this.registrar=t.configuration.registrarServer,this.expires=t.configuration.registerExpires,this.contact=t.contact.toString(),this.contact+=";reg-id=1",this.contact+=';+sip.instance="<urn:uuid:'+t.configuration.instanceId+'>"',this.call_id=e.Utils.createRandomToken(22),this.cseq=Math.floor(1e4*Math.random()),this.to_uri=t.configuration.uri,i.to_uri=this.to_uri,i.to_displayName=t.configuration.displayName,i.call_id=this.call_id,i.cseq=this.cseq,e.Utils.augment(this,e.ClientContext,[t,"REGISTER",this.registrar,{params:i}]),this.registrationTimer=null,this.registrationExpiredTimer=null,this.registered=!1,this.logger=t.getLogger("sip.registercontext"),t.on("transportCreated",function(e){e.on("disconnected",this.onTransportDisconnected.bind(this))}.bind(this))},t.prototype=Object.create({},{register:{writable:!0,value:function(t){var i,r=this;this.options=t||{},i=(this.options.extraHeaders||[]).slice(),i.push("Contact: "+this.contact+";expires="+this.expires),i.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(t){var i,s,n,a=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.emit("accepted",t),t.hasHeader("expires")&&(s=t.getHeader("expires")),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),!a){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;a--;){if(i=t.parseHeader("contact",a),i.uri.user===this.ua.contact.uri.user){s=i.getParam("expires");break}i=null}if(!i){this.logger.warn("no Contact header pointing to us, response ignored");break}s||(s=this.expires),this.registrationTimer=e.Timers.setTimeout(function(){r.registrationTimer=null,r.register(r.options)},1e3*s-3e3),this.registrationExpiredTimer=e.Timers.setTimeout(function(){r.logger.warn("registration expired"),r.registered&&r.unregistered(null,e.C.causes.EXPIRES)},1e3*s),i.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=e.URI.parse(i.getParam("temp-gruu").replace(/"/g,""))),i.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=e.URI.parse(i.getParam("pub-gruu").replace(/"/g,""))),this.registered=!0,this.emit("registered",t||null);break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,e.C.causes.SIP_FAILURE_CODE));break;default:n=e.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,n)}},this.onRequestTimeout=function(){this.registrationFailure(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,e.C.causes.CONNECTION_ERROR)},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=i,this.send()}},registrationFailure:{writable:!0,value:function(e,t){this.emit("failed",e||null,t||null)}},onTransportDisconnected:{writable:!0,value:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.registered&&this.unregistered(null,e.C.causes.CONNECTION_ERROR)}},onTransportConnected:{writable:!0,value:function(){this.register(this.options)}},close:{writable:!0,value:function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registered_before=this.registered,this.registered&&this.unregister(e)}},unregister:{writable:!0,value:function(t){var i;t=t||{},this.registered||t.all||this.logger.warn("Already unregistered, but sending an unregister anyways."),i=(t.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),t.all?(i.push("Contact: *"),i.push("Expires: 0")):i.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(t){var i;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",t),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.unregistered(t);break;default:i=e.Utils.sipErrorCause(t.status_code),this.unregistered(t,i)}},this.onRequestTimeout=function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=i,this.send()}},unregistered:{writable:!0,value:function(e,t){this.registered=!1,this.emit("unregistered",e||null,t||null)}}}),e.RegisterContext=t}},function(e,t,i){"use strict";e.exports=function(e){var t=function(){};return t.prototype=Object.create(e.prototype,{close:{value:function(){}},getDescription:{value:function(e,t){}},hasDescription:{value:function(e){}},holdModifier:{value:function(e){}},setDescription:{value:function(e,t,i){}},sendDtmf:{value:function(e,t){}},getDirection:{value:function(){}}}),t}},function(e,t,i){"use strict";e.exports=function(e){var t;t=function(t,i,r,s){var n=r;if(void 0===r)throw new TypeError("Not enough arguments");if(this.ua=t,this.logger=t.getLogger("sip.clientcontext"),this.method=i,!(r=t.normalizeTarget(r)))throw new TypeError("Invalid target: "+n);s=Object.create(s||Object.prototype),s.extraHeaders=(s.extraHeaders||[]).slice(),this.request=new e.OutgoingRequest(this.method,r,this.ua,s.params,s.extraHeaders),s.body&&(this.body={},this.body.body=s.body,s.contentType&&(this.body.contentType=s.contentType),this.request.body=this.body),this.localIdentity=this.request.from,this.remoteIdentity=this.request.to,this.data={}},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(){return new e.RequestSender(this,this.ua).send(),this},t.prototype.cancel=function(t){t=t||{},t.extraHeaders=(t.extraHeaders||[]).slice();var i=e.Utils.getCancelReason(t.status_code,t.reason_phrase);this.request.cancel(i,t.extraHeaders),this.emit("cancel")},t.prototype.receiveResponse=function(t){var i=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,i);break;case/^2[0-9]{2}$/.test(t.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("accepted",t,i);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",t,i),this.emit("failed",t,i)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ClientContext=t}},function(e,t,i){"use strict";e.exports=function(e){var t;t=function(t,i){this.ua=t,this.logger=t.getLogger("sip.servercontext"),this.request=i,i.method===e.C.INVITE?this.transaction=new e.Transactions.InviteServerTransaction(i,t):this.transaction=new e.Transactions.NonInviteServerTransaction(i,t),i.body&&(this.body=i.body),i.hasHeader("Content-Type")&&(this.contentType=i.getHeader("Content-Type")),this.method=i.method,this.data={},this.localIdentity=i.to,this.remoteIdentity=i.from,i.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(i.getHeader("P-Asserted-Identity")))},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.progress=function(e){return e=Object.create(e||Object.prototype),e.statusCode||(e.statusCode=180),e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return e=Object.create(e||Object.prototype),e.statusCode||(e.statusCode=200),e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return e=Object.create(e||Object.prototype),e.statusCode||(e.statusCode=480),e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(t){t=t||{};var i,r=t.statusCode||100,s=t.minCode||100,n=t.maxCode||699,a=e.Utils.getReasonPhrase(r,t.reasonPhrase),o=t.extraHeaders||[],u=t.body,c=t.events||[];if(r<s||r>n)throw new TypeError("Invalid statusCode: "+r);return i=this.request.reply(r,a,o,u),c.forEach(function(e){this.emit(e,i,a)},this),this},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ServerContext=t}},function(e,t,i){"use strict";e.exports=function(e){var t,r,s,n,a,o=i(24)(e),u={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};t=function(t){if(this.status=u.STATUS_NULL,this.dialog=null,this.pendingReinvite=!1,this.earlyDialogs={},!t)throw new e.Exceptions.SessionDescriptionHandlerMissing("A session description handler is required for the session to function");this.sessionDescriptionHandlerFactory=t,this.hasOffer=!1,this.hasAnswer=!1,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null},this.startTime=null,this.endTime=null,this.tones=null,this.local_hold=!1,this.early_sdp=null,this.rel100=e.C.supported.UNSUPPORTED},t.prototype={dtmf:function(t,i){var r=[],s=this,n=this.ua.configuration.dtmfType;if(i=i||{},void 0===t)throw new TypeError("Not enough arguments");if(this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.status);if("string"!=typeof t&&"number"!=typeof t||!t.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+t);if(t=t.toString(),n===e.C.dtmfType.RTP){this.sessionDescriptionHandler.sendDtmf(t,i)||(this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method"),n=e.C.dtmfType.INFO)}if(n===e.C.dtmfType.INFO){for(t=t.split("");t.length>0;)r.push(new o(this,t.shift(),i));if(this.tones)return this.tones=this.tones.concat(r),this;this.tones=r,function t(){var r,n;if(s.status===u.STATUS_TERMINATED||!s.tones||0===s.tones.length)return s.tones=null,this;r=s.tones.shift(),r.on("failed",function(){s.tones=null}),r.send(i),n=r.duration+r.interToneGap,e.Timers.setTimeout(t,n)}()}return this},bye:function(t){t=Object.create(t||Object.prototype);var i=t.statusCode;if(this.status===u.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;if(this.logger.log("terminating Session"),i&&(i<200||i>=700))throw new TypeError("Invalid statusCode: "+i);return t.receiveResponse=function(){},this.sendRequest(e.C.BYE,t).terminated()},refer:function(t,i){if(i=i||{},this.status!==u.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.referContext=new e.ReferClientContext(this.ua,this,t,i),this.emit("referRequested",this.referContext),this.referContext.refer(i)},sendRequest:function(t,i){i=i||{};var r=this,s=new e.OutgoingRequest(t,this.dialog.remote_target,this.ua,{cseq:i.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:i.statusCode,reasonPhrase:i.reasonPhrase},i.extraHeaders||[],i.body);return new e.RequestSender({request:s,onRequestTimeout:function(){r.onRequestTimeout()},onTransportError:function(){r.onTransportError()},receiveResponse:i.receiveResponse||function(e){r.receiveNonInviteResponse(e)}},this.ua).send(),this.emit(t.toLowerCase(),s),this},close:function(){var t;if(this.status===u.STATUS_TERMINATED)return this;this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close();for(t in this.timers)e.Timers.clearTimeout(this.timers[t]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(t in this.earlyDialogs)this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t];return this.status=u.STATUS_TERMINATED,this.ua.transport.removeListener("transportError",this.errorListener),delete this.ua.sessions[this.id],this},createDialog:function(t,i,r){var s,n,a=t["UAS"===i?"to_tag":"from_tag"],o=t["UAS"===i?"from_tag":"to_tag"],u=t.call_id+a+o;if(n=this.earlyDialogs[u],r)return!!n||(n=new e.Dialog(this,t,i,e.Dialog.C.STATUS_EARLY),n.error?(this.logger.error(n.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[u]=n,!0));if(n){n.update(t,i),this.dialog=n,delete this.earlyDialogs[u];for(var c in this.earlyDialogs)this.earlyDialogs[c].terminate(),delete this.earlyDialogs[c];return!0}return s=new e.Dialog(this,t,i),s.error?(this.logger.error(s.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.to_tag=t.to_tag,this.dialog=s,!0)},hold:function(t,i){if(this.status!==u.STATUS_WAITING_FOR_ACK&&this.status!==u.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);if(this.local_hold)return void this.logger.log("Session is already on hold, cannot put it on hold again");t=t||{},t.modifiers=i||[],t.modifiers.push(this.sessionDescriptionHandler.holdModifier),this.local_hold=!0,this.sendReinvite(t)},unhold:function(t,i){if(this.status!==u.STATUS_WAITING_FOR_ACK&&this.status!==u.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);if(!this.local_hold)return void this.logger.log("Session is not on hold, cannot unhold it");t=t||{},i&&(t.modifiers=i),this.local_hold=!1,this.sendReinvite(t)},reinvite:function(e,t){return e=e||{},t&&(e.modifiers=t),this.sendReinvite(e)},receiveReinvite:function(t){var i,r=this;if(r.emit("reinvite",this),t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),"0"!==t.getHeader("Content-Length")||t.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))return t.reply(415),void this.emit("reinviteFailed",r);i=this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else i=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers);this.receiveRequest=function(t){t.method===e.C.ACK&&this.status===u.STATUS_WAITING_FOR_ACK?this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,this.emit("confirmed",t)}.bind(this))):(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,this.emit("confirmed",t)):e.Session.prototype.receiveRequest.apply(this,[t])}.bind(this),i.catch(function(i){var s;i instanceof e.Exceptions.GetDescriptionError?s=500:i instanceof e.Exceptions.RenegotiationError?(r.emit("renegotiationError",i),r.logger.warn(i),s=488):(r.logger.error(i),s=488),t.reply(s),r.emit("reinviteFailed",r)}).then(function(e){var i=["Contact: "+r.contact];t.reply(200,null,i,e,function(){r.status=u.STATUS_WAITING_FOR_ACK,r.setACKTimer(),r.emit("reinviteAccepted",r)})})},sendReinvite:function(t){if(this.pendingReinvite)return void this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");this.pendingReinvite=!0,t=t||{},t.modifiers=t.modifiers||[];var i=this,r=(t.extraHeaders||[]).slice();r.push("Contact: "+this.contact),r.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(t){i.sendRequest(e.C.INVITE,{extraHeaders:r,body:t,receiveResponse:i.receiveReinviteResponse.bind(i)})}).catch(function(t){if(t instanceof e.Exceptions.RenegotiationError)return i.pendingReinvite=!1,i.emit("renegotiationError",t),i.logger.warn("Renegotiation Error"),void i.logger.warn(t);i.logger.error("sessionDescriptionHandler error"),i.logger.error(t)})},receiveRequest:function(t){switch(t.method){case e.C.BYE:t.reply(200),this.status===u.STATUS_CONFIRMED&&(this.emit("bye",t),this.terminated(t,e.C.causes.BYE));break;case e.C.INVITE:this.status===u.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(t));break;case e.C.INFO:if(this.status===u.STATUS_CONFIRMED||this.status===u.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(t);var i,r,s,n=t.getHeader("content-type"),a=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,c=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;n&&(n.match(/^application\/dtmf-relay/i)?(t.body&&(i=t.body.split("\r\n",2),2===i.length&&(a.test(i[0])&&(r=i[0].replace(a,"$2")),c.test(i[1])&&(s=parseInt(i[1].replace(c,"$2"),10)))),new o(this,r,{duration:s}).init_incoming(t)):t.reply(415,null,["Accept: application/dtmf-relay"]))}break;case e.C.REFER:if(this.status===u.STATUS_CONFIRMED){this.logger.log("REFER received"),this.referContext=new e.ReferServerContext(this.ua,t);if(this.listeners("referRequested").length)this.emit("referRequested",this.referContext);else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var l={followRefer:!0};this.passedOptions&&(l.inviteOptions=this.passedOptions),this.referContext.accept(l,this.modifiers)}}break;case e.C.NOTIFY:if(this.referContext&&this.referContext instanceof e.ReferClientContext&&t.hasHeader("event")&&/^refer(;.*)?$/.test(t.getHeader("event")))return void this.referContext.receiveNotify(t);t.reply(200,"OK"),this.emit("notify",t);break;case e.C.UPDATE:t.reply(200,"OK")}},receiveReinviteResponse:function(t){var i=this;if(this.status!==u.STATUS_TERMINATED)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=u.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.pendingReinvite=!1,e.Timers.clearTimeout(i.timers.invite2xxTimer),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.logger.error("2XX response received to re-invite but did not have a description"),this.emit("reinviteFailed",i),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));break}this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(t){i.logger.error("Could not set the description in 2XX response"),i.logger.error(t),i.emit("reinviteFailed",i),i.emit("renegotiationError",t),i.sendRequest(e.C.BYE,{extraHeaders:["Reason: "+e.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}),i.terminated(null,e.C.causes.INCOMPATIBLE_SDP)}).then(function(){i.emit("reinviteAccepted",i)});break;default:this.pendingReinvite=!1,this.logger.log("Received a non 1XX or 2XX response to a re-invite"),this.emit("reinviteFailed",i),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("Invalid response to a re-invite"))}},acceptAndTerminate:function(t,i,r){var s=[];return i&&s.push("Reason: "+e.Utils.getReasonHeaderValue(i,r)),(this.dialog||this.createDialog(t,"UAC"))&&(this.emit("ack",t.transaction.sendACK()),this.sendRequest(e.C.BYE,{extraHeaders:s})),this},setInvite2xxTimer:function(t,i){var r=this,s=e.Timers.T1;this.timers.invite2xxTimer=e.Timers.setTimeout(function n(){if(r.status===u.STATUS_WAITING_FOR_ACK){r.logger.log("no ACK received, attempting to retransmit OK");var a=["Contact: "+r.contact];t.reply(200,null,a,i),s=Math.min(2*s,e.Timers.T2),r.timers.invite2xxTimer=e.Timers.setTimeout(n,s)}},s)},setACKTimer:function(){var t=this;this.timers.ackTimer=e.Timers.setTimeout(function(){t.status===u.STATUS_WAITING_FOR_ACK&&(t.logger.log("no ACK received for an extended period of time, terminating the call"),e.Timers.clearTimeout(t.timers.invite2xxTimer),t.sendRequest(e.C.BYE),t.terminated(null,e.C.causes.NO_ACK))},e.Timers.TIMER_H)},onTransportError:function(){this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===u.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==u.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))},onDialogError:function(t){this.status===u.STATUS_CONFIRMED?this.terminated(t,e.C.causes.DIALOG_ERROR):this.status!==u.STATUS_TERMINATED&&(this.failed(t,e.C.causes.DIALOG_ERROR),this.terminated(t,e.C.causes.DIALOG_ERROR))},failed:function(e,t){return this.status===u.STATUS_TERMINATED?this:(this.emit("failed",e||null,t||null),this)},rejected:function(e,t){return this.emit("rejected",e||null,t||null),this},canceled:function(){return this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.emit("cancel"),this},accepted:function(t,i){return i=e.Utils.getReasonPhrase(t&&t.status_code,i),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",t,i),this},terminated:function(e,t){return this.status===u.STATUS_TERMINATED?this:(this.endTime=new Date,this.close(),this.emit("terminated",e||null,t||null),this)},connecting:function(e){return this.emit("connecting",{request:e}),this}},t.C=u,e.Session=t,r=function(t,i){function r(e,t){i.hasHeader(e)&&i.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(n.rel100=t)}var s,n=this,a=i.getHeader("Content-Type"),o=i.parseHeader("Content-Disposition");if(e.Utils.augment(this,e.ServerContext,[t,i]),e.Utils.augment(this,e.Session,[t.configuration.sessionDescriptionHandlerFactory]),o&&"render"===o.type&&(this.renderbody=i.body,this.rendertype=a),this.status=u.STATUS_INVITE_RECEIVED,this.from_tag=i.from_tag,this.id=i.call_id+this.from_tag,this.request=i,this.contact=this.ua.contact.toString(),this.receiveNonInviteResponse=function(){},this.logger=t.getLogger("sip.inviteservercontext",this.id),this.ua.sessions[this.id]=this,i.hasHeader("expires")&&(s=1e3*i.getHeader("expires")),r("require",e.C.supported.REQUIRED),r("supported",e.C.supported.SUPPORTED),i.to_tag=e.Utils.newTag(),!this.createDialog(i,"UAS",!0))return void i.reply(500,"Missing Contact header field");var c={extraHeaders:["Contact: "+n.contact]};n.rel100!==e.C.supported.REQUIRED&&n.progress(c),n.status=u.STATUS_WAITING_FOR_ANSWER,n.timers.userNoAnswerTimer=e.Timers.setTimeout(function(){i.reply(408),n.failed(i,e.C.causes.NO_ANSWER),n.terminated(i,e.C.causes.NO_ANSWER)},n.ua.configuration.noAnswerTimeout),s&&(n.timers.expiresTimer=e.Timers.setTimeout(function(){n.status===u.STATUS_WAITING_FOR_ANSWER&&(i.reply(487),n.failed(i,e.C.causes.EXPIRES),n.terminated(i,e.C.causes.EXPIRES))},s)),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)},r.prototype=Object.create({},{reject:{writable:!0,value:function(t){if(this.status===u.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);return this.logger.log("rejecting RTCSession"),e.ServerContext.prototype.reject.call(this,t),this.terminated()}},terminate:{writable:!0,value:function(t){t=t||{};var i,r=(t.extraHeaders||[]).slice(),s=t.body,n=this;return this.status===u.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==e.Transactions.C.STATUS_TERMINATED?(i=this.dialog,this.receiveRequest=function(t){t.method===e.C.ACK&&(this.sendRequest(e.C.BYE,{extraHeaders:r,body:s}),i.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_TERMINATED&&this.dialog&&(this.request=new e.OutgoingRequest(e.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},r,s),new e.RequestSender({request:this.request,onRequestTimeout:function(){n.onRequestTimeout()},onTransportError:function(){n.onTransportError()},receiveResponse:function(){}},this.ua).send(),i.terminate())}),this.emit("bye",this.request),this.terminated(),this.dialog=i,this.ua.dialogs[i.id.toString()]=i):this.status===u.STATUS_CONFIRMED?this.bye(t):this.reject(t),this}},progress:{writable:!0,value:function(t){function i(){n=t.statusCode||183,this.status=u.STATUS_WAITING_FOR_PRACK,o.push("Contact: "+this.contact),o.push("Require: 100rel"),o.push("RSeq: "+Math.floor(1e4*Math.random())),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(t){if(!this.isCanceled&&this.status!==u.STATUS_TERMINATED){this.early_sdp=t.body,this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var i=e.Timers.T1;this.timers.rel1xxTimer=e.Timers.setTimeout(function r(){this.request.reply(n,null,o,t),i*=2,this.timers.rel1xxTimer=e.Timers.setTimeout(r.bind(this),i)}.bind(this),i),this.timers.prackTimer=e.Timers.setTimeout(function(){this.status===u.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),e.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),this.terminated(null,e.C.causes.NO_PRACK))}.bind(this),64*e.Timers.T1),s=this.request.reply(n,a,o,t),this.emit("progress",s,a)}}.bind(this),function(){this.request.reply(480),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))}function r(){s=this.request.reply(n,a,o,c),this.emit("progress",s,a)}t=t||{};var s,n=t.statusCode||180,a=t.reasonPhrase,o=(t.extraHeaders||[]).slice(),c=t.body;if(n<100||n>199)throw new TypeError("Invalid statusCode: "+n);return this.isCanceled||this.status===u.STATUS_TERMINATED?this:(100!==t.statusCode&&(this.rel100===e.C.supported.REQUIRED||this.rel100===e.C.supported.SUPPORTED&&t.rel100||this.rel100===e.C.supported.SUPPORTED&&this.ua.configuration.rel100===e.C.supported.REQUIRED)?(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type"))?(this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(i.apply(this)).catch(function(t){this.logger.warn("invalid description"),this.logger.warn(t),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))):i.apply(this)):r.apply(this),this)}},accept:{writable:!0,value:function(t){t=t||{},this.onInfo=t.onInfo;var i=this,r=this.request,s=(t.extraHeaders||[]).slice(),n=function(t){var n,a=function(){i.status=u.STATUS_WAITING_FOR_ACK,i.setInvite2xxTimer(r,t),i.setACKTimer()},o=function(){i.failed(null,e.C.causes.CONNECTION_ERROR),i.terminated(null,e.C.causes.CONNECTION_ERROR)};s.push("Contact: "+i.contact),s.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),i.hasOffer?i.hasAnswer=!0:i.hasOffer=!0,n=r.reply(200,null,s,t,a,o),i.status!==u.STATUS_TERMINATED&&i.accepted(n,e.Utils.getReasonPhrase(200))},a=function(){i.status!==u.STATUS_TERMINATED&&(i.request.reply(480),i.failed(null,e.C.causes.WEBRTC_ERROR),i.terminated(null,e.C.causes.WEBRTC_ERROR))};if(this.status===u.STATUS_WAITING_FOR_PRACK)return this.status=u.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===u.STATUS_WAITING_FOR_ANSWER)this.status=u.STATUS_ANSWERED;else if(this.status!==u.STATUS_EARLY_MEDIA)throw new e.Exceptions.InvalidStateError(this.status);if(!this.createDialog(r,"UAS"))return r.reply(500,"Missing Contact header field"),this;if(e.Timers.clearTimeout(this.timers.userNoAnswerTimer),this.status===u.STATUS_EARLY_MEDIA)n({});else if(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),"0"!==this.request.getHeader("Content-Length")||this.request.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")))return void this.request.reply(415);this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(function(){return this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}.bind(this)).catch(a).then(n)}else this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).catch(a).then(n);return this}},receiveRequest:{writable:!0,value:function(i){function r(){var t,r;e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,t=i.getHeader("Content-Type"),r=i.getHeader("Content-Disposition"),r&&"render"===r.type&&(this.renderbody=i.body,this.rendertype=t),this.emit("confirmed",i)}switch(i.method){case e.C.CANCEL:this.status!==u.STATUS_WAITING_FOR_ANSWER&&this.status!==u.STATUS_WAITING_FOR_PRACK&&this.status!==u.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==u.STATUS_EARLY_MEDIA&&this.status!==u.STATUS_ANSWERED||(this.status=u.STATUS_CANCELED,this.request.reply(487),this.canceled(i),this.rejected(i,e.C.causes.CANCELED),this.failed(i,e.C.causes.CANCELED),this.terminated(i,e.C.causes.CANCELED));break;case e.C.ACK:this.status===u.STATUS_WAITING_FOR_ACK&&(this.sessionDescriptionHandler.hasDescription(i.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(i.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(r.bind(this),function(t){this.logger.warn(t),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(i,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(i,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):r.apply(this));break;case e.C.PRACK:this.status===u.STATUS_WAITING_FOR_PRACK||this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),i.reply(200),this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=u.STATUS_EARLY_MEDIA,this.accept()),this.status=u.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(i.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(i.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),i.reply(200),this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=u.STATUS_EARLY_MEDIA,this.accept()),this.status=u.STATUS_EARLY_MEDIA}.bind(this),function(t){this.logger.warn(t),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(i,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(i,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(i,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(i,e.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===u.STATUS_EARLY_MEDIA&&i.reply(200);break;default:t.prototype.receiveRequest.apply(this,[i])}}},setupSessionDescriptionHandler:{writable:!0,value:function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)}},onTransportError:{writable:!0,value:function(){this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)}},onRequestTimeout:{writable:!0,value:function(){this.status===u.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==u.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}}}),e.InviteServerContext=r,s=function(t,i,r,s){r=r||{},this.passedOptions=r,r.params=Object.create(r.params||Object.prototype);var n=(r.extraHeaders||[]).slice(),a=t.configuration.sessionDescriptionHandlerFactory;if(this.sessionDescriptionHandlerFactoryOptions=t.configuration.sessionDescriptionHandlerFactoryOptions||{},this.sessionDescriptionHandlerOptions=r.sessionDescriptionHandlerOptions||{},this.modifiers=s,this.inviteWithoutSdp=r.inviteWithoutSdp||!1,this.anonymous=r.anonymous||!1,this.renderbody=r.renderbody||null,this.rendertype=r.rendertype||"text/plain",this.from_tag=e.Utils.newTag(),r.params.from_tag=this.from_tag,this.contact=t.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?!t.contact.temp_gruu:!t.contact.pub_gruu}),this.anonymous&&(r.params.from_displayName="Anonymous",r.params.from_uri="sip:anonymous@anonymous.invalid",n.push("P-Preferred-Identity: "+t.configuration.uri.toString()),n.push("Privacy: id")),n.push("Contact: "+this.contact),n.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.inviteWithoutSdp&&this.renderbody&&(n.push("Content-Type: "+this.rendertype),n.push("Content-Disposition: render;handling=optional")),t.configuration.rel100===e.C.supported.REQUIRED&&n.push("Require: 100rel"),t.configuration.replaces===e.C.supported.REQUIRED&&n.push("Require: replaces"),r.extraHeaders=n,e.Utils.augment(this,e.ClientContext,[t,e.C.INVITE,i,r]),e.Utils.augment(this,e.Session,[a]),this.status!==u.STATUS_NULL)throw new e.Exceptions.InvalidStateError(this.status);this.isCanceled=!1,this.received_100=!1,this.method=e.C.INVITE,this.receiveNonInviteResponse=this.receiveResponse,this.receiveResponse=this.receiveInviteResponse,this.logger=t.getLogger("sip.inviteclientcontext"),t.applicants[this]=this,this.id=this.request.call_id+this.from_tag,this.onInfo=r.onInfo,this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)},s.prototype=Object.create({},{invite:{writable:!0,value:function(){var t=this;return this.ua.sessions[this.id]=this,e.Utils.Promise.resolve().then(function(){this.inviteWithoutSdp?(this.request.body=t.renderbody,this.status=u.STATUS_INVITE_SENT,this.send()):(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers).then(function(e){t.isCanceled||t.status===u.STATUS_TERMINATED||(t.hasOffer=!0,t.request.body=e,t.status=u.STATUS_INVITE_SENT,t.send())},function(){t.status!==u.STATUS_TERMINATED&&(t.failed(null,e.C.causes.WEBRTC_ERROR),t.terminated(null,e.C.causes.WEBRTC_ERROR))}))}.bind(this)),this}},receiveInviteResponse:{writable:!0,value:function(t){var i,r=this,s=t.call_id+t.from_tag+t.to_tag,n=[],a={};if(this.status!==u.STATUS_TERMINATED&&t.method===e.C.INVITE){if(this.dialog&&t.status_code>=200&&t.status_code<=299){if(s!==this.dialog.id.toString()){if(!this.createDialog(t,"UAC",!0))return;return this.emit("ack",t.transaction.sendACK({body:e.Utils.generateFakeSDP(t.body)})),this.earlyDialogs[s].sendRequest(this,e.C.BYE),void(this.status!==u.STATUS_CONFIRMED&&(this.failed(t,e.C.causes.WEBRTC_ERROR),this.terminated(t,e.C.causes.WEBRTC_ERROR)))}if(this.status===u.STATUS_CONFIRMED)return void this.emit("ack",t.transaction.sendACK());if(!this.hasAnswer)return}if(this.dialog&&t.status_code<200){if(-1!==this.dialog.pracked.indexOf(t.getHeader("rseq"))||this.dialog.pracked[this.dialog.pracked.length-1]>=t.getHeader("rseq")&&this.dialog.pracked.length>0)return;if(!this.earlyDialogs[s]&&!this.createDialog(t,"UAC",!0))return;if(-1!==this.earlyDialogs[s].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[s].pracked[this.earlyDialogs[s].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[s].pracked.length>0)return;return n.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[s].pracked.push(t.getHeader("rseq")),void this.earlyDialogs[s].sendRequest(this,e.C.PRACK,{extraHeaders:n,body:e.Utils.generateFakeSDP(t.body)})}if(this.isCanceled)return void(t.status_code>=100&&t.status_code<200?(this.request.cancel(this.cancelReason,n),this.canceled(null)):t.status_code>=200&&t.status_code<299?(this.acceptAndTerminate(t),this.emit("bye",this.request)):t.status_code>=300&&(i=e.C.REASON_PHRASE[t.status_code]||e.C.causes.CANCELED,this.rejected(t,i),this.failed(t,i),this.terminated(t,i)));switch(!0){case/^100$/.test(t.status_code):this.received_100=!0,this.emit("progress",t);break;case/^1[0-9]{2}$/.test(t.status_code):if(!t.to_tag){this.logger.warn("1xx response received without to tag");break}if(t.hasHeader("contact")&&!this.createDialog(t,"UAC",!0))break;if(this.status=u.STATUS_1XX_RECEIVED,t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),t.hasHeader("require")&&-1!==t.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[s])break;if(-1!==this.earlyDialogs[s].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[s].pracked[this.earlyDialogs[s].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[s].pracked.length>0)return;if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))if(this.hasOffer){if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.dialog.pracked.push(t.getHeader("rseq")),this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){n.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),r.sendRequest(e.C.PRACK,{extraHeaders:n,receiveResponse:function(){}}),r.status=u.STATUS_EARLY_MEDIA,r.emit("progress",t)},function(i){r.logger.warn(i),r.acceptAndTerminate(t,488,"Not Acceptable Here"),r.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var o=this.earlyDialogs[s],c=o.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions);this.emit("SessionDescriptionHandler-created",c),o.pracked.push(t.getHeader("rseq")),c.setDescription(t.body,r.sessionDescriptionHandlerOptions,r.modifers).then(c.getDescription.bind(c,r.sessionDescriptionHandlerOptions,r.modifiers)).then(function(i){n.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),o.sendRequest(r,e.C.PRACK,{extraHeaders:n,body:i}),r.status=u.STATUS_EARLY_MEDIA,r.emit("progress",t)}).catch(function(i){if(i instanceof e.Exceptions.GetDescriptionError){if(o.pracked.push(t.getHeader("rseq")),r.status===u.STATUS_TERMINATED)return;r.failed(null,e.C.causes.WEBRTC_ERROR),r.terminated(null,e.C.causes.WEBRTC_ERROR)}else o.pracked.splice(o.pracked.indexOf(t.getHeader("rseq")),1),r.logger.warn("invalid description"),r.logger.warn(i)})}else n.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[s].pracked.push(t.getHeader("rseq")),this.earlyDialogs[s].sendRequest(this,e.C.PRACK,{extraHeaders:n}),this.emit("progress",t)}else this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.request.cseq+" "+this.request.method!==t.getHeader("cseq"))break;if(t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),this.status===u.STATUS_EARLY_MEDIA&&this.dialog){this.status=u.STATUS_CONFIRMED,a={},this.renderbody&&(n.push("Content-Type: "+this.rendertype),a.extraHeaders=n,a.body=this.renderbody),this.emit("ack",t.transaction.sendACK(a)),this.accepted(t);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(n.push("Content-Type: "+r.rendertype),a.extraHeaders=n,a.body=this.renderbody),this.emit("ack",t.transaction.sendACK(a));else{if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){var e={};r.status=u.STATUS_CONFIRMED,r.renderbody&&(n.push("Content-Type: "+r.rendertype),e.extraHeaders=n,e.body=r.renderbody),r.emit("ack",t.transaction.sendACK(e)),r.accepted(t)},function(i){r.logger.warn(i),r.acceptAndTerminate(t,488,"Not Acceptable Here"),r.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else if(this.earlyDialogs[s]&&this.earlyDialogs[s].sessionDescriptionHandler){if(this.hasOffer=!0,this.hasAnswer=!0,this.sessionDescriptionHandler=this.earlyDialogs[s].sessionDescriptionHandler,!this.createDialog(t,"UAC"))break;this.status=u.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.accepted(t)}else{if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers)).then(function(e){r.isCanceled||r.status===u.STATUS_TERMINATED||(r.status=u.STATUS_CONFIRMED,r.hasAnswer=!0,r.emit("ack",t.transaction.sendACK({body:e})),r.accepted(t))}).catch(function(i){i instanceof e.Exceptions.GetDescriptionError?r.logger.warn("there was a problem"):(r.logger.warn("invalid description"),r.logger.warn(i),r.acceptAndTerminate(t,488,"Invalid session description"),r.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION))})}break;default:i=e.Utils.sipErrorCause(t.status_code),this.rejected(t,i),this.failed(t,i),this.terminated(t,i)}}}},cancel:{writable:!0,value:function(t){if(t=t||{},t.extraHeaders=(t.extraHeaders||[]).slice(),this.status===u.STATUS_TERMINATED||this.status===u.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession");var i=e.Utils.getCancelReason(t.status_code,t.reason_phrase);return this.status===u.STATUS_NULL||this.status===u.STATUS_INVITE_SENT&&!this.received_100?(this.isCanceled=!0,this.cancelReason=i):this.status!==u.STATUS_INVITE_SENT&&this.status!==u.STATUS_1XX_RECEIVED&&this.status!==u.STATUS_EARLY_MEDIA||this.request.cancel(i,t.extraHeaders),this.canceled()}},terminate:{writable:!0,value:function(e){return this.status===u.STATUS_TERMINATED?this:(this.status===u.STATUS_WAITING_FOR_ACK||this.status===u.STATUS_CONFIRMED?this.bye(e):this.cancel(e),this)}},receiveRequest:{writable:!0,value:function(i){return i.method,e.C.CANCEL,i.method===e.C.ACK&&this.status===u.STATUS_WAITING_FOR_ACK&&(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,this.accepted()),t.prototype.receiveRequest.apply(this,[i])}},onTransportError:{writable:!0,value:function(){this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)}},onRequestTimeout:{writable:!0,value:function(){this.status===u.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==u.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}}}),e.InviteClientContext=s,a=function(t,i,r,s){if(this.options=s||{},this.extraHeaders=(this.options.extraHeaders||[]).slice(),void 0===t||void 0===i||void 0===r)throw new TypeError("Not enough arguments");if(e.Utils.augment(this,e.ClientContext,[t,e.C.REFER,i.remoteIdentity.uri.toString(),s]),this.applicant=i,r instanceof e.InviteServerContext||r instanceof e.InviteClientContext)this.target='"'+r.remoteIdentity.friendlyName+'" <'+r.dialog.remote_target.toString()+"?Replaces="+r.dialog.id.call_id+"%3Bto-tag%3D"+r.dialog.id.remote_tag+"%3Bfrom-tag%3D"+r.dialog.id.local_tag+">";else{try{this.target=e.Grammar.parse(r,"Refer_To").uri||r}catch(e){this.logger.debug(".refer() cannot parse Refer_To from",r),this.logger.debug("...falling through to normalizeTarget()")}if(this.target=this.ua.normalizeTarget(this.target),!this.target)throw new TypeError("Invalid target: "+r)}this.ua&&this.extraHeaders.push("Referred-By: <"+this.ua.configuration.uri+">"),this.extraHeaders.push("Contact: "+i.contact),this.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.extraHeaders.push("Refer-To: "+this.target),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)},a.prototype=Object.create({},{refer:{writable:!0,value:function(t){t=t||{};var i=(this.extraHeaders||[]).slice();return t.extraHeaders&&i.concat(t.extraHeaders),this.applicant.sendRequest(e.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(e){/^1[0-9]{2}$/.test(e.status_code)?this.emit("referRequestProgress",this):/^2[0-9]{2}$/.test(e.status_code)?this.emit("referRequestAccepted",this):/^[4-6][0-9]{2}$/.test(e.status_code)&&this.emit("referRequestRejected",this),t.receiveResponse&&t.receiveResponse(e)}.bind(this)}),this}},receiveNotify:{writable:!0,value:function(t){if(t.hasHeader("Content-Type")&&-1!==t.getHeader("Content-Type").search(/^message\/sipfrag/)){var i=e.Grammar.parse(t.body,"sipfrag");if(-1===i)return void t.reply(489,"Bad Event");switch(!0){case/^1[0-9]{2}$/.test(i.status_code):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(i.status_code):this.emit("referAccepted",this),!this.options.activeAfterTransfer&&this.applicant.terminate&&this.applicant.terminate();break;default:this.emit("referRejected",this)}return t.reply(200),void this.emit("notify",t)}t.reply(489,"Bad Event")}}}),e.ReferClientContext=a,n=function(t,i){if(e.Utils.augment(this,e.ServerContext,[t,i]),this.ua=t,this.status=u.STATUS_INVITE_RECEIVED,this.from_tag=i.from_tag,this.id=i.call_id+this.from_tag,this.request=i,this.contact=this.ua.contact.toString(),this.logger=t.getLogger("sip.referservercontext",this.id),!this.request.hasHeader("refer-to"))return this.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer."),void this.reject();this.referTo=this.request.parseHeader("refer-to"),this.referredSession=this.ua.findSession(i),this.cseq=Math.floor(1e4*Math.random()),this.call_id=this.request.call_id,this.from_uri=this.request.to.uri,this.from_tag=this.request.to.parameters.tag,this.remote_target=this.request.headers.Contact[0].parsed.uri,this.to_uri=this.request.from.uri,this.to_tag=this.request.from_tag,this.route_set=this.request.getHeaders("record-route"),this.receiveNonInviteResponse=function(){},this.request.hasHeader("referred-by")&&(this.referredBy=this.request.getHeader("referred-by")),this.referTo.uri.hasHeader("replaces")&&(this.replaces=this.referTo.uri.getHeader("replaces")),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener),this.status=u.STATUS_WAITING_FOR_ANSWER},n.prototype=Object.create({},{progress:{writable:!0,value:function(){if(this.status!==u.STATUS_WAITING_FOR_ANSWER)throw new e.Exceptions.InvalidStateError(this.status);this.request.reply(100)}},reject:{writable:!0,value:function(t){if(this.status===u.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("Rejecting refer"),this.status=u.STATUS_TERMINATED,e.ServerContext.prototype.reject.call(this,t),this.emit("referRequestRejected",this)}},accept:{writable:!0,value:function(t,i){if(t=t||{},this.status!==u.STATUS_WAITING_FOR_ANSWER)throw new e.Exceptions.InvalidStateError(this.status);if(this.status=u.STATUS_ANSWERED,this.request.reply(202,"Accepted"),this.emit("referRequestAccepted",this),t.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var r=this.referTo.uri;if(!r.scheme.match("^sips?$"))return this.logger.error("SIP.js can only automatically follow SIP refer target"),void this.reject();var s=t.inviteOptions||{},n=(s.extraHeaders||[]).slice();this.replaces&&n.push("Replaces: "+decodeURIComponent(this.replaces)),this.referredBy&&n.push("Referred-By: "+this.referredBy),s.extraHeaders=n,r.clearHeaders(),this.targetSession=this.ua.invite(r,s,i),this.emit("referInviteSent",this),this.targetSession.once("progress",function(){this.sendNotify("SIP/2.0 100 Trying"),this.emit("referProgress",this),this.referredSession&&this.referredSession.emit("referProgress",this)}.bind(this)),this.targetSession.once("accepted",function(){this.logger.log("Successfully followed the refer"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)}.bind(this));var a=function(e){if(this.status!==u.STATUS_TERMINATED){if(this.logger.log("Refer was not successful. Resuming session"),e&&429===e.status_code)return this.logger.log("Alerting referrer that identity is required."),void this.sendNotify("SIP/2.0 429 Provide Referrer Identity");this.sendNotify("SIP/2.0 603 Declined"),this.status=u.STATUS_TERMINATED,this.emit("referRejected",this),this.referredSession&&this.referredSession.emit("referRejected")}};this.targetSession.once("rejected",a.bind(this)),this.targetSession.once("failed",a.bind(this))}else this.logger.log("Accepted refer, but did not automatically follow it"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)}},sendNotify:{writable:!0,value:function(t){if(this.status!==u.STATUS_ANSWERED)throw new e.Exceptions.InvalidStateError(this.status);if(-1===e.Grammar.parse(t,"sipfrag"))throw new Error("sipfrag body is required to send notify for refer");var i=new e.OutgoingRequest(e.C.NOTIFY,this.remote_target,this.ua,{cseq:this.cseq+=1,call_id:this.call_id,from_uri:this.from_uri,from_tag:this.from_tag,to_uri:this.to_uri,to_tag:this.to_tag,route_set:this.route_set},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],t);new e.RequestSender({request:i,onRequestTimeout:function(){},onTransportError:function(){},receiveResponse:function(){}},this.ua).send()}}}),e.ReferServerContext=n}},function(e,t,i){"use strict";e.exports=function(e){var t,i={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};return t=function(i,r,s){var n,a;if(void 0===r)throw new TypeError("Not enough arguments");if(this.logger=i.ua.getLogger("sip.invitecontext.dtmf",i.id),this.owner=i,this.direction=null,s=s||{},n=s.duration||null,a=s.interToneGap||null,"string"==typeof r)r=r.toUpperCase();else{if("number"!=typeof r)throw new TypeError("Invalid tone: "+r);r=r.toString()}if(!r.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+r);if(this.tone=r,n&&!e.Utils.isDecimal(n))throw new TypeError("Invalid tone duration: "+n);if(n?n<t.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+t.C.MIN_DURATION+" milliseconds"),n=t.C.MIN_DURATION):n>t.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+t.C.MAX_DURATION+" milliseconds"),n=t.C.MAX_DURATION):n=Math.abs(n):n=t.C.DEFAULT_DURATION,this.duration=n,a&&!e.Utils.isDecimal(a))throw new TypeError("Invalid interToneGap: "+a);a?a<t.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+t.C.MIN_INTER_TONE_GAP+" milliseconds"),a=t.C.MIN_INTER_TONE_GAP):a=Math.abs(a):a=t.C.DEFAULT_INTER_TONE_GAP,this.interToneGap=a},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(t){var i,r={};if(this.direction="outgoing",this.owner.status!==e.Session.C.STATUS_CONFIRMED&&this.owner.status!==e.Session.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.owner.status);t=t||{},i=t.extraHeaders?t.extraHeaders.slice():[],r.contentType="application/dtmf-relay",r.body="Signal= "+this.tone+"\r\n",r.body+="Duration= "+this.duration,this.request=this.owner.dialog.sendRequest(this,e.C.INFO,{extraHeaders:i,body:r}),this.owner.emit("dtmf",this.request,this)},t.prototype.receiveResponse=function(t){var i;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",{originator:"remote",response:t});break;default:i=e.Utils.sipErrorCause(t.status_code),this.emit("failed",t,i)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",t,e.C.causes.DIALOG_ERROR),this.owner.onDialogError(t)},t.prototype.init_incoming=function(e){this.direction="incoming",this.request=e,e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.C=i,t}},function(e,t,i){"use strict";e.exports=function(e){e.Subscription=function(t,i,r,s){if(s=Object.create(s||Object.prototype),this.extraHeaders=s.extraHeaders=(s.extraHeaders||[]).slice(),this.id=null,this.state="init",!r)throw new TypeError("Event necessary to create a subscription.");this.event=r,"number"!=typeof s.expires?(t.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=s.expires,this.requestedExpires=this.expires,s.extraHeaders.push("Event: "+this.event),s.extraHeaders.push("Expires: "+this.expires),s.body&&(this.body=s.body),this.contact=t.contact.toString(),s.extraHeaders.push("Contact: "+this.contact),s.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),e.Utils.augment(this,e.ClientContext,[t,e.C.SUBSCRIBE,i,s]),this.logger=t.getLogger("sip.subscription"),this.dialog=null,this.timers={N:null,sub_duration:null},this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]},e.Subscription.prototype={subscribe:function(){var t=this;return"active"===this.state?(this.refresh(),this):"notify_wait"===this.state?this:(e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(t.timer_fire.bind(t),e.Timers.TIMER_N),this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]=this,this.send(),this.state="notify_wait",this)},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,e.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(t){var i,r=this,s=e.Utils.getReasonPhrase(t.status_code);"notify_wait"===this.state&&t.status_code>=300||"notify_wait"!==this.state&&-1!==this.errorCodes.indexOf(t.status_code)?this.failed(t,null):/^2[0-9]{2}$/.test(t.status_code)?(this.emit("accepted",t,s),i=t.getHeader("Expires"),i&&i<=this.requestedExpires?(this.expires=i,this.timers.sub_duration=e.Timers.setTimeout(r.refresh.bind(r),900*i)):i?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(t,e.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(t,e.C.EXPIRES_HEADER_MISSING))):t.statusCode>300&&(this.emit("failed",t,s),this.emit("rejected",t,s))},unsubscribe:function(){var t=[],i=this;this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=function(){},this.dialog.sendRequest(this,this.method,{extraHeaders:t,body:this.body}),e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(i.timer_fire.bind(i),e.Timers.TIMER_N)},timer_fire:function(){"terminated"===this.state?(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]):"notify_wait"===this.state||"pending"===this.state?this.close():this.refresh()},close:function(){"notify_wait"===this.state?(this.state="terminated",e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),this.receiveResponse=function(){},delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]):"terminated"!==this.state&&this.unsubscribe()},createConfirmedDialog:function(t,i){var r;return this.terminateDialog(),r=new e.Dialog(this,t,i),r.invite_seqnum=this.request.cseq,r.local_seqnum=this.request.cseq,!r.error&&(this.dialog=r,!0)},terminateDialog:function(){this.dialog&&(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(t){function i(){r.expires&&(e.Timers.clearTimeout(s.timers.sub_duration),r.expires=Math.min(s.expires,Math.max(r.expires,0)),s.timers.sub_duration=e.Timers.setTimeout(s.refresh.bind(s),900*r.expires))}var r,s=this;if(!this.matchEvent(t))return void t.reply(489);if(this.dialog||this.createConfirmedDialog(t,"UAS")&&(this.id=this.dialog.id.toString(),delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event],this.ua.subscriptions[this.id]=this),r=t.parseHeader("Subscription-State"),t.reply(200,e.C.REASON_200),e.Timers.clearTimeout(this.timers.N),this.emit("notify",{request:t}),"terminated"===this.state)return void("terminated"===r.state&&(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]));switch(r.state){case"active":this.state="active",i();break;case"pending":"notify_wait"===this.state&&i(),this.state="pending";break;case"terminated":if(e.Timers.clearTimeout(this.timers.sub_duration),r.reason)switch(this.logger.log("terminating subscription with reason "+r.reason),r.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(r.params&&r.params["retry-after"]?this.timers.sub_duration=e.Timers.setTimeout(s.subscribe.bind(s),r.params["retry-after"]):this.subscribe())}this.close()}},failed:function(e,t){return this.close(),this.emit("failed",e,t),this.emit("rejected",e,t),this},onDialogError:function(t){this.failed(t,e.C.causes.DIALOG_ERROR)},matchEvent:function(e){var t;return e.hasHeader("Event")?e.hasHeader("Subscription-State")?(t=e.parseHeader("event").event,this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)):(this.logger.warn("missing Subscription-State header"),!1):(this.logger.warn("missing Event header"),!1)}}}},function(e,t,i){"use strict";e.exports=function(e){var t;t=function(t,i,r,s){if(this.options=s=s||{},this.options.extraHeaders=(s.extraHeaders||[]).slice(),this.options.contentType=s.contentType||"text/plain","number"!=typeof s.expires||s.expires%1!=0?this.options.expires=3600:this.options.expires=Number(s.expires),"boolean"!=typeof s.unpublishOnClose?this.options.unpublishOnClose=!0:this.options.unpublishOnClose=s.unpublishOnClose,void 0===i||null===i||""===i)throw new e.Exceptions.MethodParameterError("Publish","Target",i);if(this.target=t.normalizeTarget(i),void 0===r||null===r||""===r)throw new e.Exceptions.MethodParameterError("Publish","Event",r);this.event=r,e.ClientContext.call(this,t,e.C.PUBLISH,this.target,this.options),this.logger=this.ua.getLogger("sip.publish"),this.pubRequestBody=null,this.pubRequestExpires=this.options.expires,this.pubRequestEtag=null,this.publish_refresh_timer=null,t.on("transportCreated",function(e){e.on("transportError",this.onTransportError.bind(this))}.bind(this))},t.prototype=Object.create(e.ClientContext.prototype),t.prototype.constructor=t,t.prototype.publish=function(t){if(this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),void 0!==t&&null!==t&&""!==t)this.options.body=t,this.pubRequestBody=this.options.body,0===this.pubRequestExpires&&(this.pubRequestExpires=this.options.expires,this.pubRequestEtag=null),this.ua.publishers[this.target.toString()+":"+this.event]||(this.ua.publishers[this.target.toString()+":"+this.event]=this);else{if(this.pubRequestBody=null,null===this.pubRequestEtag)throw new e.Exceptions.MethodParameterError("Publish","Body",t);if(0===this.pubRequestExpires)throw new e.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires)}this.sendPublishRequest()},t.prototype.unpublish=function(){this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestExpires=0,null!==this.pubRequestEtag&&this.sendPublishRequest()},t.prototype.close=function(){this.options.unpublishOnClose?this.unpublish():(this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestExpires=0,this.pubRequestEtag=null),this.ua.publishers[this.target.toString()+":"+this.event]&&delete this.ua.publishers[this.target.toString()+":"+this.event]},t.prototype.sendPublishRequest=function(){var t;t=Object.create(this.options||Object.prototype),t.extraHeaders=(this.options.extraHeaders||[]).slice(),t.extraHeaders.push("Event: "+this.event),t.extraHeaders.push("Expires: "+this.pubRequestExpires),null!==this.pubRequestEtag&&t.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag),this.request=new e.OutgoingRequest(e.C.PUBLISH,this.target,this.ua,this.options.params,t.extraHeaders),null!==this.pubRequestBody&&(this.request.body={},this.request.body.body=this.pubRequestBody,this.request.body.contentType=this.options.contentType),this.send()},t.prototype.receiveResponse=function(t){var i,r,s=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,s);break;case/^2[0-9]{2}$/.test(t.status_code):t.hasHeader("SIP-ETag")?this.pubRequestEtag=t.getHeader("SIP-ETag"):this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH"),t.hasHeader("Expires")?(i=Number(t.getHeader("Expires")),"number"==typeof i&&i>=0&&i<=this.pubRequestExpires?this.pubRequestExpires=i:this.logger.warn("Bad Expires header in a 200-class response to PUBLISH")):this.logger.warn("Expires header missing in a 200-class response to PUBLISH"),0!==this.pubRequestExpires?(this.publish_refresh_timer=e.Timers.setTimeout(this.publish.bind(this),900*this.pubRequestExpires),this.emit("published",t,s)):this.emit("unpublished",t,s);break;case/^412$/.test(t.status_code):null!==this.pubRequestEtag&&0!==this.pubRequestExpires?(this.logger.warn("412 response to PUBLISH, recovering"),this.pubRequestEtag=null,this.emit("progress",t,s),this.publish(this.options.body)):(this.logger.warn("412 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",t,s),this.emit("unpublished",t,s));break;case/^423$/.test(t.status_code):0!==this.pubRequestExpires&&t.hasHeader("Min-Expires")?(r=Number(t.getHeader("Min-Expires")),"number"==typeof r||r>this.pubRequestExpires?(this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover"),this.pubRequestExpires=r,this.emit("progress",t,s),this.publish(this.options.body)):(this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH"),this.pubRequestExpires=0,this.emit("failed",t,s),this.emit("unpublished",t,s))):(this.logger.warn("423 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",t,s),this.emit("unpublished",t,s));break;default:this.pubRequestExpires=0,this.emit("failed",t,s),this.emit("unpublished",t,s)}0===this.pubRequestExpires&&(e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestEtag=null)},t.prototype.onRequestTimeout=function(){e.ClientContext.prototype.onRequestTimeout.call(this),this.emit("unpublished",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){e.ClientContext.prototype.onTransportError.call(this),this.emit("unpublished",null,e.C.causes.CONNECTION_ERROR)},e.PublishContext=t}},function(e,t,i){"use strict";(function(t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e,s){function n(t){if(t instanceof Function)return t.initialize||(t.initialize=function(){return e.Utils.Promise.resolve()}),t}var a,o={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};a=function(t){function i(e){return r.emit.bind(r,e)}var r=this;o.ACCEPTED_BODY_TYPES=o.ACCEPTED_BODY_TYPES.toString(),this.log=new e.LoggerFactory,this.logger=this.getLogger("sip.ua"),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.data={},this.sessions={},this.subscriptions={},this.earlySubscriptions={},this.publishers={},this.transport=null,this.contact=null,this.status=o.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],i=0;for(e in t)i+=Object.keys(this.transactions[t[e]]).length;return i}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===t?t={}:("string"==typeof t||t instanceof String)&&(t={uri:t}),t.log&&(t.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=t.log.builtinEnabled),t.log.hasOwnProperty("level")&&(this.log.level=t.log.level),t.log.hasOwnProperty("connector")&&(this.log.connector=t.log.connector));try{this.loadConfig(t)}catch(e){throw this.status=o.STATUS_NOT_READY,this.error=o.CONFIGURATION_ERROR,e}this.registerContext=new e.RegisterContext(this),this.registerContext.on("failed",i("registrationFailed")),this.registerContext.on("registered",i("registered")),this.registerContext.on("unregistered",i("unregistered")),this.configuration.autostart&&this.start()},a.prototype=Object.create(e.EventEmitter.prototype),a.prototype.register=function(e){return this.configuration.register=!0,this.registerContext.register(e),this},a.prototype.unregister=function(e){this.configuration.register=!1;var t=this.registerContext;return this.transport.afterConnected(t.unregister.bind(t,e)),this},a.prototype.isRegistered=function(){return this.registerContext.registered},a.prototype.invite=function(t,i,r){var s=new e.InviteClientContext(this,t,i,r);return this.transport.afterConnected(function(){s.invite(),this.emit("inviteSent",s)}.bind(this)),s},a.prototype.subscribe=function(t,i,r){var s=new e.Subscription(this,t,i,r);return this.transport.afterConnected(s.subscribe.bind(s)),s},a.prototype.publish=function(t,i,r,s){var n=new e.PublishContext(this,t,i,s);return this.transport.afterConnected(n.publish.bind(n,r)),n},a.prototype.message=function(t,i,r){if(void 0===i)throw new TypeError("Not enough arguments");return r=Object.create(r||Object.prototype),r.contentType||(r.contentType="text/plain"),r.body=i,this.request(e.C.MESSAGE,t,r)},a.prototype.request=function(t,i,r){var s=new e.ClientContext(this,t,i,r);return this.transport.afterConnected(s.send.bind(s)),s},a.prototype.stop=function(){function e(){0===u.nistTransactionsCount&&0===u.nictTransactionsCount&&(u.removeListener("transactionDestroyed",e),u.transport.disconnect())}var i,r,n,a,u=this;if(this.logger.log("user requested closure..."),this.status===o.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;this.logger.log("closing registerContext"),this.registerContext.close();for(i in this.sessions)this.logger.log("closing session "+i),this.sessions[i].terminate();for(r in this.subscriptions)this.logger.log("unsubscribing from subscription "+r),this.subscriptions[r].close();for(r in this.earlySubscriptions)this.logger.log("unsubscribing from early subscription "+r),this.earlySubscriptions[r].close();for(a in this.publishers)this.logger.log("unpublish "+a),this.publishers[a].close();for(n in this.applicants)this.applicants[n].close();return this.status=o.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount?this.transport.disconnect():this.on("transactionDestroyed",e),"function"==typeof s.removeEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||s.removeEventListener("unload",this.environListener)),this},a.prototype.start=function(){if(this.logger.log("user requested startup..."),this.status===o.STATUS_INIT){if(this.status=o.STATUS_STARTING,!this.configuration.transportConstructor)throw new e.Exceptions.TransportError("Transport constructor not set");this.transport=new this.configuration.transportConstructor(this.getLogger("sip.transport"),this.configuration.transportOptions),this.setTransportListeners(),this.emit("transportCreated",this.transport),this.transport.connect()}else this.status===o.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=o.STATUS_READY,this.transport.connect()):this.status===o.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===o.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect");return this.configuration.autostop&&"function"==typeof s.addEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||(this.environListener=this.stop.bind(this),s.addEventListener("unload",this.environListener))),this},a.prototype.normalizeTarget=function(t){return e.Utils.normalizeTarget(t,this.configuration.hostportParams)},a.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},a.prototype.getCredentials=function(e){var t,i;return t=e.ruri.host,this.cache.credentials[t]&&this.cache.credentials[t][e.ruri]&&(i=this.cache.credentials[t][e.ruri],i.method=e.method),i},a.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},a.prototype.onTransportError=function(){this.status!==o.STATUS_USER_CLOSED&&(this.error&&this.error===o.NETWORK_ERROR||(this.status=o.STATUS_NOT_READY,this.error=o.NETWORK_ERROR))},a.prototype.setTransportListeners=function(){this.transport.on("connected",this.onTransportConnected.bind(this)),this.transport.on("message",this.onTransportReceiveMsg.bind(this)),this.transport.on("transportError",this.onTransportError.bind(this))},a.prototype.onTransportConnected=function(){this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this))},a.prototype.onTransportReceiveMsg=function(t){var i;if(t=e.Parser.parseMessage(t,this),this.status===e.UA.C.STATUS_USER_CLOSED&&t instanceof e.IncomingRequest)return void this.logger.warn("UA received message when status = USER_CLOSED - aborting");if(e.sanityCheck(t,this,this.transport))if(t instanceof e.IncomingRequest)t.transport=this.transport,this.receiveRequest(t);else if(t instanceof e.IncomingResponse)switch(t.method){case e.C.INVITE:i=this.transactions.ict[t.via_branch],i&&i.receiveResponse(t);break;case e.C.ACK:break;default:i=this.transactions.nict[t.via_branch],i&&i.receiveResponse(t)}},a.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},a.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},a.prototype.receiveRequest=function(t){function i(e){return e&&e.user===t.ruri.user}var r,s,n,a,u,c,l=t.method,h=this;if(!(i(this.configuration.uri)||i(this.contact.uri)||i(this.contact.pub_gruu)||i(this.contact.temp_gruu)))return this.logger.warn("Request-URI does not point to us"),void(t.method!==e.C.ACK&&t.reply_sl(404));if(t.ruri.scheme===e.C.SIPS)return void t.reply_sl(416);if(!e.Transactions.checkTransaction(this,t))if(l===e.C.OPTIONS?(new e.Transactions.NonInviteServerTransaction(t,this),t.reply(200,null,["Allow: "+e.UA.C.ALLOWED_METHODS.toString(),"Accept: "+o.ACCEPTED_BODY_TYPES])):l===e.C.MESSAGE?(n=new e.ServerContext(this,t),n.body=t.body,n.content_type=t.getHeader("Content-Type")||"text/plain",t.reply(200,null),this.emit("message",n)):l!==e.C.INVITE&&l!==e.C.ACK&&new e.ServerContext(this,t),t.to_tag)r=this.findDialog(t),r?(l===e.C.INVITE&&new e.Transactions.InviteServerTransaction(t,this),r.receiveRequest(t)):l===e.C.NOTIFY?(s=this.findSession(t),a=this.findEarlySubscription(t),s?s.receiveRequest(t):a?a.receiveRequest(t):(this.logger.warn("received NOTIFY request for a non existent session or subscription"),t.reply(481,"Subscription does not exist"))):l!==e.C.ACK&&t.reply(481);else switch(l){case e.C.INVITE:if(u=this.configuration.replaces!==e.C.supported.UNSUPPORTED&&t.parseHeader("replaces")){if(!(c=this.dialogs[u.call_id+u.replaces_to_tag+u.replaces_from_tag]))return void t.reply_sl(481,null);if(c.owner.status===e.Session.C.STATUS_TERMINATED)return void t.reply_sl(603,null);if(c.state===e.Dialog.C.STATUS_CONFIRMED&&u.early_only)return void t.reply_sl(486,null)}s=new e.InviteServerContext(this,t),s.replacee=c&&c.owner,h.emit("invite",s);break;case e.C.BYE:t.reply(481);break;case e.C.CANCEL:s=this.findSession(t),s?s.receiveRequest(t):this.logger.warn("received CANCEL request for a non existent session");break;case e.C.ACK:break;case e.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(t.reply(200,null),h.emit("notify",{request:t})):t.reply(481,"Subscription does not exist");break;case e.C.REFER:if(this.logger.log("Received an out of dialog refer"),this.configuration.allowOutOfDialogRefers){this.logger.log("Allow out of dialog refers is enabled on the UA");var d=new e.ReferServerContext(this,t),p=this.listeners("outOfDialogReferRequested").length;p?this.emit("outOfDialogReferRequested",d):(this.logger.log("No outOfDialogReferRequest listeners, automatically accepting and following the out of dialog refer"),d.accept({followRefer:!0}));break}t.reply(405);break;default:t.reply(405)}},a.prototype.findSession=function(e){return this.sessions[e.call_id+e.from_tag]||this.sessions[e.call_id+e.to_tag]||null},a.prototype.findDialog=function(e){return this.dialogs[e.call_id+e.from_tag+e.to_tag]||this.dialogs[e.call_id+e.to_tag+e.from_tag]||null},a.prototype.findEarlySubscription=function(e){return this.earlySubscriptions[e.call_id+e.to_tag+e.getHeader("event")]||null},a.prototype.loadConfig=function(t){function r(e,i){var r=e.replace(/([a-z][A-Z])/g,function(e){return e[0]+"_"+e[1].toLowerCase()});if(e!==r){var s=t.hasOwnProperty(e);t.hasOwnProperty(r)&&(i.warn(r+" is deprecated, please use "+e),s&&i.warn(e+" overriding "+r)),t[e]=s?t[e]:t[r]}}var s,a,o,u,c,l={viaHost:e.Utils.createRandomToken(12)+".invalid",uri:new e.URI("sip","anonymous."+e.Utils.createRandomToken(6),"anonymous.invalid",null,null),custom:{},displayName:"",password:null,registerExpires:600,register:!0,registrarServer:null,transportConstructor:i(29)(e),transportOptions:{},userAgentString:e.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},contactName:e.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:e.C.supported.UNSUPPORTED,dtmfType:e.C.dtmfType.INFO,replaces:e.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:i(30)(e).defaultFactory,authenticationFactory:n(function(t){return new e.DigestAuthentication(t)}),allowLegacyNotifications:!1,allowOutOfDialogRefers:!1},h=this.getConfigurationCheck();for(s in h.mandatory){if(r(s,this.logger),!t.hasOwnProperty(s))throw new e.Exceptions.ConfigurationError(s);if(a=t[s],void 0===(o=h.mandatory[s](a)))throw new e.Exceptions.ConfigurationError(s,a);l[s]=o}for(s in h.optional)if(r(s,this.logger),t.hasOwnProperty(s)){if((a=t[s])instanceof Array&&0===a.length)continue;if(null===a||""===a||void 0===a)continue;if("number"==typeof a&&isNaN(a))continue;if(void 0===(o=h.optional[s](a)))throw new e.Exceptions.ConfigurationError(s,a);l[s]=o}0===l.displayName&&(l.displayName="0"),l.instanceId||(l.instanceId=e.Utils.newUUID()),l.sipjsId=e.Utils.createRandomToken(5),u=l.uri.clone(),u.user=null,l.hostportParams=u.toRaw().replace(/^sip:/i,""),l.authorizationUser||(l.authorizationUser=l.uri.user),l.registrarServer||(c=l.uri.clone(),c.user=null,l.registrarServer=c),l.noAnswerTimeout=1e3*l.noAnswerTimeout,l.hackIpInContact&&("boolean"==typeof l.hackIpInContact?l.viaHost=e.Utils.getRandomTestNetIP():"string"==typeof l.hackIpInContact&&(l.viaHost=l.hackIpInContact)),l.hackWssInTransport&&(l.contactTransport="wss"),this.contact={pub_gruu:null,temp_gruu:null,uri:new e.URI("sip",l.contactName,l.viaHost,null,{transport:l.contactTransport}),toString:function(e){e=e||{};var t=e.anonymous||null,i=e.outbound||null,r="<";return r+=t?(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport="+l.contactTransport).toString():(this.pub_gruu||this.uri).toString(),i&&(r+=";ob"),r+=">"}};var d={};for(s in l)d[s]=l[s];Object.assign(this.configuration,d),this.logger.log("configuration parameters after validation:");for(s in l)switch(s){case"uri":case"registrarServer":case"sessionDescriptionHandlerFactory":this.logger.log("· "+s+": "+l[s]);break;case"password":this.logger.log("· "+s+": NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+s+": "+l[s].name);break;default:this.logger.log("· "+s+": "+JSON.stringify(l[s]))}},a.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(t){var i;return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),i=e.URI.parse(t),i&&i.user?i:void 0},transportConstructor:function(e){if(e instanceof Function)return e},transportOptions:function(e){if("object"===(void 0===e?"undefined":r(e)))return e},authorizationUser:function(t){return-1===e.Grammar.parse('"'+t+'"',"quoted_string")?void 0:t},displayName:function(t){return-1===e.Grammar.parse('"'+t+'"',"displayName")?void 0:t},dtmfType:function(t){switch(t){case e.C.dtmfType.RTP:return e.C.dtmfType.RTP;case e.C.dtmfType.INFO:default:return e.C.dtmfType.INFO}},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(t){return"boolean"==typeof t?t:"string"==typeof t&&-1!==e.Grammar.parse(t,"host")?t:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},forceRport:function(e){if("boolean"==typeof e)return e},instanceId:function(t){if("string"==typeof t)return/^uuid:/i.test(t)&&(t=t.substr(5)),-1===e.Grammar.parse(t,"uuid")?void 0:t},noAnswerTimeout:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},password:function(e){return String(e)},rel100:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},replaces:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerExpires:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},registrarServer:function(t){var i;if("string"==typeof t)return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),i=e.URI.parse(t),i?i.user?void 0:i:void 0},userAgentString:function(e){if("string"==typeof e)return e},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"===(void 0===e?"undefined":r(e)))return e},authenticationFactory:n,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"===(void 0===e?"undefined":r(e)))return e},contactName:function(e){if("string"==typeof e)return e}}}},a.C=o,e.UA=a}}).call(this,i(28))},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";(function(t){e.exports=function(e){function i(e){var t=.8*e;return 1e3*(Math.random()*(e-t)+t)}var r,s={STATUS_CONNECTING:0,STATUS_OPEN:1,STATUS_CLOSING:2,STATUS_CLOSED:3},n=(t.window||t).WebSocket;return r=function(t,i){i=e.Utils.defaultOptions({},i),this.logger=t,this.ws=null,this.server=null,this.connectionPromise=null,this.connectDeferredResolve=null,this.connectionTimeout=null,this.disconnectionPromise=null,this.disconnectDeferredResolve=null,this.boundOnOpen=null,this.boundOnMessage=null,this.boundOnClose=null,this.reconnectionAttempts=0,this.reconnectTimer=null,this.keepAliveInterval=null,this.keepAliveDebounceTimeout=null,this.status=s.STATUS_CONNECTING,this.configuration={},this.loadConfig(i)},r.prototype=Object.create(e.Transport.prototype,{isConnected:{writable:!0,value:function(){return this.status===s.STATUS_OPEN}},sendPromise:{writable:!0,value:function(t,i){if(i=i||{},!this.statusAssert(s.STATUS_OPEN,i.force))return this.onError("unable to send message - WebSocket not open"),e.Utils.Promise.reject();var r=t.toString();return this.ws?(!0===this.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+r+"\n"),this.ws.send(r),e.Utils.Promise.resolve({msg:r})):(this.onError("unable to send message - WebSocket does not exist"),e.Utils.Promise.reject())}},disconnectPromise:{writable:!0,value:function(t){return this.disconnectionPromise?this.disconnectionPromise:(t=t||{},this.statusTransition(s.STATUS_CLOSING,t.force)?(this.disconnectionPromise=new e.Utils.Promise(function(i,r){this.disconnectDeferredResolve=i,this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws?(this.stopSendingKeepAlives(),this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close(t.code,t.reason)):r("Attempted to disconnect but the websocket doesn't exist")}.bind(this)),this.disconnectionPromise):e.Utils.Promise.reject("Failed status transition - attempted to disconnect a socket that was not open"))}},connectPromise:{writable:!0,value:function(t){return this.connectionPromise?this.connectionPromise:(t=t||{},this.server=this.server||this.getNextWsServer(t.force),this.connectionPromise=new e.Utils.Promise(function(i,r){if((this.status===s.STATUS_OPEN||this.status===s.STATUS_CLOSING)&&!t.force)return this.logger.warn("WebSocket "+this.server.ws_uri+" is already connected"),void r("Failed status check - attempted to open a connection but already open/closing");this.connectDeferredResolve=i,this.status=s.STATUS_CONNECTING,this.logger.log("connecting to WebSocket "+this.server.ws_uri),this.disposeWs();try{this.ws=new n(this.server.ws_uri,"sip")}catch(e){return this.ws=null,this.status=s.STATUS_CLOSED,this.onError("error connecting to WebSocket "+this.server.ws_uri+":"+e),void r("Failed to create a websocket")}if(!this.ws)return void r("Unexpected instance websocket not set");this.connectionTimeout=e.Timers.setTimeout(function(){this.onError("took too long to connect - exceeded time set in configuration.connectionTimeout: "+this.configuration.connectionTimeout+"s")}.bind(this),1e3*this.configuration.connectionTimeout),this.boundOnOpen=this.onOpen.bind(this),this.boundOnMessage=this.onMessage.bind(this),this.boundOnClose=this.onClose.bind(this),this.ws.addEventListener("open",this.boundOnOpen),this.ws.addEventListener("message",this.boundOnMessage),this.ws.addEventListener("close",this.boundOnClose)}.bind(this)),this.connectionPromise)}},onOpen:{writable:!0,value:function(){this.status=s.STATUS_OPEN,this.emit("connected"),e.Timers.clearTimeout(this.connectionTimeout),this.logger.log("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnectionAttempts=0,this.disconnectionPromise=null,this.disconnectDeferredResolve=null,this.startSendingKeepAlives(),this.connectDeferredResolve?this.connectDeferredResolve({overrideEvent:!0}):this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")}},onClose:{writable:!0,value:function(t){if(this.logger.log("WebSocket disconnected (code: "+t.code+(t.reason?"| reason: "+t.reason:"")+")"),this.emit("disconnected",{code:t.code,reason:t.reason}),this.status!==s.STATUS_CLOSING&&(this.logger.warn("WebSocket abrupt disconnection"),this.emit("transportError")),this.stopSendingKeepAlives(),e.Timers.clearTimeout(this.connectionTimeout),this.connectionTimeout=null,this.connectionPromise=null,this.connectDeferredResolve=null,this.disconnectDeferredResolve)return this.disconnectDeferredResolve({overrideEvent:!0}),this.statusTransition(s.STATUS_CLOSED),void(this.disconnectDeferredResolve=null);this.status=s.STATUS_CLOSED,this.reconnect()}},disposeWs:{writable:!0,value:function(){this.ws&&(this.ws.removeEventListener("open",this.boundOnOpen),this.ws.removeEventListener("message",this.boundOnMessage),this.ws.removeEventListener("close",this.boundOnClose),this.boundOnOpen=null,this.boundOnMessage=null,this.boundOnClose=null,this.ws=null)}},onMessage:{writable:!0,value:function(e){var t=e.data;if("\r\n"===t)return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if(!t)return void this.logger.warn("received empty message, message discarded");if("string"!=typeof t){try{t=String.fromCharCode.apply(null,new Uint8Array(t))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+t+"\n")}else!0===this.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+t+"\n");this.emit("message",t)}},onError:{writable:!0,value:function(e){this.logger.warn("Transport error: "+e),this.emit("transportError")}},reconnect:{writable:!0,value:function(){if(this.reconnectionAttempts>0&&this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed"),this.noAvailableServers())return this.logger.warn("no available ws servers left - going to closed state"),this.status=s.STATUS_CLOSED,void this.resetServerErrorStatus();this.isConnected()&&(this.logger.warn("attempted to reconnect while connected - forcing disconnect"),this.disconnect({force:!0})),this.reconnectionAttempts+=1,this.reconnectionAttempts>this.configuration.maxReconnectionAttempts?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.logger.log("transport "+this.server.ws_uri+" failed | connection state set to 'error'"),this.server.isError=!0,this.emit("transportError"),this.server=this.getNextWsServer(),this.reconnectionAttempts=0,this.reconnect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnectionAttempts+")"),this.reconnectTimer=e.Timers.setTimeout(function(){this.connect(),this.reconnectTimer=null}.bind(this),1===this.reconnectionAttempts?0:1e3*this.configuration.reconnectionTimeout))}},resetServerErrorStatus:{writable:!0,value:function(){var e,t=this.configuration.wsServers.length;for(e=0;e<t;e++)this.configuration.wsServers[e].isError=!1}},getNextWsServer:{writable:!0,value:function(e){if(this.noAvailableServers())return void this.logger.warn("attempted to get next ws server but there are no available ws servers left");var t,i,r,s=[];for(i=this.configuration.wsServers.length,t=0;t<i;t++)r=this.configuration.wsServers[t],r.isError&&!e||(0===s.length?s.push(r):r.weight>s[0].weight?s=[r]:r.weight===s[0].weight&&s.push(r));return t=Math.floor(Math.random()*s.length),s[t]}},noAvailableServers:{writable:!0,value:function(){var e;for(e in this.configuration.wsServers)if(!this.configuration.wsServers[e].isError)return!1;return!0}},sendKeepAlive:{writable:!0,value:function(){if(!this.keepAliveDebounceTimeout)return this.keepAliveDebounceTimeout=e.Timers.setTimeout(function(){this.emit("keepAliveDebounceTimeout"),this.clearKeepAliveTimeout()}.bind(this),1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n")}},clearKeepAliveTimeout:{writable:!0,value:function(){e.Timers.clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=null}},startSendingKeepAlives:{writable:!0,value:function(){this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=e.Timers.setInterval(function(){this.sendKeepAlive(),this.startSendingKeepAlives()}.bind(this),i(this.configuration.keepAliveInterval)))}},stopSendingKeepAlives:{writable:!0,value:function(){e.Timers.clearInterval(this.keepAliveInterval),e.Timers.clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=null,this.keepAliveDebounceTimeout=null}},statusAssert:{writable:!0,value:function(e,t){return e===this.status||(t?(this.logger.warn("Attempted to assert "+Object.keys(s)[this.status]+" as "+Object.keys(s)[e]+"- continuing with option: 'force'"),!0):(this.logger.warn("Tried to assert "+Object.keys(s)[e]+" but is currently "+Object.keys(s)[this.status]),!1))}},statusTransition:{writable:!0,value:function(e,t){return this.logger.log("Attempting to transition status from "+Object.keys(s)[this.status]+" to "+Object.keys(s)[e]),e===s.STATUS_OPEN&&this.statusAssert(s.STATUS_CONNECTING,t)||e===s.STATUS_CLOSING&&this.statusAssert(s.STATUS_OPEN,t)||e===s.STATUS_CLOSED&&this.statusAssert(s.STATUS_CLOSING,t)?(this.status=e,!0):(this.logger.warn("Status transition failed - result: no-op - reason: either gave an nonexistent status or attempted illegal transition"),!1)}},loadConfig:{writable:!0,value:function(t){function i(e,i){var r=e.replace(/([a-z][A-Z])/g,function(e){return e[0]+"_"+e[1].toLowerCase()});if(e!==r){var s=t.hasOwnProperty(e);t.hasOwnProperty(r)&&(i.warn(r+" is deprecated, please use "+e),s&&i.warn(e+" overriding "+r)),t[e]=s?t[e]:t[r]}}var r,s,n,a={wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,ws_uri:"wss://edge.sip.onsip.com",isError:!1}],connectionTimeout:5,maxReconnectionAttempts:3,reconnectionTimeout:4,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!1},o=this.getConfigurationCheck();for(r in o.mandatory){if(i(r,this.logger),!t.hasOwnProperty(r))throw new e.Exceptions.ConfigurationError(r);if(s=t[r],void 0===(n=o.mandatory[r](s)))throw new e.Exceptions.ConfigurationError(r,s);a[r]=n}for(r in o.optional)if(i(r,this.logger),t.hasOwnProperty(r)){if((s=t[r])instanceof Array&&0===s.length)continue;if(null===s||""===s||void 0===s)continue;if("number"==typeof s&&isNaN(s))continue;if(void 0===(n=o.optional[r](s)))throw new e.Exceptions.ConfigurationError(r,s);a[r]=n}var u={};for(r in a)u[r]={value:a[r]};Object.defineProperties(this.configuration,u),this.logger.log("configuration parameters after validation:");for(r in a)this.logger.log("· "+r+": "+JSON.stringify(a[r]))}},getConfigurationCheck:{writable:!0,value:function(){return{mandatory:{},optional:{wsServers:function(t){var i,r,s;if("string"==typeof t)t=[{ws_uri:t}];else{if(!(t instanceof Array))return;for(r=t.length,i=0;i<r;i++)"string"==typeof t[i]&&(t[i]={ws_uri:t[i]})}if(0===t.length)return!1;for(r=t.length,i=0;i<r;i++){if(!t[i].ws_uri)return;if(t[i].weight&&!Number(t[i].weight))return;if(-1===(s=e.Grammar.parse(t[i].ws_uri,"absoluteURI")))return;if(["wss","ws","udp"].indexOf(s.scheme)<0)return;t[i].sip_uri="<sip:"+s.host+(s.port?":"+s.port:"")+";transport="+s.scheme.replace(/^wss$/i,"ws")+";lr>",t[i].weight||(t[i].weight=0),t[i].isError=!1,t[i].scheme=s.scheme.toUpperCase()}return t},keepAliveInterval:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},keepAliveDebounce:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},traceSip:function(e){if("boolean"==typeof e)return e},connectionTimeout:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},maxReconnectionAttempts:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>=0)return i},reconnectionTimeout:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i}}}}}}),r.C=s,e.Web.Transport=r,r}}).call(this,i(28))},function(e,t,i){"use strict";(function(t){e.exports=function(e){var r=function(e,i,r){this.options=r||{},this.logger=e,this.observer=i,this.dtmfSender=null,this.shouldAcquireMedia=!0,this.CONTENT_TYPE="application/sdp",this.C={},this.C.DIRECTION={NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"},this.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(this.options)),this.direction=this.C.DIRECTION.NULL,this.modifiers=this.options.modifiers||[],Array.isArray(this.modifiers)||(this.modifiers=[this.modifiers]);var s=t.window||t;this.WebRTC={MediaStream:s.MediaStream,getUserMedia:s.navigator.mediaDevices.getUserMedia.bind(s.navigator.mediaDevices),RTCPeerConnection:s.RTCPeerConnection},this.iceGatheringDeferred=null,this.iceGatheringTimeout=!1,this.iceGatheringTimer=null,this.initPeerConnection(this.options.peerConnectionOptions),this.constraints=this.checkAndDefaultConstraints(this.options.constraints)};return r.defaultFactory=function(e,t){var s=e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),n=i(31),a=new n(e,t);return new r(s,a,t)},r.prototype=Object.create(e.SessionDescriptionHandler.prototype,{close:{writable:!0,value:function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.resetIceGatheringComplete(),this.peerConnection.close())}},getDescription:{writable:!0,value:function(t,i){t=t||{},t.peerConnectionOptions&&this.initPeerConnection(t.peerConnectionOptions);var r=Object.assign({},this.constraints,t.constraints);return r=this.checkAndDefaultConstraints(r),JSON.stringify(r)!==JSON.stringify(this.constraints)&&(this.constraints=r,this.shouldAcquireMedia=!0),i=i||[],Array.isArray(i)||(i=[i]),i=i.concat(this.modifiers),e.Utils.Promise.resolve().then(function(){if(this.shouldAcquireMedia)return this.acquire(this.constraints).then(function(){this.shouldAcquireMedia=!1}.bind(this))}.bind(this)).then(function(){return this.createOfferOrAnswer(t.RTCOfferOptions,i)}.bind(this)).then(function(e){return this.emit("getDescription",e),{body:e.sdp,contentType:this.CONTENT_TYPE}}.bind(this))}},hasDescription:{writable:!0,value:function(e){return e===this.CONTENT_TYPE}},holdModifier:{writable:!0,value:function(t){return/a=(sendrecv|sendonly|recvonly|inactive)/.test(t.sdp)?(t.sdp=t.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),t.sdp=t.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):t.sdp=t.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n"),e.Utils.Promise.resolve(t)}},setDescription:{writable:!0,value:function(t,i,r){var s=this;i=i||{},i.peerConnectionOptions&&this.initPeerConnection(i.peerConnectionOptions),r=r||[],Array.isArray(r)||(r=[r]),r=r.concat(this.modifiers);var n={type:this.hasOffer("local")?"answer":"offer",sdp:t};return e.Utils.Promise.resolve().then(function(){if(this.shouldAcquireMedia&&this.options.alwaysAcquireMediaFirst)return this.acquire(this.constraints).then(function(){this.shouldAcquireMedia=!1}.bind(this))}.bind(this)).then(function(){return e.Utils.reducePromises(r,n)}).catch(function(e){throw s.logger.error("The modifiers did not resolve successfully"),s.logger.error(e),e}).then(function(e){return s.emit("setDescription",e),s.peerConnection.setRemoteDescription(e)}).catch(function(e){throw s.logger.error(e),s.emit("peerConnection-setRemoteDescriptionFailed",e),e}).then(function(){s.peerConnection.getReceivers?s.emit("setRemoteDescription",s.peerConnection.getReceivers()):s.emit("setRemoteDescription",s.peerConnection.getRemoteStreams()),s.emit("confirmed",s)})}},sendDtmf:{writable:!0,value:function(e,t){if(!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var i=this.peerConnection.getSenders();i.length>0&&(this.dtmfSender=i[0].dtmf)}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var r=this.peerConnection.getLocalStreams();if(r.length>0){var s=r[0].getAudioTracks();s.length>0&&(this.dtmfSender=this.peerConnection.createDTMFSender(s[0]))}}if(!this.dtmfSender)return!1;try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if("InvalidStateError"===e.type||"InvalidCharacterError"===e.type)return this.logger.error(e),!1;throw e}return this.logger.log("DTMF sent via RTP: "+e.toString()),!0}},getDirection:{writable:!0,value:function(){return this.direction}},createOfferOrAnswer:{writable:!0,value:function(t,i){var r,s=this,n=this.peerConnection;return t=t||{},r=s.hasOffer("remote")?"createAnswer":"createOffer",n[r](t).catch(function(e){throw s.emit("peerConnection-"+r+"Failed",e),e}).then(function(t){return e.Utils.reducePromises(i,s.createRTCSessionDescriptionInit(t))}).then(function(e){return s.resetIceGatheringComplete(),n.setLocalDescription(e)}).catch(function(e){throw s.emit("peerConnection-SetLocalDescriptionFailed",e),e}).then(function(){return s.waitForIceGatheringComplete()}).then(function(){var t=s.createRTCSessionDescriptionInit(s.peerConnection.localDescription);return e.Utils.reducePromises(i,t)}).then(function(e){return s.setDirection(e.sdp),e}).catch(function(t){throw s.logger.error(t),new e.Exceptions.GetDescriptionError(t)})}},createRTCSessionDescriptionInit:{writable:!0,value:function(e){return{type:e.type,sdp:e.sdp}}},addDefaultIceCheckingTimeout:{writable:!0,value:function(e){return void 0===e.iceCheckingTimeout&&(e.iceCheckingTimeout=5e3),e}},addDefaultIceServers:{writable:!0,value:function(e){return e.iceServers||(e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]),e}},checkAndDefaultConstraints:{writable:!0,value:function(e){var t={audio:!0,video:!this.options.alwaysAcquireMediaFirst};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e}},hasBrowserTrackSupport:{writable:!0,value:function(){return Boolean(this.peerConnection.addTrack)}},hasBrowserGetSenderSupport:{writable:!0,value:function(){return Boolean(this.peerConnection.getSenders)}},initPeerConnection:{writable:!0,value:function(t){var i=this;t=t||{},t=this.addDefaultIceCheckingTimeout(t),t.rtcConfiguration=t.rtcConfiguration||{},t.rtcConfiguration=this.addDefaultIceServers(t.rtcConfiguration),this.logger.log("initPeerConnection"),this.peerConnection&&(this.logger.log("Already have a peer connection for this session. Tearing down."),this.resetIceGatheringComplete(),this.peerConnection.close()),this.peerConnection=new this.WebRTC.RTCPeerConnection(t.rtcConfiguration),this.logger.log("New peer connection created"),"ontrack"in this.peerConnection?this.peerConnection.addEventListener("track",function(e){i.logger.log("track added"),i.observer.trackAdded(),i.emit("addTrack",e)}):(this.logger.warn("Using onaddstream which is deprecated"),this.peerConnection.onaddstream=function(e){i.logger.log("stream added"),i.emit("addStream",e)}),this.peerConnection.onicecandidate=function(e){i.emit("iceCandidate",e),e.candidate&&i.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim()))},this.peerConnection.onicegatheringstatechange=function(){switch(i.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState),this.iceGatheringState){case"gathering":i.emit("iceGathering",this),!i.iceGatheringTimer&&t.iceCheckingTimeout&&(i.iceGatheringTimeout=!1,i.iceGatheringTimer=e.Timers.setTimeout(function(){i.logger.log("RTCIceChecking Timeout Triggered after "+t.iceCheckingTimeout+" milliseconds"),i.iceGatheringTimeout=!0,i.triggerIceGatheringComplete()},t.iceCheckingTimeout));break;case"complete":i.triggerIceGatheringComplete()}},this.peerConnection.oniceconnectionstatechange=function(){var e;switch(this.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void i.logger.warn("Unknown iceConnection state:",this.iceConnectionState)}i.emit(e,this)}}},acquire:{writable:!0,value:function(t){return t=this.checkAndDefaultConstraints(t),new e.Utils.Promise(function(e,i){this.logger.log("acquiring local media"),this.emit("userMediaRequest",t),t.audio||t.video?this.WebRTC.getUserMedia(t).then(function(t){this.observer.trackAdded(),this.emit("userMedia",t),e(t)}.bind(this)).catch(function(e){this.emit("userMediaFailed",e),i(e)}.bind(this)):e([])}.bind(this)).catch(function(t){return this.logger.error("unable to acquire streams"),this.logger.error(t),e.Utils.Promise.reject(t)}.bind(this)).then(function(t){this.logger.log("acquired local media streams");try{return this.peerConnection.removeTrack&&this.peerConnection.getSenders().forEach(function(e){this.peerConnection.removeTrack(e)},this),t}catch(t){return e.Utils.Promise.reject(t)}}.bind(this)).catch(function(t){return this.logger.error("error removing streams"),this.logger.error(t),e.Utils.Promise.reject(t)}.bind(this)).then(function(t){try{t=[].concat(t),t.forEach(function(e){this.peerConnection.addTrack?e.getTracks().forEach(function(t){this.peerConnection.addTrack(t,e)},this):this.peerConnection.addStream(e)},this)}catch(t){return e.Utils.Promise.reject(t)}return e.Utils.Promise.resolve()}.bind(this)).catch(function(t){return this.logger.error("error adding stream"),this.logger.error(t),e.Utils.Promise.reject(t)}.bind(this))}},hasOffer:{writable:!0,value:function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t}},isIceGatheringComplete:{writable:!0,value:function(){return"complete"===this.peerConnection.iceGatheringState||this.iceGatheringTimeout}},resetIceGatheringComplete:{writable:!0,value:function(){this.iceGatheringTimeout=!1,this.iceGatheringTimer&&(e.Timers.clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=null),this.iceGatheringDeferred&&(this.iceGatheringDeferred.reject(),this.iceGatheringDeferred=null)}},setDirection:{writable:!0,value:function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(null===t)return this.direction=this.C.DIRECTION.NULL,void this.observer.directionChanged();var i=t[1];switch(i){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=i;break;default:this.direction=this.C.DIRECTION.NULL}this.observer.directionChanged()}},triggerIceGatheringComplete:{writable:!0,value:function(){this.isIceGatheringComplete()&&(this.emit("iceGatheringComplete",this),this.iceGatheringTimer&&(e.Timers.clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=null),this.iceGatheringDeferred&&(this.iceGatheringDeferred.resolve(),this.iceGatheringDeferred=null))}},waitForIceGatheringComplete:{writable:!0,value:function(){return this.isIceGatheringComplete()?e.Utils.Promise.resolve():(this.isIceGatheringDeferred||(this.iceGatheringDeferred=e.Utils.defer()),this.iceGatheringDeferred.promise)}}}),r}}).call(this,i(28))},function(e,t,i){"use strict";var r=function(e,t){this.session=e||{},this.options=t||{}};r.prototype={trackAdded:function(){this.session.emit("trackAdded")},directionChanged:function(){this.session.emit("directionChanged")}},e.exports=r},function(e,t,i){"use strict";e.exports=function(e){function t(t,i,r){var s,n=e.Utils.buildStatusLine(t),a=i.getHeaders("via"),o=a.length,u=0;for(u;u<o;u++)n+="Via: "+a[u]+"\r\n";s=i.getHeader("To"),i.to_tag||(s+=";tag="+e.Utils.newTag()),n+="To: "+s+"\r\n",n+="From: "+i.getHeader("From")+"\r\n",n+="Call-ID: "+i.call_id+"\r\n",n+="CSeq: "+i.cseq+" "+i.method+"\r\n",n+="\r\n",r.send(n)}function i(e,i,r){if(!e.ruri||"sip"!==e.ruri.scheme)return t(416,e,r),!1}function r(e,i,r){if(!e.to_tag&&e.call_id.substr(0,5)===i.configuration.sipjsId)return t(482,e,r),!1}function s(i,r,s){if(e.Utils.str_utf8_length(i.body)<i.getHeader("content-length"))return t(400,i,s),!1}function n(i,r,s){var n,a,o=i.from_tag,u=i.call_id,c=i.cseq;if(!i.to_tag)if(i.method===e.C.INVITE){if(n=r.transactions.ist[i.via_branch])return;for(a in r.transactions.ist)if(n=r.transactions.ist[a],n.request.from_tag===o&&n.request.call_id===u&&n.request.cseq===c)return t(482,i,s),!1}else{if(n=r.transactions.nist[i.via_branch])return;for(a in r.transactions.nist)if(n=r.transactions.nist[a],n.request.from_tag===o&&n.request.call_id===u&&n.request.cseq===c)return t(482,i,s),!1}}function a(e,t){if(e.getHeaders("via").length>1)return t.getLogger("sip.sanitycheck").warn("More than one Via header field present in the response. Dropping the response"),!1}function o(e,t){var i=t.configuration.viaHost;if(e.via.host!==i||void 0!==e.via.port)return t.getLogger("sip.sanitycheck").warn("Via sent-by in the response does not match UA Via host value. Dropping the response"),!1}function u(t,i){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return i.getLogger("sip.sanitycheck").warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1}function c(e,t){for(var i=["from","to","call_id","cseq","via"],r=i.length;r--;)if(!e.hasHeader(i[r]))return t.getLogger("sip.sanitycheck").warn("Missing mandatory header field : "+i[r]+". Dropping the response"),!1}var l,h=[],d=[],p=[];h.push(i),h.push(r),h.push(s),h.push(n),d.push(a),d.push(o),d.push(u),p.push(c),l=function(t,i,r){var s;for(s=p.length;s--;)if(!1===p[s](t,i,r))return!1;if(t instanceof e.IncomingRequest){for(s=h.length;s--;)if(!1===h[s](t,i,r))return!1}else if(t instanceof e.IncomingResponse)for(s=d.length;s--;)if(!1===d[s](t,i,r))return!1;return!0},e.sanityCheck=l}},function(e,t,i){"use strict";var r=i(34);e.exports=function(e){var t;return t=function(e){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null},t.prototype.authenticate=function(t,i){if(this.algorithm=i.algorithm,this.realm=i.realm,this.nonce=i.nonce,this.opaque=i.opaque,this.stale=i.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(i.qop)if(i.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(i.qop.indexOf("auth-int")>-1))return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=e.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},t.prototype.calculateResponse=function(){var e,t;e=r(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(t=r(this.method+":"+this.uri),this.response=r(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=r(this.method+":"+this.uri+":"+r(this.body?this.body:"")),this.response=r(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):null===this.qop&&(t=r(this.method+":"+this.uri),this.response=r(e+":"+this.nonce+":"+t))},t.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},t.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},t}},function(e,t,i){!function(r,s){e.exports=t=function(e){return function(t){function i(e,t,i,r,s,n,a){var o=e+(t&i|~t&r)+s+a;return(o<<n|o>>>32-n)+t}function r(e,t,i,r,s,n,a){var o=e+(t&r|i&~r)+s+a;return(o<<n|o>>>32-n)+t}function s(e,t,i,r,s,n,a){var o=e+(t^i^r)+s+a;return(o<<n|o>>>32-n)+t}function n(e,t,i,r,s,n,a){var o=e+(i^(t|~r))+s+a;return(o<<n|o>>>32-n)+t}var a=e,o=a.lib,u=o.WordArray,c=o.Hasher,l=a.algo,h=[];!function(){for(var e=0;e<64;e++)h[e]=4294967296*t.abs(t.sin(e+1))|0}();var d=l.MD5=c.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var a=0;a<16;a++){var o=t+a,u=e[o];e[o]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var c=this._hash.words,l=e[t+0],d=e[t+1],p=e[t+2],f=e[t+3],g=e[t+4],m=e[t+5],T=e[t+6],v=e[t+7],_=e[t+8],E=e[t+9],S=e[t+10],C=e[t+11],y=e[t+12],A=e[t+13],R=e[t+14],b=e[t+15],I=c[0],w=c[1],D=c[2],O=c[3];I=i(I,w,D,O,l,7,h[0]),O=i(O,I,w,D,d,12,h[1]),D=i(D,O,I,w,p,17,h[2]),w=i(w,D,O,I,f,22,h[3]),I=i(I,w,D,O,g,7,h[4]),O=i(O,I,w,D,m,12,h[5]),D=i(D,O,I,w,T,17,h[6]),w=i(w,D,O,I,v,22,h[7]),I=i(I,w,D,O,_,7,h[8]),O=i(O,I,w,D,E,12,h[9]),D=i(D,O,I,w,S,17,h[10]),w=i(w,D,O,I,C,22,h[11]),I=i(I,w,D,O,y,7,h[12]),O=i(O,I,w,D,A,12,h[13]),D=i(D,O,I,w,R,17,h[14]),w=i(w,D,O,I,b,22,h[15]),I=r(I,w,D,O,d,5,h[16]),O=r(O,I,w,D,T,9,h[17]),D=r(D,O,I,w,C,14,h[18]),w=r(w,D,O,I,l,20,h[19]),I=r(I,w,D,O,m,5,h[20]),O=r(O,I,w,D,S,9,h[21]),D=r(D,O,I,w,b,14,h[22]),w=r(w,D,O,I,g,20,h[23]),I=r(I,w,D,O,E,5,h[24]),O=r(O,I,w,D,R,9,h[25]),D=r(D,O,I,w,f,14,h[26]),w=r(w,D,O,I,_,20,h[27]),I=r(I,w,D,O,A,5,h[28]),O=r(O,I,w,D,p,9,h[29]),D=r(D,O,I,w,v,14,h[30]),w=r(w,D,O,I,y,20,h[31]),I=s(I,w,D,O,m,4,h[32]),O=s(O,I,w,D,_,11,h[33]),D=s(D,O,I,w,C,16,h[34]),w=s(w,D,O,I,R,23,h[35]),I=s(I,w,D,O,d,4,h[36]),O=s(O,I,w,D,g,11,h[37]),D=s(D,O,I,w,v,16,h[38]),w=s(w,D,O,I,S,23,h[39]),I=s(I,w,D,O,A,4,h[40]),O=s(O,I,w,D,l,11,h[41]),D=s(D,O,I,w,f,16,h[42]),w=s(w,D,O,I,T,23,h[43]),I=s(I,w,D,O,E,4,h[44]),O=s(O,I,w,D,y,11,h[45]),D=s(D,O,I,w,b,16,h[46]),w=s(w,D,O,I,p,23,h[47]),I=n(I,w,D,O,l,6,h[48]),O=n(O,I,w,D,v,10,h[49]),D=n(D,O,I,w,R,15,h[50]),w=n(w,D,O,I,m,21,h[51]),I=n(I,w,D,O,y,6,h[52]),O=n(O,I,w,D,f,10,h[53]),D=n(D,O,I,w,S,15,h[54]),w=n(w,D,O,I,d,21,h[55]),I=n(I,w,D,O,_,6,h[56]),O=n(O,I,w,D,b,10,h[57]),D=n(D,O,I,w,T,15,h[58]),w=n(w,D,O,I,A,21,h[59]),I=n(I,w,D,O,g,6,h[60]),O=n(O,I,w,D,C,10,h[61]),D=n(D,O,I,w,p,15,h[62]),w=n(w,D,O,I,E,21,h[63]),c[0]=c[0]+I|0,c[1]=c[1]+w|0,c[2]=c[2]+D|0,c[3]=c[3]+O|0},_doFinalize:function(){var e=this._data,i=e.words,r=8*this._nDataBytes,s=8*e.sigBytes;i[s>>>5]|=128<<24-s%32;var n=t.floor(r/4294967296),a=r;i[15+(s+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),i[14+(s+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),e.sigBytes=4*(i.length+1),this._process();for(var o=this._hash,u=o.words,c=0;c<4;c++){var l=u[c];u[c]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return o},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e}});a.MD5=c._createHelper(d),a.HmacMD5=c._createHmacHelper(d)}(Math),e.MD5}(i(35))}()},function(e,t,i){!function(i,r){e.exports=t=function(){var e=e||function(e,t){var i=Object.create||function(){function e(){}return function(t){var i;return e.prototype=t,i=new e,e.prototype=null,i}}(),r={},s=r.lib={},n=s.Base=function(){return{extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),a=s.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,i=e.words,r=this.sigBytes,s=e.sigBytes;if(this.clamp(),r%4)for(var n=0;n<s;n++){var a=i[n>>>2]>>>24-n%4*8&255;t[r+n>>>2]|=a<<24-(r+n)%4*8}else for(var n=0;n<s;n+=4)t[r+n>>>2]=i[n>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i,r=[],s=0;s<t;s+=4){var n=function(t){var t=t,i=987654321,r=4294967295;return function(){i=36969*(65535&i)+(i>>16)&r,t=18e3*(65535&t)+(t>>16)&r;var s=(i<<16)+t&r;return s/=4294967296,(s+=.5)*(e.random()>.5?1:-1)}}(4294967296*(i||e.random()));i=987654071*n(),r.push(4294967296*n()|0)}return new a.init(r,t)}}),o=r.enc={},u=o.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,r=[],s=0;s<i;s++){var n=t[s>>>2]>>>24-s%4*8&255;r.push((n>>>4).toString(16)),r.push((15&n).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r+=2)i[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(i,t/2)}},c=o.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,r=[],s=0;s<i;s++){var n=t[s>>>2]>>>24-s%4*8&255;r.push(String.fromCharCode(n))}return r.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r++)i[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(i,t)}},l=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},h=s.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,r=i.words,s=i.sigBytes,n=this.blockSize,o=4*n,u=s/o;u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0);var c=u*n,l=e.min(4*c,s);if(c){for(var h=0;h<c;h+=n)this._doProcessBlock(r,h);var d=r.splice(0,c);i.sigBytes-=l}return new a.init(d,l)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(s.Hasher=h.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new d.HMAC.init(e,i).finalize(t)}}}),r.algo={});return r}(Math);return e}()}()},function(e,t,i){"use strict";var r=i(37);e.exports=function(e){return{parse:function(t,i){var s={startRule:i,SIP:e};try{r.parse(t,s)}catch(e){s.data=-1}return s.data}}}},function(e,t,i){"use strict";function r(e,t,i,s){this.message=e,this.expected=t,this.found=i,this.location=s,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}function s(e,t){function i(){return e.substring(C,S)}function s(){return c(C,S)}function n(e,t){return{type:"literal",text:e,ignoreCase:t}}function a(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function o(e){return{type:"other",description:e}}function u(t){var i,r=y[t];if(r)return r;for(i=t-1;!y[i];)i--;for(r=y[i],r={line:r.line,column:r.column};i<t;)10===e.charCodeAt(i)?(r.line++,r.column=1):r.column++,i++;return y[t]=r,r}function c(e,t){var i=u(e),r=u(t);return{start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:r.line,column:r.column}}}function l(e){S<A||(S>A&&(A=S,R=[]),R.push(e))}function h(e,t,i){return new r(r.buildMessage(e,t),e,t,i)}function d(e){var t,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=e.charCodeAt(t)-32;return i}function p(t){for(var i,r,s=E[t],n=0,a=[],o=s.length,u=[],c=[];;){for(;n<o;)switch(s[n]){case 0:c.push(_[s[n+1]]),n+=2;break;case 1:c.push(void 0),n++;break;case 2:c.push(null),n++;break;case 3:c.push(m),n++;break;case 4:c.push([]),n++;break;case 5:c.push(S),n++;break;case 6:c.pop(),n++;break;case 7:S=c.pop(),n++;break;case 8:c.length-=s[n+1],n+=2;break;case 9:c.splice(-2,1),n++;break;case 10:c[c.length-2].push(c.pop()),n++;break;case 11:c.push(c.splice(c.length-s[n+1],s[n+1])),n+=2;break;case 12:c.push(e.substring(c.pop(),S)),n++;break;case 13:u.push(o),a.push(n+3+s[n+1]+s[n+2]),c[c.length-1]?(o=n+3+s[n+1],n+=3):(o=n+3+s[n+1]+s[n+2],n+=3+s[n+1]);break;case 14:u.push(o),a.push(n+3+s[n+1]+s[n+2]),c[c.length-1]===m?(o=n+3+s[n+1],n+=3):(o=n+3+s[n+1]+s[n+2],n+=3+s[n+1]);break;case 15:u.push(o),a.push(n+3+s[n+1]+s[n+2]),c[c.length-1]!==m?(o=n+3+s[n+1],n+=3):(o=n+3+s[n+1]+s[n+2],n+=3+s[n+1]);break;case 16:c[c.length-1]!==m?(u.push(o),a.push(n),o=n+2+s[n+1],n+=2):n+=2+s[n+1];break;case 17:u.push(o),a.push(n+3+s[n+1]+s[n+2]),e.length>S?(o=n+3+s[n+1],n+=3):(o=n+3+s[n+1]+s[n+2],n+=3+s[n+1]);break;case 18:u.push(o),a.push(n+4+s[n+2]+s[n+3]),e.substr(S,_[s[n+1]].length)===_[s[n+1]]?(o=n+4+s[n+2],n+=4):(o=n+4+s[n+2]+s[n+3],n+=4+s[n+2]);break;case 19:u.push(o),a.push(n+4+s[n+2]+s[n+3]),e.substr(S,_[s[n+1]].length).toLowerCase()===_[s[n+1]]?(o=n+4+s[n+2],n+=4):(o=n+4+s[n+2]+s[n+3],n+=4+s[n+2]);break;case 20:u.push(o),a.push(n+4+s[n+2]+s[n+3]),_[s[n+1]].test(e.charAt(S))?(o=n+4+s[n+2],n+=4):(o=n+4+s[n+2]+s[n+3],n+=4+s[n+2]);break;case 21:c.push(e.substr(S,s[n+1])),S+=s[n+1],n+=2;break;case 22:c.push(_[s[n+1]]),S+=_[s[n+1]].length,n+=2;break;case 23:c.push(m),0===b&&l(_[s[n+1]]),n+=2;break;case 24:C=c[c.length-1-s[n+1]],n+=2;break;case 25:C=S,n++;break;case 26:for(i=s.slice(n+4,n+4+s[n+3]),r=0;r<s[n+3];r++)i[r]=c[c.length-1-i[r]];c.splice(c.length-s[n+2],s[n+2],_[s[n+1]].apply(null,i)),n+=4+s[n+3];break;case 27:c.push(p(s[n+1])),n+=2;break;case 28:b++,n++;break;case 29:b--,n++;break;default:throw new Error("Invalid opcode: "+s[n]+".")}if(!(u.length>0))break;o=u.pop(),n=a.pop()}return c[0]}function f(e,t){return[e].concat(t)}t=void 0!==t?t:{};var g,m={},T={Contact:119,Name_Addr_Header:156,Record_Route:176,Request_Response:81,SIP_URI:45,Subscription_State:186,Supported:191,Require:182,Via:194,absoluteURI:84,Call_ID:118,Content_Disposition:130,Content_Length:135,Content_Type:136,CSeq:146,displayName:122,Event:149,From:151,host:52,Max_Forwards:154,Min_SE:213,Proxy_Authenticate:157,quoted_string:40,Refer_To:178,Replaces:179,Session_Expires:210,stun_URI:217,To:192,turn_URI:223,uuid:226,WWW_Authenticate:209,challenge:158,sipfrag:230,Referred_By:231},v=119,_=["\r\n",n("\r\n",!1),/^[0-9]/,a([["0","9"]],!1,!1),/^[a-zA-Z]/,a([["a","z"],["A","Z"]],!1,!1),/^[0-9a-fA-F]/,a([["0","9"],["a","f"],["A","F"]],!1,!1),/^[\0-\xFF]/,a([["\0","ÿ"]],!1,!1),/^["]/,a(['"'],!1,!1)," ",n(" ",!1),"\t",n("\t",!1),/^[a-zA-Z0-9]/,a([["a","z"],["A","Z"],["0","9"]],!1,!1),";",n(";",!1),"/",n("/",!1),"?",n("?",!1),":",n(":",!1),"@",n("@",!1),"&",n("&",!1),"=",n("=",!1),"+",n("+",!1),"$",n("$",!1),",",n(",",!1),"-",n("-",!1),"_",n("_",!1),".",n(".",!1),"!",n("!",!1),"~",n("~",!1),"*",n("*",!1),"'",n("'",!1),"(",n("(",!1),")",n(")",!1),"%",n("%",!1),function(){return" "},function(){return":"},/^[!-~]/,a([["!","~"]],!1,!1),/^[\x80-\uFFFF]/,a([["","￿"]],!1,!1),/^[\x80-\xBF]/,a([["","¿"]],!1,!1),/^[a-f]/,a([["a","f"]],!1,!1),"`",n("`",!1),"<",n("<",!1),">",n(">",!1),"\\",n("\\",!1),"[",n("[",!1),"]",n("]",!1),"{",n("{",!1),"}",n("}",!1),function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,a([["!","'"]],!1,!1),/^[*-[]/,a([["*","["]],!1,!1),/^[\]-~]/,a([["]","~"]],!1,!1),function(e){return e},/^[#-[]/,a([["#","["]],!1,!1),/^[\0-\t]/,a([["\0","\t"]],!1,!1),/^[\x0B-\f]/,a([["\v","\f"]],!1,!1),/^[\x0E-\x7F]/,a([["",""]],!1,!1),function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},"sips",n("sips",!0),"sip",n("sip",!0),function(e){t.data.scheme=e},function(){t.data.user=decodeURIComponent(i().slice(0,-1))},function(){t.data.password=i()},function(){return t.data.host=i(),t.data.host},function(){return t.data.host_type="domain",i()},/^[a-zA-Z0-9_\-]/,a([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),/^[a-zA-Z0-9\-]/,a([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),function(){return t.data.host_type="IPv6",i()},"::",n("::",!1),function(){return t.data.host_type="IPv6",i()},function(){return t.data.host_type="IPv4",i()},"25",n("25",!1),/^[0-5]/,a([["0","5"]],!1,!1),"2",n("2",!1),/^[0-4]/,a([["0","4"]],!1,!1),"1",n("1",!1),/^[1-9]/,a([["1","9"]],!1,!1),function(e){return e=parseInt(e.join("")),t.data.port=e,e},"transport=",n("transport=",!0),"udp",n("udp",!0),"tcp",n("tcp",!0),"sctp",n("sctp",!0),"tls",n("tls",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},"user=",n("user=",!0),"phone",n("phone",!0),"ip",n("ip",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},"method=",n("method=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},"ttl=",n("ttl=",!0),function(e){t.data.params||(t.data.params={}),t.data.params.ttl=e},"maddr=",n("maddr=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},"lr",n("lr",!0),function(){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},function(e,i){t.data.uri_params||(t.data.uri_params={}),i=null===i?void 0:i[1],t.data.uri_params[e.toLowerCase()]=i&&i.toLowerCase()},function(e,i){e=e.join("").toLowerCase(),i=i.join(""),t.data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(i):t.data.uri_headers[e]=[i]},function(){"Refer_To"===t.startRule&&(t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},"//",n("//",!1),function(){t.data.scheme=i()},n("SIP",!0),function(){t.data.sip_version=i()},"INVITE",n("INVITE",!1),"ACK",n("ACK",!1),"VXACH",n("VXACH",!1),"OPTIONS",n("OPTIONS",!1),"BYE",n("BYE",!1),"CANCEL",n("CANCEL",!1),"REGISTER",n("REGISTER",!1),"SUBSCRIBE",n("SUBSCRIBE",!1),"NOTIFY",n("NOTIFY",!1),"REFER",n("REFER",!1),"PUBLISH",n("PUBLISH",!1),function(){return t.data.method=i(),t.data.method},function(e){t.data.status_code=parseInt(e.join(""))},function(){t.data.reason_phrase=i()},function(){t.data=i()},function(){var e,i;for(i=t.data.multi_header.length,e=0;e<i;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:S,offset:s().start.offset,parsed:e})},function(e){e=i().trim(),'"'===e[0]&&(e=e.substring(1,e.length-1)),t.data.displayName=e},"q",n("q",!0),function(e){t.data.params||(t.data.params={}),t.data.params.q=e},"expires",n("expires",!0),function(e){t.data.params||(t.data.params={}),t.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",n("0",!1),function(){return parseFloat(i())},function(e,i){t.data.params||(t.data.params={}),i=null===i?void 0:i[1],t.data.params[e.toLowerCase()]=i},"render",n("render",!0),"session",n("session",!0),"icon",n("icon",!0),"alert",n("alert",!0),function(){"Content_Disposition"===t.startRule&&(t.data.type=i().toLowerCase())},"handling",n("handling",!0),"optional",n("optional",!0),"required",n("required",!0),function(e){t.data=parseInt(e.join(""))},function(){t.data=i()},"text",n("text",!0),"image",n("image",!0),"audio",n("audio",!0),"video",n("video",!0),"application",n("application",!0),"message",n("message",!0),"multipart",n("multipart",!0),"x-",n("x-",!0),function(e){t.data.value=parseInt(e.join(""))},function(e){t.data=e},function(e){t.data.event=e.toLowerCase()},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"tag",n("tag",!0),function(e){t.data.tag=e},function(e){t.data=parseInt(e.join(""))},function(e){t.data=e},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},"digest",n("Digest",!0),"realm",n("realm",!0),function(e){t.data.realm=e},"domain",n("domain",!0),"nonce",n("nonce",!0),function(e){t.data.nonce=e},"opaque",n("opaque",!0),function(e){t.data.opaque=e},"stale",n("stale",!0),"true",n("true",!0),function(){t.data.stale=!0},"false",n("false",!0),function(){t.data.stale=!1},"algorithm",n("algorithm",!0),"md5",n("MD5",!0),"md5-sess",n("MD5-sess",!0),function(e){t.data.algorithm=e.toUpperCase()},"qop",n("qop",!0),"auth-int",n("auth-int",!0),"auth",n("auth",!0),function(e){t.data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},function(e){t.data.value=parseInt(e.join(""))},function(){var e,i;for(i=t.data.multi_header.length,e=0;e<i;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:S,offset:s().start.offset,parsed:e})},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},function(){t.data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},function(){t.data={call_id:t.data}},"from-tag",n("from-tag",!0),function(e){t.data.replaces_from_tag=e},"to-tag",n("to-tag",!0),function(e){t.data.replaces_to_tag=e},"early-only",n("early-only",!0),function(){t.data.early_only=!0},function(e,t){return t},function(e,t){return f(e,t)},function(e){"Require"===t.startRule&&(t.data=e||[])},function(e){t.data.value=parseInt(e.join(""))},"active",n("active",!0),"pending",n("pending",!0),"terminated",n("terminated",!0),function(){t.data.state=i()},"reason",n("reason",!0),function(e){void 0!==e&&(t.data.reason=e)},function(e){void 0!==e&&(t.data.expires=e)},"retry_after",n("retry_after",!0),function(e){void 0!==e&&(t.data.retry_after=e)},"deactivated",n("deactivated",!0),"probation",n("probation",!0),"rejected",n("rejected",!0),"timeout",n("timeout",!0),"giveup",n("giveup",!0),"noresource",n("noresource",!0),"invariant",n("invariant",!0),function(e){"Supported"===t.startRule&&(t.data=e||[])},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"ttl",n("ttl",!0),function(e){t.data.ttl=e},"maddr",n("maddr",!0),function(e){t.data.maddr=e},"received",n("received",!0),function(e){t.data.received=e},"branch",n("branch",!0),function(e){t.data.branch=e},"rport",n("rport",!0),function(){"undefined"!=typeof response_port&&(t.data.rport=response_port.join(""))},function(e){t.data.protocol=e},n("UDP",!0),n("TCP",!0),n("TLS",!0),n("SCTP",!0),function(e){t.data.transport=e},function(){t.data.host=i()},function(e){t.data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===t.startRule&&(t.data.deltaSeconds=e)},"refresher",n("refresher",!1),"uas",n("uas",!1),"uac",n("uac",!1),function(e){"Session_Expires"===t.startRule&&(t.data.refresher=e)},function(e){"Min_SE"===t.startRule&&(t.data=e)},"stuns",n("stuns",!0),"stun",n("stun",!0),function(e){t.data.scheme=e},function(e){t.data.host=e},"?transport=",n("?transport=",!1),"turns",n("turns",!0),"turn",n("turn",!0),function(){t.data.transport=transport},function(){t.data=i()},"Referred-By",n("Referred-By",!1),"b",n("b",!1),"cid",n("cid",!1)],E=[d('2 ""6 7!'),d('4"""5!7#'),d('4$""5!7%'),d('4&""5!7\''),d(";'.# &;("),d('4(""5!7)'),d('4*""5!7+'),d('2,""6,7-'),d('2.""6.7/'),d('40""5!71'),d('22""6273. &24""6475.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),d(";).# &;,"),d('2F""6F7G.} &2H""6H7I.q &2J""6J7K.e &2L""6L7M.Y &2N""6N7O.M &2P""6P7Q.A &2R""6R7S.5 &2T""6T7U.) &2V""6V7W'),d('%%2X""6X7Y/5#;#/,$;#/#$+#)(#\'#("\'#&\'#/"!&,)'),d('%%$;$0#*;$&/,#; /#$+")("\'#&\'#." &"/=#$;$/&#0#*;$&&&#/\'$8":Z" )("\'#&\'#'),d(';.." &"'),d("%$;'.# &;(0)*;'.# &;(&/?#28\"\"6879/0$;//'$8#:[# )(#'#(\"'#&'#"),d('%%$;2/&#0#*;2&&&#/g#$%$;.0#*;.&/,#;2/#$+")("\'#&\'#0=*%$;.0#*;.&/,#;2/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),d('4\\""5!7].# &;3'),d('4^""5!7_'),d('4`""5!7a'),d(';!.) &4b""5!7c'),d('%$;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),d('%$;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),d('2T""6T7U.ã &2V""6V7W.× &2f""6f7g.Ë &2h""6h7i.¿ &2:""6:7;.³ &2D""6D7E.§ &22""6273. &28""6879. &2j""6j7k. &;&.} &24""6475.q &2l""6l7m.e &2n""6n7o.Y &26""6677.M &2>""6>7?.A &2p""6p7q.5 &2r""6r7s.) &;\'.# &;('),d('%$;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s/Ĵ#0ı*;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s&&&#/"!&,)'),d("%;//?#2P\"\"6P7Q/0$;//'$8#:t# )(#'#(\"'#&'#"),d("%;//?#24\"\"6475/0$;//'$8#:u# )(#'#(\"'#&'#"),d("%;//?#2>\"\"6>7?/0$;//'$8#:v# )(#'#(\"'#&'#"),d("%;//?#2T\"\"6T7U/0$;//'$8#:w# )(#'#(\"'#&'#"),d("%;//?#2V\"\"6V7W/0$;//'$8#:x# )(#'#(\"'#&'#"),d('%2h""6h7i/0#;//\'$8":y" )("\'#&\'#'),d('%;//6#2f""6f7g/\'$8":z" )("\'#&\'#'),d("%;//?#2D\"\"6D7E/0$;//'$8#:{# )(#'#(\"'#&'#"),d("%;//?#22\"\"6273/0$;//'$8#:|# )(#'#(\"'#&'#"),d("%;//?#28\"\"6879/0$;//'$8#:}# )(#'#(\"'#&'#"),d("%;//0#;&/'$8\":~\" )(\"'#&'#"),d("%;&/0#;//'$8\":~\" )(\"'#&'#"),d("%;=/T#$;G.) &;K.# &;F0/*;G.) &;K.# &;F&/,$;>/#$+#)(#'#(\"'#&'#"),d('4""5!7.A &4""5!7.5 &4""5!7.) &;3.# &;.'),d("%%;//Q#;&/H$$;J.# &;K0)*;J.# &;K&/,$;&/#$+$)($'#(#'#(\"'#&'#/\"!&,)"),d("%;//]#;&/T$%$;J.# &;K0)*;J.# &;K&/\"!&,)/1$;&/($8$:$!!)($'#(#'#(\"'#&'#"),d(';..G &2L""6L7M.; &4""5!7./ &4""5!7.# &;3'),d('%2j""6j7k/J#4""5!7.5 &4""5!7.) &4""5!7/#$+")("\'#&\'#'),d("%;N/M#28\"\"6879/>$;O.\" &\"/0$;S/'$8$:$ )($'#(#'#(\"'#&'#"),d("%;N/d#28\"\"6879/U$;O.\" &\"/G$;S/>$;_/5$;l.\" &\"/'$8&:& )(&'#(%'#($'#(#'#(\"'#&'#"),d('%3""5$7.) &3""5#7/\' 8!:!! )'),d('%;P/]#%28""6879/,#;R/#$+")("\'#&\'#." &"/6$2:""6:7;/\'$8#:# )(#\'#("\'#&\'#'),d("$;+.) &;-.# &;Q/2#0/*;+.) &;-.# &;Q&&&#"),d('2<""6<7=.q &2>""6>7?.e &2@""6@7A.Y &2B""6B7C.M &2D""6D7E.A &22""6273.5 &26""6677.) &24""6475'),d('%$;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E0e*;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E&/& 8!:! )'),d('%;T/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),d("%;U.) &;\\.# &;X/& 8!:! )"),d('%$%;V/2#2J""6J7K/#$+")("\'#&\'#0<*%;V/2#2J""6J7K/#$+")("\'#&\'#&/D#;W/;$2J""6J7K." &"/\'$8#:# )(#\'#("\'#&\'#'),d('$4""5!7/,#0)*4""5!7&&&#'),d('%4$""5!7%/?#$4""5!70)*4""5!7&/#$+")("\'#&\'#'),d('%2l""6l7m/?#;Y/6$2n""6n7o/\'$8#:# )(#\'#("\'#&\'#'),d('%%;Z/³#28""6879/¤$;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+-)(-\'#(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ސ &%2""67/¤#;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+,)(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.۹ &%2""67/#;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ٺ &%2""67/t#;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ؓ &%2""67/\\#;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+&)(&\'#(%\'#($\'#(#\'#("\'#&\'#.ׄ &%2""67/D#;Z/;$28""6879/,$;[/#$+$)($\'#(#\'#("\'#&\'#.֍ &%2""67/,#;[/#$+")("\'#&\'#.ծ &%2""67/,#;Z/#$+")("\'#&\'#.Տ &%;Z/#2""67/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$++)(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ӈ &%;Z/ª#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$2""67/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.а &%;Z/¹#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/k$2""67/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+))()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ί &%;Z/È#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¡$%28""6879/,#;Z/#$+")("\'#&\'#." &"/z$%28""6879/,#;Z/#$+")("\'#&\'#." &"/S$2""67/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.˕ &%;Z/×#%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;[/#$+\')(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ȑ &%;Z/þ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/×$%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;Z/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ħ &%;Z/Ĝ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/õ$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Î$%28""6879/,#;Z/#$+")("\'#&\'#." &"/§$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Y$%28""6879/,#;Z/#$+")("\'#&\'#." &"/2$2""67/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#/& 8!: ! )'),d('%;#/M#;#." &"/?$;#." &"/1$;#." &"/#$+$)($\'#(#\'#("\'#&\'#'),d("%;Z/;#28\"\"6879/,$;Z/#$+#)(#'#(\"'#&'#.# &;\\"),d("%;]/o#2J\"\"6J7K/`$;]/W$2J\"\"6J7K/H$;]/?$2J\"\"6J7K/0$;]/'$8':¡' )(''#(&'#(%'#($'#(#'#(\"'#&'#"),d('%2¢""6¢7£/2#4¤""5!7¥/#$+")("\'#&\'#. &%2¦""6¦7§/;#4¨""5!7©/,$;!/#$+#)(#\'#("\'#&\'#.j &%2ª""6ª7«/5#;!/,$;!/#$+#)(#\'#("\'#&\'#.B &%4¬""5!7­/,#;!/#$+")("\'#&\'#.# &;!'),d('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:®!! )'),d('$%22""6273/,#;`/#$+")("\'#&\'#0<*%22""6273/,#;`/#$+")("\'#&\'#&'),d(";a.A &;b.; &;c.5 &;d./ &;e.) &;f.# &;g"),d('%3¯""5*7°/a#3±""5#7².G &3³""5#7´.; &3µ""5$7¶./ &3·""5#7¸.# &;6/($8":¹"! )("\'#&\'#'),d('%3º""5%7»/I#3¼""5%7½./ &3¾""5"7¿.# &;6/($8":À"! )("\'#&\'#'),d('%3Á""5\'7Â/1#;/($8":Ã"! )("\'#&\'#'),d('%3Ä""5$7Å/1#;ð/($8":Æ"! )("\'#&\'#'),d('%3Ç""5&7È/1#;T/($8":É"! )("\'#&\'#'),d('%3Ê""5"7Ë/N#%2>""6>7?/,#;6/#$+")("\'#&\'#." &"/\'$8":Ì" )("\'#&\'#'),d('%;h/P#%2>""6>7?/,#;i/#$+")("\'#&\'#." &"/)$8":Í""! )("\'#&\'#'),d('%$;j/&#0#*;j&&&#/"!&,)'),d('%$;j/&#0#*;j&&&#/"!&,)'),d(";k.) &;+.# &;-"),d('2l""6l7m.e &2n""6n7o.Y &24""6475.M &28""6879.A &2<""6<7=.5 &2@""6@7A.) &2B""6B7C'),d('%26""6677/n#;m/e$$%2<""6<7=/,#;m/#$+")("\'#&\'#0<*%2<""6<7=/,#;m/#$+")("\'#&\'#&/#$+#)(#\'#("\'#&\'#'),d('%;n/A#2>""6>7?/2$;o/)$8#:Î#"" )(#\'#("\'#&\'#'),d("$;p.) &;+.# &;-/2#0/*;p.) &;+.# &;-&&&#"),d("$;p.) &;+.# &;-0/*;p.) &;+.# &;-&"),d('2l""6l7m.e &2n""6n7o.Y &24""6475.M &26""6677.A &28""6879.5 &2@""6@7A.) &2B""6B7C'),d(";.# &;r"),d("%;/G#;'/>$;s/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),d(";M.# &;t"),d("%;/E#28\"\"6879/6$;u.# &;x/'$8#:Ï# )(#'#(\"'#&'#"),d('%;v.# &;w/J#%26""6677/,#;/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),d('%2Ð""6Ð7Ñ/:#;/1$;w." &"/#$+#)(#\'#("\'#&\'#'),d('%24""6475/,#;{/#$+")("\'#&\'#'),d("%;z/3#$;y0#*;y&/#$+\")(\"'#&'#"),d(";*.) &;+.# &;-"),d(';+. &;-. &22""6273.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),d('%;|/e#$%24""6475/,#;|/#$+")("\'#&\'#0<*%24""6475/,#;|/#$+")("\'#&\'#&/#$+")("\'#&\'#'),d('%$;~0#*;~&/e#$%22""6273/,#;}/#$+")("\'#&\'#0<*%22""6273/,#;}/#$+")("\'#&\'#&/#$+")("\'#&\'#'),d("$;~0#*;~&"),d(';+.w &;-.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),d('%%;"/#$;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K0M*;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K&/#$+")("\'#&\'#/& 8!:Ò! )'),d(";.# &;"),d('%%;O/2#2:""6:7;/#$+")("\'#&\'#." &"/,#;S/#$+")("\'#&\'#." &"'),d('$;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A/#0*;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A&&&#'),d("$;y0#*;y&"),d('%3""5#7Ó/q#24""6475/b$$;!/&#0#*;!&&&#/L$2J""6J7K/=$$;!/&#0#*;!&&&#/\'$8%:Ô% )(%\'#($\'#(#\'#("\'#&\'#'),d('2Õ""6Õ7Ö'),d('2×""6×7Ø'),d('2Ù""6Ù7Ú'),d('2Û""6Û7Ü'),d('2Ý""6Ý7Þ'),d('2ß""6ß7à'),d('2á""6á7â'),d('2ã""6ã7ä'),d('2å""6å7æ'),d('2ç""6ç7è'),d('2é""6é7ê'),d("%;.Y &;.S &;.M &;.G &;.A &;.; &;.5 &;./ &;.) &;.# &;6/& 8!:ë! )"),d("%;/G#;'/>$;/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),d("%;/' 8!:ì!! )"),d("%;!/5#;!/,$;!/#$+#)(#'#(\"'#&'#"),d("%$;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(0G*;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(&/& 8!:í! )"),d("%;¶/Y#$%;A/,#;¶/#$+\")(\"'#&'#06*%;A/,#;¶/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),d('%;9/N#%2:""6:7;/,#;9/#$+")("\'#&\'#." &"/\'$8":î" )("\'#&\'#'),d("%;:.c &%;/Y#$%;A/,#;/#$+\")(\"'#&'#06*%;A/,#;/#$+\")(\"'#&'#&/#$+\")(\"'#&'#/& 8!:ï! )"),d("%;L.# &;/]#$%;B/,#;/#$+\")(\"'#&'#06*%;B/,#;/#$+\")(\"'#&'#&/'$8\":ð\" )(\"'#&'#"),d("%;.\" &\"/>#;@/5$;M/,$;?/#$+$)($'#(#'#(\"'#&'#"),d("%%;6/Y#$%;./,#;6/#$+\")(\"'#&'#06*%;./,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#.# &;H/' 8!:ñ!! )"),d(";.) &;.# &; "),d("%3ò\"\"5!7ó/:#;</1$;/($8#:ô#! )(#'#(\"'#&'#"),d("%3õ\"\"5'7ö/:#;</1$;/($8#:÷#! )(#'#(\"'#&'#"),d("%$;!/&#0#*;!&&&#/' 8!:ø!! )"),d('%2ù""6ù7ú/o#%2J""6J7K/M#;!." &"/?$;!." &"/1$;!." &"/#$+$)($\'#(#\'#("\'#&\'#." &"/\'$8":û" )("\'#&\'#'),d('%;6/J#%;</,#;¡/#$+")("\'#&\'#." &"/)$8":ü""! )("\'#&\'#'),d(";6.) &;T.# &;H"),d("%;£/Y#$%;B/,#;¤/#$+\")(\"'#&'#06*%;B/,#;¤/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),d('%3ý""5&7þ.G &3ÿ""5\'7Ā.; &3ā""5$7Ă./ &3ă""5%7Ą.# &;6/& 8!:ą! )'),d(";¥.# &; "),d('%3Ć""5(7ć/M#;</D$3Ĉ""5(7ĉ./ &3Ċ""5(7ċ.# &;6/#$+#)(#\'#("\'#&\'#'),d("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),d("%$;!/&#0#*;!&&&#/' 8!:Č!! )"),d("%;©/& 8!:č! )"),d("%;ª/k#;;/b$;¯/Y$$%;B/,#;°/#$+\")(\"'#&'#06*%;B/,#;°/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),d(";«.# &;¬"),d('3Ď""5$7ď.S &3Đ""5%7đ.G &3Ē""5%7ē.; &3Ĕ""5%7ĕ./ &3Ė""5+7ė.# &;­'),d('3Ę""5\'7ę./ &3Ě""5)7ě.# &;­'),d(";6.# &;®"),d('%3Ĝ""5"7ĝ/,#;6/#$+")("\'#&\'#'),d(";­.# &;6"),d("%;6/5#;</,$;±/#$+#)(#'#(\"'#&'#"),d(";6.# &;H"),d("%;³/5#;./,$;/#$+#)(#'#(\"'#&'#"),d("%$;!/&#0#*;!&&&#/' 8!:Ğ!! )"),d("%;/' 8!:ğ!! )"),d('%;¶/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ġ"!!)("\'#&\'#'),d('%%;7/e#$%2J""6J7K/,#;7/#$+")("\'#&\'#0<*%2J""6J7K/,#;7/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),d("%;L.# &;/]#$%;B/,#;¸/#$+\")(\"'#&'#06*%;B/,#;¸/#$+\")(\"'#&'#&/'$8\":ġ\" )(\"'#&'#"),d(";¹.# &; "),d("%3Ģ\"\"5#7ģ/:#;</1$;6/($8#:Ĥ#! )(#'#(\"'#&'#"),d("%$;!/&#0#*;!&&&#/' 8!:ĥ!! )"),d("%;/' 8!:Ħ!! )"),d("%$;0#*;&/x#;@/o$;M/f$;?/]$$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8%:ħ% )(%'#($'#(#'#(\"'#&'#"),d(";¾"),d("%3Ĩ\"\"5&7ĩ/k#;./b$;Á/Y$$%;A/,#;Á/#$+\")(\"'#&'#06*%;A/,#;Á/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#.# &;¿"),d("%;6/k#;./b$;À/Y$$%;A/,#;À/#$+\")(\"'#&'#06*%;A/,#;À/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),d("%;6/;#;</2$;6.# &;H/#$+#)(#'#(\"'#&'#"),d(";Â.G &;Ä.A &;Æ.; &;È.5 &;É./ &;Ê.) &;Ë.# &;À"),d("%3Ī\"\"5%7ī/5#;</,$;Ã/#$+#)(#'#(\"'#&'#"),d("%;I/' 8!:Ĭ!! )"),d("%3ĭ\"\"5&7Į/#;</$;D/$;Å/|$$%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#0C*%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#&/,$;E/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),d(";t.# &;w"),d("%3į\"\"5%7İ/5#;</,$;Ç/#$+#)(#'#(\"'#&'#"),d("%;I/' 8!:ı!! )"),d("%3Ĳ\"\"5&7ĳ/:#;</1$;I/($8#:Ĵ#! )(#'#(\"'#&'#"),d('%3ĵ""5%7Ķ/]#;</T$%3ķ""5$7ĸ/& 8!:Ĺ! ).4 &%3ĺ""5%7Ļ/& 8!:ļ! )/#$+#)(#\'#("\'#&\'#'),d('%3Ľ""5)7ľ/R#;</I$3Ŀ""5#7ŀ./ &3Ł""5(7ł.# &;6/($8#:Ń#! )(#\'#("\'#&\'#'),d('%3ń""5#7Ņ/#;</$;D/$%;Ì/e#$%2D""6D7E/,#;Ì/#$+")("\'#&\'#0<*%2D""6D7E/,#;Ì/#$+")("\'#&\'#&/#$+")("\'#&\'#/,$;E/#$+%)(%\'#($\'#(#\'#("\'#&\'#'),d('%3ņ""5(7Ň./ &3ň""5$7ŉ.# &;6/\' 8!:Ŋ!! )'),d("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),d("%;Ï/G#;./>$;Ï/5$;./,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),d("%$;!/&#0#*;!&&&#/' 8!:ŋ!! )"),d("%;Ñ/]#$%;A/,#;Ñ/#$+\")(\"'#&'#06*%;A/,#;Ñ/#$+\")(\"'#&'#&/'$8\":Ō\" )(\"'#&'#"),d("%;/]#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8\":ō\" )(\"'#&'#"),d('%;L.O &;.I &%;@." &"/:#;t/1$;?." &"/#$+#)(#\'#("\'#&\'#/]#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/\'$8":Ŏ" )("\'#&\'#'),d("%;Ô/]#$%;B/,#;Õ/#$+\")(\"'#&'#06*%;B/,#;Õ/#$+\")(\"'#&'#&/'$8\":ŏ\" )(\"'#&'#"),d("%;/& 8!:Ő! )"),d('%3ő""5(7Œ/:#;</1$;6/($8#:œ#! )(#\'#("\'#&\'#.g &%3Ŕ""5&7ŕ/:#;</1$;6/($8#:Ŗ#! )(#\'#("\'#&\'#.: &%3ŗ""5*7Ř/& 8!:ř! ).# &; '),d('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:Ŝ!! )'),d("%;Ø/Y#$%;A/,#;Ø/#$+\")(\"'#&'#06*%;A/,#;Ø/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),d("%;/Y#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),d("%$;!/&#0#*;!&&&#/' 8!:ŝ!! )"),d("%;Û/Y#$%;B/,#;Ü/#$+\")(\"'#&'#06*%;B/,#;Ü/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),d('%3Ş""5&7ş.; &3Š""5\'7š./ &3Ţ""5*7ţ.# &;6/& 8!:Ť! )'),d("%3ť\"\"5&7Ŧ/:#;</1$;Ý/($8#:ŧ#! )(#'#(\"'#&'#.} &%3õ\"\"5'7ö/:#;</1$;/($8#:Ũ#! )(#'#(\"'#&'#.P &%3ũ\"\"5+7Ū/:#;</1$;/($8#:ū#! )(#'#(\"'#&'#.# &; "),d('3Ŭ""5+7ŭ.k &3Ů""5)7ů._ &3Ű""5(7ű.S &3Ų""5\'7ų.G &3Ŵ""5&7ŵ.; &3Ŷ""5*7ŷ./ &3Ÿ""5)7Ź.# &;6'),d(';1." &"'),d('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:ź!! )'),d("%;L.# &;/]#$%;B/,#;á/#$+\")(\"'#&'#06*%;B/,#;á/#$+\")(\"'#&'#&/'$8\":Ż\" )(\"'#&'#"),d(";¹.# &; "),d("%;ã/Y#$%;A/,#;ã/#$+\")(\"'#&'#06*%;A/,#;ã/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),d("%;ê/k#;./b$;í/Y$$%;B/,#;ä/#$+\")(\"'#&'#06*%;B/,#;ä/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),d(";å.; &;æ.5 &;ç./ &;è.) &;é.# &; "),d("%3ż\"\"5#7Ž/:#;</1$;ð/($8#:ž#! )(#'#(\"'#&'#"),d("%3ſ\"\"5%7ƀ/:#;</1$;T/($8#:Ɓ#! )(#'#(\"'#&'#"),d("%3Ƃ\"\"5(7ƃ/@#;</7$;\\.# &;Y/($8#:Ƅ#! )(#'#(\"'#&'#"),d("%3ƅ\"\"5&7Ɔ/:#;</1$;6/($8#:Ƈ#! )(#'#(\"'#&'#"),d('%3ƈ""5%7Ɖ/O#%;</3#$;!0#*;!&/#$+")("\'#&\'#." &"/\'$8":Ɗ" )("\'#&\'#'),d("%;ë/G#;;/>$;6/5$;;/,$;ì/#$+%)(%'#($'#(#'#(\"'#&'#"),d('%3""5#7Ó.# &;6/\' 8!:Ƌ!! )'),d('%3±""5#7ƌ.G &3³""5#7ƍ.; &3·""5#7Ǝ./ &3µ""5$7Ə.# &;6/\' 8!:Ɛ!! )'),d('%;î/D#%;C/,#;ï/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),d("%;U.) &;\\.# &;X/& 8!:Ƒ! )"),d('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:ƒ!! )'),d('%%;!/?#;!." &"/1$;!." &"/#$+#)(#\'#("\'#&\'#/\' 8!:Ɠ!! )'),d(";¾"),d('%;/^#$%;B/,#;ó/#$+")("\'#&\'#06*%;B/,#;ó/#$+")("\'#&\'#&/($8":Ɣ"!!)("\'#&\'#'),d(";ô.# &; "),d('%2ƕ""6ƕ7Ɩ/L#;</C$2Ɨ""6Ɨ7Ƙ.) &2ƙ""6ƙ7ƚ/($8#:ƛ#! )(#\'#("\'#&\'#'),d('%;/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ɯ"!!)("\'#&\'#'),d("%;6/5#;0/,$;÷/#$+#)(#'#(\"'#&'#"),d("$;2.) &;4.# &;.0/*;2.) &;4.# &;.&"),d("$;%0#*;%&"),d("%;ú/;#28\"\"6879/,$;û/#$+#)(#'#(\"'#&'#"),d('%3Ɲ""5%7ƞ.) &3Ɵ""5$7Ơ/\' 8!:ơ!! )'),d('%;ü/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),d("%;\\.) &;X.# &;/' 8!:Ƣ!! )"),d(';".S &;!.M &2F""6F7G.A &2J""6J7K.5 &2H""6H7I.) &2N""6N7O'),d('2L""6L7M. &2B""6B7C. &2<""6<7=.} &2R""6R7S.q &2T""6T7U.e &2V""6V7W.Y &2P""6P7Q.M &2@""6@7A.A &2D""6D7E.5 &22""6273.) &2>""6>7?'),d('%;Ā/b#28""6879/S$;û/J$%2ƣ""6ƣ7Ƥ/,#;ì/#$+")("\'#&\'#." &"/#$+$)($\'#(#\'#("\'#&\'#'),d('%3ƥ""5%7Ʀ.) &3Ƨ""5$7ƨ/\' 8!:ơ!! )'),d('%;ì/O#3±""5#7².6 &3³""5#7´.* &$;+0#*;+&/\'$8":Ʃ" )("\'#&\'#'),d("%;Ą/#2F\"\"6F7G/x$;ă/o$2F\"\"6F7G/`$;ă/W$2F\"\"6F7G/H$;ă/?$2F\"\"6F7G/0$;ą/'$8):ƪ) )()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),d("%;#/>#;#/5$;#/,$;#/#$+$)($'#(#'#(\"'#&'#"),d("%;ă/,#;ă/#$+\")(\"'#&'#"),d("%;ă/5#;ă/,$;ă/#$+#)(#'#(\"'#&'#"),d("%;/U#;'/L$;/C$;'/:$;/1$; .\" &\"/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),d('%2ƫ""6ƫ7Ƭ.) &2ƭ""6ƭ7Ʈ/w#;0/n$;Ĉ/e$$%;B/2#;ĉ.# &; /#$+")("\'#&\'#0<*%;B/2#;ĉ.# &; /#$+")("\'#&\'#&/#$+$)($\'#(#\'#("\'#&\'#'),d(";.# &;L"),d("%2Ư\"\"6Ư7ư/5#;</,$;Ċ/#$+#)(#'#(\"'#&'#"),d("%;D/S#;,/J$2:\"\"6:7;/;$;,.# &;T/,$;E/#$+%)(%'#($'#(#'#(\"'#&'#")],S=0,C=0,y=[{line:1,column:1}],A=0,R=[],b=0;if("startRule"in t){if(!(t.startRule in T))throw new Error("Can't start parsing from rule \""+t.startRule+'".');v=T[t.startRule]}if(t.data={},(g=p(v))!==m&&S===e.length)return g;throw g!==m&&S<e.length&&l(function(){return{type:"end"}}()),h(R,A<e.length?e.charAt(A):null,A<e.length?c(A,A+1):c(A,A))}!function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(r,Error),r.buildMessage=function(e,t){function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function n(e){return a[e.type](e)}var a={literal:function(e){return'"'+r(e.text)+'"'},class:function(e){var t,i="";for(t=0;t<e.parts.length;t++)i+=e.parts[t]instanceof Array?s(e.parts[t][0])+"-"+s(e.parts[t][1]):s(e.parts[t]);return"["+(e.inverted?"^":"")+i+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){var t,i,r=new Array(e.length);for(t=0;t<e.length;t++)r[t]=n(e[t]);if(r.sort(),r.length>0){for(t=1,i=1;t<r.length;t++)r[t-1]!==r[t]&&(r[i]=r[t],i++);r.length=i}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(e)+" but "+function(e){return e?'"'+r(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:r,parse:s}},function(e,t,i){"use strict";e.exports=function(e){function t(e,t){var i,r,s=[],n=e.split(/\r\n/);for(i=0;i<n.length;){var a=n[i];if(/^m=(?:audio|video)/.test(a))r={index:i,stripped:[]},s.push(r);else if(r){var o=/^a=rtpmap:(\d+) ([^\/]+)\//.exec(a);if(o&&t===o[2]){n.splice(i,1),r.stripped.push(o[1]);continue}}i++}for(i=0;i<s.length;i++){for(var u=n[s[i].index].split(" "),c=3;c<u.length;)-1===s[i].stripped.indexOf(u[c])?c++:u.splice(c,1);n[s[i].index]=u.join(" ")}return n.join("\r\n")}return{stripTcpCandidates:function(t){return t.sdp=t.sdp.replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),e.Utils.Promise.resolve(t)},stripTelephoneEvent:function(i){return i.sdp=t(i.sdp,"telephone-event"),e.Utils.Promise.resolve(i)},cleanJitsiSdpImageattr:function(t){return t.sdp=t.sdp.replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),e.Utils.Promise.resolve(t)},stripG722:function(i){return i.sdp=t(i.sdp,"G722"),e.Utils.Promise.resolve(i)},stripRtpPayload:function(i){return function(r){return r.sdp=t(r.sdp,i),e.Utils.Promise.resolve(r)}}}}},function(e,t,i){"use strict";(function(t){e.exports=function(e){var i={STATUS_NULL:0,STATUS_NEW:1,STATUS_CONNECTING:2,STATUS_CONNECTED:3,STATUS_COMPLETED:4},r=function(r){if(r.media.remote.video?this.video=!0:this.video=!1,r.media.remote.audio?this.audio=!0:this.audio=!1,!this.audio&&!this.video)throw new Error("At least one remote audio or video element is required for Simple.");this.options=r;var s=t.navigator.userAgent.toLowerCase(),n=!1,a=!1;s.indexOf("safari")>-1&&s.indexOf("chrome")<0?n=!0:s.indexOf("firefox")>-1&&s.indexOf("chrome")<0&&(a=!0);var o={};return n&&(o.modifiers=[e.Web.Modifiers.stripG722]),a&&(o.alwaysAcquireMediaFirst=!0),this.options.ua.uri||(this.anonymous=!0),this.ua=new e.UA({uri:this.options.ua.uri,authorizationUser:this.options.ua.authorizationUser,password:this.options.ua.password,displayName:this.options.ua.displayName,userAgentString:this.options.ua.userAgentString,register:!0,sessionDescriptionHandlerFactoryOptions:o,transportOptions:{traceSip:this.options.ua.traceSip,wsServers:this.options.ua.wsServers}}),this.state=i.STATUS_NULL,this.logger=this.ua.getLogger("sip.simple"),this.ua.on("registered",function(){this.emit("registered",this.ua)}.bind(this)),this.ua.on("unregistered",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("failed",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("invite",function(e){if(this.state!==i.STATUS_NULL&&this.state!==i.STATUS_COMPLETED)return this.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();this.session=e,this.setupSession(),this.emit("ringing",this.session)}.bind(this)),this.ua.on("message",function(e){this.emit("message",e)}.bind(this)),this};return r.prototype=Object.create(e.EventEmitter.prototype),r.C=i,r.prototype.call=function(e){return this.ua&&this.checkRegistration()?this.state!==i.STATUS_NULL&&this.state!==i.STATUS_COMPLETED?void this.logger.warn("Cannot make more than a single call with Simple"):(this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session):void this.logger.warn("A registered UA is required for calling")},r.prototype.answer=function(){return this.state!==i.STATUS_NEW&&this.state!==i.STATUS_CONNECTING?void this.logger.warn("No call to answer"):(this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}))},r.prototype.reject=function(){return this.state!==i.STATUS_NEW&&this.state!==i.STATUS_CONNECTING?void this.logger.warn("Call is already answered"):this.session.reject()},r.prototype.hangup=function(){return this.state!==i.STATUS_CONNECTED&&this.state!==i.STATUS_CONNECTING&&this.state!==i.STATUS_NEW?void this.logger.warn("No active call to hang up on"):this.state!==i.STATUS_CONNECTED?this.session.cancel():this.session.bye()},r.prototype.hold=function(){return this.state!==i.STATUS_CONNECTED||this.session.local_hold?void this.logger.warn("Cannot put call on hold"):(this.mute(),this.logger.log("Placing session on hold"),this.session.hold())},r.prototype.unhold=function(){return this.state===i.STATUS_CONNECTED&&this.session.local_hold?(this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold()):void this.logger.warn("Cannot unhold a call that is not on hold")},r.prototype.mute=function(){if(this.state!==i.STATUS_CONNECTED)return void this.logger.warn("An acitve call is required to mute audio");this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)},r.prototype.unmute=function(){if(this.state!==i.STATUS_CONNECTED)return void this.logger.warn("An active call is required to unmute audio");this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)},r.prototype.sendDTMF=function(e){if(this.state!==i.STATUS_CONNECTED)return void this.logger.warn("An active call is required to send a DTMF tone");this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)},r.prototype.message=function(e,t){return this.ua&&this.checkRegistration()?e&&t?void this.ua.message(e,t):void this.logger.warn("A destination and message are required to send a message"):void this.logger.warn("A registered UA is required to send a message")},r.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},r.prototype.setupRemoteMedia=function(){var e,i=this.session.sessionDescriptionHandler.peerConnection;i.getReceivers?(e=new t.window.MediaStream,i.getReceivers().forEach(function(t){var i=t.track;i&&e.addTrack(i)})):e=i.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=e,this.options.media.remote.video.play().catch(function(){this.logger.log("play was rejected")}.bind(this))):this.audio&&(this.options.media.remote.audio.srcObject=e,this.options.media.remote.audio.play().catch(function(){this.logger.log("play was rejected")}.bind(this)))},r.prototype.setupLocalMedia=function(){if(this.video&&this.options.media.local&&this.options.media.local.video){var e,i=this.session.sessionDescriptionHandler.peerConnection;i.getSenders?(e=new t.window.MediaStream,i.getSenders().forEach(function(t){var i=t.track;i&&"video"===i.kind&&e.addTrack(i)})):e=i.getLocalStreams()[0],this.options.media.local.video.srcObject=e,this.options.media.local.video.volume=0,this.options.media.local.video.play()}},r.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},r.prototype.setupSession=function(){this.state=i.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",this.onProgress.bind(this)),this.session.on("accepted",this.onAccepted.bind(this)),this.session.on("rejected",this.onEnded.bind(this)),this.session.on("failed",this.onFailed.bind(this)),this.session.on("terminated",this.onEnded.bind(this))},r.prototype.destroyMedia=function(){this.session.sessionDescriptionHandler.close()},r.prototype.toggleMute=function(e){var t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach(function(t){t.track&&(t.track.enabled=!e)}):t.getLocalStreams().forEach(function(t){t.getAudioTracks().forEach(function(t){t.enabled=!e}),t.getVideoTracks().forEach(function(t){t.enabled=!e})})},r.prototype.onAccepted=function(){this.state=i.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler.on("addTrack",function(){this.logger.log("A track has been added, triggering new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.sessionDescriptionHandler.on("addStream",function(){this.logger.log("A stream has been added, trigger new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.on("hold",function(){this.emit("hold",this.session)}.bind(this)),this.session.on("unhold",function(){this.emit("unhold",this.session)}.bind(this)),this.session.on("dtmf",function(e){this.emit("dtmf",e)}.bind(this)),this.session.on("bye",this.onEnded.bind(this))},r.prototype.onProgress=function(){this.state=i.STATUS_CONNECTING,this.emit("connecting",this.session)},r.prototype.onFailed=function(){this.onEnded()},r.prototype.onEnded=function(){this.state=i.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},r}}).call(this,i(28))},function(e,t,i){"use strict";(function(t){function r(e,t){if(null!=e){var i=t.charAt(0).toUpperCase()+t.slice(1),r=[t,"webkit"+i,"moz"+i];for(var s in r){var n=e[r[s]];if(n)return n.bind(e)}}}var s=t.window||t;e.exports={WebSocket:s.WebSocket,Transport:i(10),open:s.open,Promise:s.Promise,timers:s,console:s.console||{debug:function(){},log:function(){},warn:function(){},error:function(){}},addEventListener:r(s,"addEventListener"),removeEventListener:r(s,"removeEventListener")}}).call(this,i(28))}])})},737:function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){function r(s,n){try{var a=t[s](n),o=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}return r("next")})}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return d.DO_REGISTER?e.isRegistered():e.transport&&e.transport.isConnected()}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=i(12),c=r(u),l=i(75),h=r(l),d=i(345),p=i(3),f=p.LoggerFactory.getInstance().getLogger("call/sip/UserAgentWaker"),g=function(){function e(t,i,r){var a=this;n(this,e),this.cancelled=!1,this.started=!1,this.cleanUp=r,this.req=(0,h.default)(t).then(s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.cancelled){e.next=2;break}return e.abrupt("return");case 2:return a.started=!0,e.next=5,i();case 5:case"end":return e.stop()}},e,a)})))}return o(e,[{key:"cancel",value:function(){function e(){return t.apply(this,arguments)}var t=s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cancelled=!0,!this.started){e.next=4;break}return e.next=4,this.req;case 4:this.cleanUp&&this.cleanUp();case 5:case"end":return e.stop()}},e,this)}));return e}()}]),e}(),m=function(){function e(t){n(this,e),this._userAgent=t,this._upCount=0}return o(e,[{key:"wake",value:function(){function e(){return t.apply(this,arguments)}var t=s(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._upCount++,!this._requestToStopUA){e.next=5;break}return e.next=4,this._requestToStopUA.cancel();case 4:this._requestToStopUA=null;case 5:if(!a(this._userAgent)){e.next=7;break}return e.abrupt("return",Promise.resolve(this._userAgent));case 7:return e.abrupt("return",this._connect().catch(function(e){throw t._upCount--,e}));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"_connect",value:function(){var e=this;f.info("starting userAgent as waken");var t=this._userAgent.transport;return new Promise(function(i,r){var s=function(){if(t){var s=function(){t.removeListener("connected",n),t.removeListener("disconnected",a)},n=function(){f.info("SIP UA CONNECTED"),s(),d.DO_REGISTER||(e._userAgent.removeAllListeners(),i(e._userAgent))},a=function(t){e._userAgent.removeAllListeners(),s(),r(new Error("Unable to connect: "+t)),f.info("SIP UA DISCONNECTED")};t.once("connected",n),t.once("disconnected",a)}};e._userAgent.removeAllListeners(),s(),e._userAgent.once("transportCreated",function(e){t=e,s()}),e._userAgent.once("registered",function(){d.DO_REGISTER&&(e._userAgent.removeAllListeners(),i(e._userAgent)),f.info("SIP UA REGISTERED")}),e._userAgent.once("unregistered",function(t){e._userAgent.removeAllListeners(),r(new Error("Unable to register: "+t)),f.info("SIP UA UNREGISTERED ",t)}),e._userAgent.once("registrationFailed",function(t){e._userAgent.removeAllListeners(),r(new Error("Unable to register: "+t)),f.info("SIP UA REG FAILED ",t)}),e._userAgent.start()})}},{key:"sleep",value:function(){var e=this;if(!(--this._upCount>0)){this._upCount=0,f.info("stopping userAgent as ready to sleep");var t=this._userAgent.transport;if(t&&t.isConnected()&&!this._requestToStopUA){var i=new c.default(t),r=function(){var t=s(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Promise(function(e){i.once("disconnected",e)}),e._userAgent.stop(),t.next=4,r;case 4:e._requestToStopUA=null,f.info("UserAgent stopped due to inactivity");case 6:case"end":return t.stop()}},t,e)}));return function(){return t.apply(this,arguments)}}();this._requestToStopUA=new g(1e4,r,function(){return i.reset()})}}}}]),e}();t.default=m,e.exports=t.default},738:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return/^[+-.()\s\d]+$/.test(e)?"sip:"+e.replace(/[-.()\s]/g,"")+"@"+t+";user=phone":"sip:"+e},e.exports=t.default},739:function(e,t,i){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i(57),o=function(){function e(){s(this,e),this._providers=[]}return n(e,[{key:"addProvider",value:function(e){this._providers.includes(e)||(this._providers=[].concat(r(this._providers),[e]))}},{key:"removeProvider",value:function(e){var t=this._providers.indexOf(e);t<0||(this._providers=(0,a.remove)(this._providers,t))}},{key:"getProviders",value:function(){return[].concat(r(this._providers))}}]),e}();t.default=o,e.exports=t.default},80:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IDLE="idle",t.INCOMING="incoming-call",t.CONNECTING="connecting-call",t.ACTIVE="call-active",t.ENDED="call-ended"},94:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ERROR="call-error",t.STATUS_UPDATED="call-status-updated",t.MUTE_STATUS_UPDATED="mute-status-updated",t.HOLD_STATUS_UPDATED="hold-status-updated",t.INCOMING_CALL="incoming-call",t.CALLS_UPDATED="calls-updated",t.OUTGOING_CALL="outgoing-call",t.CALL_ENDED="call-ended"}},[723])});