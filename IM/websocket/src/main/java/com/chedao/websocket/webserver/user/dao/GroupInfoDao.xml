<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.chedao.websocket.webserver.user.dao.GroupInfoDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.chedao.websocket.webserver.user.model.GroupInfoEntity" id="GroupInfoMap">
        <result property="id" column="id"/>
        <result property="account" column="account"/>
        <result property="password" column="password"/>
        <result property="disablestate" column="disablestate"/>
        <result property="isdel" column="isdel"/>
        <result property="createdate" column="createdate"/>
        <result property="updatedate" column="updatedate"/>
        <result property="updateuser" column="updateuser"/>
    </resultMap>

    <insert id="addGroupInfo" parameterType="com.chedao.websocket.webserver.user.model.GroupInfoEntity" useGeneratedKeys="true" keyProperty="id">
		insert into group_info
		(
			`group_num`,
			`group_name`,
			`avatar`,
			`group_man_id`,
			`group_man`,
			`status`,
			`remark`,
			`recorder_id`,
			`recorder`,
			`record_date`,
			`modifier_id`,
			`modifier`,
			`modify_date`
		)
		values
		(
			#{groupNum},
			#{groupName},
			#{avatar},
			#{groupManId},
			#{groupMan},
			#{status},
			#{remark},
			#{recorderId},
			#{recorder},
			NOW(),
			#{modifierId},
			#{modifier},
			NOW()
		)
	</insert>

	<select id="queryObject" resultType="com.chedao.websocket.webserver.user.model.GroupInfoEntity">
		SELECT
		a.id as id,
		a.group_num as groupNum,
		a.group_name as groupName,
		a.avatar as avatar,
		a.group_man_id as groupManId,
		a.group_man as groupMan,
		a.`status` as status,
		a.remark as remark,
		a.recorder_id as recorderId,
		a.recorder as recorder,
		a.record_date as recordDate,
		a.modifier_id as modifierId,
		a.modifier as modifier,
		a.modify_date as modifyDate
		FROM
		group_info AS a
		where id = #{value}
	</select>

	<!-- 查找该用户所有群组-->
	<select id="queryUserGroupList" resultType="com.chedao.websocket.webserver.user.model.GroupInfoTEntity" >
           SELECT a.id, a.group_name as groupname, a.avatar
		   from group_info a
		   where ifnull(status,0) = 0
		         and exists (select 1 from group_user b where a.id = b.group_id and b.user_id = #{userId})
    </select>

	<update id="updateGroup" parameterType="com.chedao.websocket.webserver.user.model.GroupInfoEntity">
		update group_info
		<set>
			<if test="groupName != null">`group_name` = #{groupName}, </if>
			<if test="avatar != null">`avatar` = #{avatar}, </if>
			<if test="modifierId != null">`modifier_id` = #{modifierId}, </if>
			<if test="modifier != null">`modifier` = #{modifier}, </if>
			<if test="remark != null">`remark` = #{remark}, </if>
			`modify_date` = NOW()
		</set>
		where id = #{id}
	</update>


	<!-- 群聊查询 -->
	<select id="queryGroupInfo" parameterType="java.util.List" resultType="com.chedao.websocket.webserver.user.model.GroupInfoEntity">
		  select
		   	id as id,
		   	group_num as groupNum,
		   	group_name as groupName,
		   	avatar as avatar,
		   	group_man_id as groupManId,
		   	group_man as groupMan,
		   	status as status,
		   	remark as remark
		   from group_info
		   where id in
			<foreach collection="groupIds" item="groupId" index="index" open="(" separator="," close=")">
				#{groupId.groupId}
			</foreach>

	</select>



</mapper>