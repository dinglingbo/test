<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.chedao.websocket.webserver.user.dao.GroupUserDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.chedao.websocket.webserver.user.model.GroupUserEntity" id="GroupUserMap">
        <result property="id" column="id"/>
        <result property="account" column="account"/>
        <result property="password" column="password"/>
        <result property="disablestate" column="disablestate"/>
        <result property="isdel" column="isdel"/>
        <result property="createdate" column="createdate"/>
        <result property="updatedate" column="updatedate"/>
        <result property="updateuser" column="updateuser"/>
    </resultMap>

    <insert id="addGroupUser" parameterType="java.util.List" useGeneratedKeys="true" keyProperty="id">
		insert into group_user
		(
			`user_id`,
			`user_name`,
			`group_id`,
			`join_time`
		)
		values
        <foreach collection="list" item="item" index="index" separator=",">
		(
			#{item.userId},
			#{item.userName},
			#{item.groupId},
			NOW()
		)
        </foreach>
	</insert>

	<delete id="deleteGroup">
		delete from group_user where user_id = #{userId} and group_id = #{groupId}
	</delete>

	<!-- 查询群聊下的所有成员 -->
	<select id="queryGroupUsers" resultType="com.chedao.websocket.webserver.user.model.GroupUserEntity">
		  select
		   	id as id,
		   	user_id as userId,
		   	user_name as userName,
		   	group_id as groupId,
		   	join_time as joinTime
		   from group_user
		   where group_id = #{groupId}
    </select>

	<!-- 查询成员下的所有群 -->
	<select id="queryGroupInfo" resultType="com.chedao.websocket.webserver.user.model.GroupUserEntity">
		  select
		   	id as id,
		   	user_id as userId,
		   	user_name as userName,
		   	group_id as groupId,
		   	join_time as joinTime
		   from group_user
		   where user_id = #{userId}
    </select>
	<!-- 查询群聊下的所有成员id -->
	<select id="queryGroupUserId" resultType="java.lang.String">
		  select
		   	user_id as userId
		   from group_user
		   where group_id = #{groupId}
    </select>
	<!-- 查询群聊下的所有成员信息 -->
	<select id="queryUserInfoExtend" resultType="com.chedao.websocket.webserver.user.model.UserInfoExtendEntity">
		  select
		   	a.uid as id,
		    a.profilephoto as avatar,
		   	b.user_name as username,
		   	a.signature as sign
		   from user_info a
		   INNER JOIN group_user b on a.uid = b.user_id
		   where b.group_id = #{groupId}
    </select>
	<!-- 查询群聊下的某个成员的信息 -->
	<select id="queryGroupUserInfoExtend" resultType="com.chedao.websocket.webserver.user.model.UserInfoExtendEntity">
		  select
		   	a.uid as id,
		    a.profilephoto as avatar,
		   	b.user_name as username,
		   	a.signature as sign
		   from user_info a
		   INNER JOIN group_user b on a.uid = b.user_id
		   where b.group_id = #{groupId} and b.user_id = #{userId}
    </select>
	<!-- 查询昵称 -->
	<select id="queryGroupName" resultType="com.chedao.websocket.webserver.user.model.GroupUserEntity">
		  select
		   	id as id,
		   	user_id as userId,
		   	user_name as userName,
		   	group_id as groupId,
		   	join_time as joinTime
		   from group_user
		   where user_id = #{userId} and group_id= #{groupId}
    </select>
	<update id="updateGroupName" parameterType="java.lang.String">
		update group_user
		<set>
			<if test="name != null">`user_name` = #{name} </if>
		</set>
		where user_id = #{userId} and group_id = #{groupId}
	</update>
</mapper>